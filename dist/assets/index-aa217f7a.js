import{r as R,a as Be,R as De}from"./vendor-57209f9c.js";import{c as ce,R as Q,B as me,C as ee,X as te,Y as se,T as ae,a as ue,A as Ye,b as qe,d as We,e as Ge,L as Ke,f as He,p as Ze,g as Xe,h as Je,i as Qe,j as et,P as tt,k as st,l as at}from"./charts-60ed958c.js";(function(){const s=document.createElement("link").relList;if(s&&s.supports&&s.supports("modulepreload"))return;for(const r of document.querySelectorAll('link[rel="modulepreload"]'))t(r);new MutationObserver(r=>{for(const i of r)if(i.type==="childList")for(const a of i.addedNodes)a.tagName==="LINK"&&a.rel==="modulepreload"&&t(a)}).observe(document,{childList:!0,subtree:!0});function n(r){const i={};return r.integrity&&(i.integrity=r.integrity),r.referrerPolicy&&(i.referrerPolicy=r.referrerPolicy),r.crossOrigin==="use-credentials"?i.credentials="include":r.crossOrigin==="anonymous"?i.credentials="omit":i.credentials="same-origin",i}function t(r){if(r.ep)return;r.ep=!0;const i=n(r);fetch(r.href,i)}})();var Le={exports:{}},oe={};/**
 * @license React
 * react-jsx-runtime.production.min.js
 *
 * Copyright (c) Facebook, Inc. and its affiliates.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE file in the root directory of this source tree.
 */var rt=R,nt=Symbol.for("react.element"),lt=Symbol.for("react.fragment"),it=Object.prototype.hasOwnProperty,ct=rt.__SECRET_INTERNALS_DO_NOT_USE_OR_YOU_WILL_BE_FIRED.ReactCurrentOwner,ot={key:!0,ref:!0,__self:!0,__source:!0};function Pe(l,s,n){var t,r={},i=null,a=null;n!==void 0&&(i=""+n),s.key!==void 0&&(i=""+s.key),s.ref!==void 0&&(a=s.ref);for(t in s)it.call(s,t)&&!ot.hasOwnProperty(t)&&(r[t]=s[t]);if(l&&l.defaultProps)for(t in s=l.defaultProps,s)r[t]===void 0&&(r[t]=s[t]);return{$$typeof:nt,type:l,key:i,ref:a,props:r,_owner:ct.current}}oe.Fragment=lt;oe.jsx=Pe;oe.jsxs=Pe;Le.exports=oe;var e=Le.exports,he={},Ae=Be;he.createRoot=Ae.createRoot,he.hydrateRoot=Ae.hydrateRoot;function Se(l,s){if(!l&&s===0)return"unknown";const n=(l||"").toLowerCase();return n.includes("deposit")||n.includes("in")||n.includes("пополнение")?"Deposit":n.includes("withdraw")||n.includes("out")||n.includes("вывод")?"Withdraw":s>0?"Deposit":s<0?"Withdraw":"unknown"}function dt(l){const s=(l||"").toLowerCase();return s==="success"?"completed":s==="failed"||s==="error"?"failed":s==="pending"||s==="processing"||s==="in progress"?"pending":s==="cancelled"||s==="canceled"?"canceled":s}function mt(l,s,n="merchant"){var t,r,i;if(console.log("🔄 NORMALIZING DATA - Type:",n,"Records:",l.length),n==="platform")return console.log("🏦 Normalizing platform data:",l.length,"records"),l.length>0&&console.log("🔍 First platform record raw:",l[0]),l.map(a=>({userId:a["User ID"]||"",operationId:a["Operation ID"]||"",status:a.Status||"",foreignOperationId:a["Foreign Operation Id"]||"",clientOperationId:a["Client Operation ID"]||"",referenceId:a["Reference ID"]||"",createdAt:a["Created At"]||"",method:a.Method||"",initialAmount:parseFloat((a["Initial Amount"]||"0").replace(",","."))||0,initialCurrency:a["Initial Currency"]||"TRY",resultAmount:parseFloat((a["Result Amount"]||"0").replace(",","."))||0,resultCurrency:a["Result Currency"]||"TRY",code:a.Code||"",message:a.Message||"",details:a.Details||"",paymentChannelName:a["Payment Channel Name"]||"",originalErrorMessage:a["Original Error Message"]||"",endpoint:a.Endpoint||"",id:a["Foreign Operation Id"]||a["Operation ID"]||"",trackingId:a["Foreign Operation Id"]||"",amount:parseFloat((a["Result Amount"]||a["Initial Amount"]||"0").replace(",","."))||0,currency:a["Result Currency"]||a["Initial Currency"]||"TRY",debugInfo:{hasForeignOpId:!!a["Foreign Operation Id"],hasResultAmount:!!a["Result Amount"],hasInitialAmount:!!a["Initial Amount"],originalStatus:a.Status},type:Se(a.Method,parseFloat((a["Result Amount"]||a["Initial Amount"]||"0").replace(",","."))),transactionType:Se(a.Method,parseFloat((a["Result Amount"]||a["Initial Amount"]||"0").replace(",","."))),normalizedStatus:dt(a.Status||""),isCompleted:(a.Status||"").toLowerCase()==="success",isFailed:(a.Status||"").toLowerCase()==="failed"||(a.Status||"").toLowerCase()==="error",dataSource:"platform",originalData:a}));if(n==="merchant"){console.log("🏪 Normalizing merchant data:",l.length,"records"),l.length>0&&console.log("🔍 First merchant record raw:",l[0]);const a=l.map(c=>({id:c["Tracking Id"]||c["Идентификатор отслеживания"]||c["Tracking ID"]||c.ID||"",status:c.Status||c.Статус||"",amount:parseFloat((c.Amount||c["Transaction amount"]||c["Сумма транзакции"]||c.Сумма||"0").replace(",","."))||0,type:c.Type||c.Тип||"",company:c.Company||c.Компания||"",fee:parseFloat((c.Fee||c.Комиссия||"0").replace(",","."))||0,feeRatio:c["Fee Ratio"]||"0%",transactionType:c.Type||c.Тип||"",isDeposit:(c.Type||c.Тип||"").toLowerCase()==="deposit",isWithdraw:(c.Type||c.Тип||"").toLowerCase()==="withdraw",userName:c["User name"]||c["Имя пользователя"]||c.Username||c.Пользователь||"",userId:c["User ıd"]||c["User id"]||c["Идентификатор пользователя"]||c["User ID"]||"",fullName:c.Name||c.Имя||c["Full Name"]||"",createdAt:c["Creation time"]||c["Время создания"]||c["Created At"]||c["Дата создания"]||"",processedAt:c["Processed time"]||c["Время обработки"]||c["Processed At"]||"",paymentMethod:c["Payment method"]||c["Метод оплаты"]||c["Payment Method"]||c["Способ оплаты"]||"",paymentGateway:c["Payment Gateway"]||"",recipientName:c["Receiver Account Name"]||c["Имя получателя"]||c["Recipient Name"]||"",recipientAccount:c["Receiver Account Number"]||c["Номер счета получателя"]||c["Recipient Account"]||"",hash:c["Hash code"]||c["Хэш-код"]||c.Hash||"",ipAddress:c["Client Ip address"]||c["IP адрес клиента"]||c["IP Address"]||"",receipt:c.Receipt||c.Квитанция||"",explanation:c.Explanation||c.Объяснение||"",explanationType:c["[Explanation type]"]||c["Explanation Type"]||"",linkId:c["Reference Id"]||c["Идентификатор ссылки"]||c["Link ID"]||"",isCompleted:(c.Status||c.Статус||"").toLowerCase()==="completed",isCanceled:(c.Status||c.Статус||"").toLowerCase()==="canceled",isFailed:(c.Status||c.Статус||"").toLowerCase()==="failed",amountFormatted:new Intl.NumberFormat("tr-TR",{style:"currency",currency:"TRY"}).format(parseFloat((c.Amount||c["Transaction amount"]||c["Сумма транзакции"]||c.Сумма||"0").replace(",","."))||0),feeFormatted:new Intl.NumberFormat("tr-TR",{style:"currency",currency:"TRY"}).format(parseFloat((c.Fee||c.Комиссия||"0").replace(",","."))||0),trackingId:c["Tracking Id"]||c["Идентификатор отслеживания"]||c["Tracking ID"]||c.ID||"",normalizedStatus:(c.Status||c.Статус||"").toLowerCase(),dataSource:"merchant",originalData:c}));return console.log("🏪 Merchant normalization complete. Sample record:",a[0]),console.log("🏪 Key fields for reconciliation:"),console.log("🏪 - trackingId:",(t=a[0])==null?void 0:t.trackingId),console.log("🏪 - status:",(r=a[0])==null?void 0:r.status),console.log("🏪 - normalizedStatus:",(i=a[0])==null?void 0:i.normalizedStatus),a}else return console.log("⚠️ Unknown data type, using fallback normalization"),l}function ut(l){const s=l.join(" ").toLowerCase();console.log("🔍 Detecting data format from headers:",s);const n=["user id","operation id","status","foreign operation id","client operation id","reference id","created at","method","initial amount","initial currency","result amount","result currency","code","message","details","payment channel name","original error message","endpoint"],t=["tracking id","reference id","status","payment method","payment gateway","amount","transaction amount","type","company","fee","fee ratio","name","user ıd","user name","creation time","processed time","receiver account name","receiver account number","hash code","client ip address","receipt","explanation","[explanation type]"],r=n.filter(a=>s.includes(a)).length,i=t.filter(a=>s.includes(a)).length;return console.log("📊 Platform header matches:",r,"/",n.length),console.log("📊 Merchant header matches:",i,"/",t.length),r>i&&r>=10?(console.log("📊 Detected: Platform format (exact match)"),"platform"):i>r&&i>=10?(console.log("📊 Detected: Merchant format (exact match)"),"merchant"):s.includes("foreign operation id")||s.includes("client operation id")||s.includes("initial amount")||s.includes("result amount")?(console.log("📊 Detected: Platform format (fallback)"),"platform"):s.includes("tracking id")||s.includes("status")&&s.includes("amount")?(console.log("📊 Detected: Merchant format (fallback)"),"merchant"):(console.log("📊 Default: Merchant format"),"merchant")}function xt(l,s=null){console.log("=== CSV PARSER DEBUG ==="),console.log("Raw text length:",l.length),console.log("First 500 chars:",l.substring(0,500)),console.log("Last 500 chars:",l.substring(l.length-500));try{const n=l.split(/\r?\n/).filter(x=>x.trim());if(console.log("Lines found:",n.length),n.length===0)return console.error("No lines found in CSV"),[];const t=n[0].trim();console.log("Header line:",t),console.log("Header line length:",t.length);let r=";";t.includes(";")?r=";":t.includes(",")?r=",":t.includes("	")&&(r="	"),console.log("Using delimiter:",r);const i=t.split(r).map(x=>x.trim().replace(/"/g,""));console.log("Headers count:",i.length),console.log("Headers:",i),console.log("🔍 HEADER ANALYSIS FOR RECONCILIATION:"),console.log("🔍 All headers (lowercase):",i.map(x=>x.toLowerCase()));const a=i.filter(x=>x.toLowerCase().includes("status")),c=i.filter(x=>x.toLowerCase().includes("id")||x.toLowerCase().includes("tracking")),p=i.filter(x=>x.toLowerCase().includes("amount"));console.log("🔍 Status fields found:",a),console.log("🔍 ID fields found:",c),console.log("🔍 Amount fields found:",p);const f=ut(i);console.log("Detected format:",f);let j=s||f;if(n.length===2&&!s){console.log("🔍 Detected file with only 2 lines, checking for platform format...");const x=i.join(" ").toLowerCase();["foreign operation id","client operation id","initial amount","result amount"].filter(k=>x.includes(k)).length>=2&&(console.log("🔍 Platform keywords found, forcing platform format"),j="platform")}console.log("Final data type:",j);const S=[];if(j==="platform"&&n.length===2)if(console.log("🔧 Detected platform file with single data line, processing specially..."),i.length>50){console.log("⚠️ Too many headers detected, likely mixed with data. Attempting to fix...");const x=["User ID","Operation ID","Status","Foreign Operation Id","Client Operation ID","Reference ID","Created At","Method","Initial Amount","Initial Currency","Result Amount","Result Currency","Code","Message","Details","Payment Channel Name","Original Error Message","Endpoint"],N=n[1].trim();console.log("Data line length:",N.length);const h=N.split(r).map(y=>y.trim().replace(/"/g,""));console.log("Total values found:",h.length);const k=x;console.log("Using correct headers count:",k.length);const w=k.length,_=Math.floor(h.length/w);console.log("Values per record:",w),console.log("Calculated record count:",_);const o=h.length%w;o>0&&console.warn("⚠️ Warning: Values count is not perfectly divisible by headers count. Remainder:",o);for(let y=0;y<_;y++){const b={},v=y*w;k.forEach((d,C)=>{const A=v+C;A<h.length?b[d]=h[A]||"":(b[d]="",console.warn("⚠️ Value index out of bounds:",A,"for header:",d))}),S.push(b)}console.log("Created records from single line:",S.length),S.length>0&&(console.log("First record sample:",S[0]),S.length>1&&console.log("Second record sample:",S[1]))}else{const x=n[1].trim();console.log("Data line length:",x.length);const N=x.split(r).map(_=>_.trim().replace(/"/g,""));console.log("Total values found:",N.length),console.log("Expected headers count:",i.length);const h=i.length,k=Math.floor(N.length/h);console.log("Values per record:",h),console.log("Calculated record count:",k);const w=N.length%h;w>0&&console.warn("⚠️ Warning: Values count is not perfectly divisible by headers count. Remainder:",w);for(let _=0;_<k;_++){const o={},y=_*h;i.forEach((b,v)=>{const d=y+v;d<N.length?o[b]=N[d]||"":(o[b]="",console.warn("⚠️ Value index out of bounds:",d,"for header:",b))}),S.push(o)}console.log("Created records from single line:",S.length),S.length>0&&(console.log("First record sample:",S[0]),S.length>1&&console.log("Second record sample:",S[1]))}else if(j==="platform"&&n.length>2){console.log("🔧 Processing platform file with normal structure...");for(let x=1;x<n.length;x++){const N=n[x].trim();if(!N)continue;const h=N.split(r).map(w=>w.trim().replace(/"/g,"")),k={};i.forEach((w,_)=>{k[w]=h[_]||""}),S.push(k)}console.log("Processed platform records:",S.length)}else for(let x=1;x<n.length;x++){const N=n[x].trim();if(!N)continue;const h=N.split(r).map(w=>w.trim().replace(/"/g,"")),k={};i.forEach((w,_)=>{k[w]=h[_]||""}),S.push(k)}console.log("Parsed data count:",S.length);const u=mt(S,f,j);console.log("Normalized data count:",u.length);const g={};return u.forEach(x=>{const N=x.status||"empty";g[N]=(g[N]||0)+1}),console.log("Status distribution:",g),u}catch(n){return console.error("Error parsing CSV:",n),[]}}function ht(l,s="merchant"){console.log("Calculating metrics for data:",l.length,"rows, type:",s);const n=l.length,t=l.filter(b=>{const v=b.status?b.status.toLowerCase():"";return s==="merchant"?v==="completed":v==="success"}).length,r=l.filter(b=>{const v=b.status?b.status.toLowerCase():"";return s==="merchant"?v==="failed":v==="fail"}).length,i=l.filter(b=>{const v=b.status?b.status.toLowerCase():"";return s==="merchant"?v==="canceled":!1}).length,a=l.filter(b=>b.isDeposit),c=l.filter(b=>b.isWithdraw),p={total:a.length,successful:a.filter(b=>{const v=b.status?b.status.toLowerCase():"";return s==="merchant"?v==="completed":v==="success"}).length,amount:a.reduce((b,v)=>b+(parseFloat(v.amount)||0),0),successfulAmount:a.filter(b=>{const v=b.status?b.status.toLowerCase():"";return s==="merchant"?v==="completed":v==="success"}).reduce((b,v)=>b+(parseFloat(v.amount)||0),0)},f={total:c.length,successful:c.filter(b=>{const v=b.status?b.status.toLowerCase():"";return s==="merchant"?v==="completed":v==="success"}).length,amount:c.reduce((b,v)=>b+(parseFloat(v.amount)||0),0),successfulAmount:c.filter(b=>{const v=b.status?b.status.toLowerCase():"";return s==="merchant"?v==="completed":v==="success"}).reduce((b,v)=>b+(parseFloat(v.amount)||0),0)};console.log("Status breakdown:",{total:n,successful:t,failed:r,canceled:i}),console.log("First 3 rows status check:",l.slice(0,3).map(b=>({status:b.status,normalizedStatus:b.status?b.status.toLowerCase():"",isCompleted:s==="merchant"?b.status?b.status.toLowerCase()==="completed":!1:b.status?b.status.toLowerCase()==="success":!1})));const j=n>0?t/n*100:0,S=l.filter(b=>{const v=b.status?b.status.toLowerCase():"";return s==="merchant"?v==="completed":v==="success"}).reduce((b,v)=>{const d=parseFloat(v.amount)||0;return b+d},0),u=l.reduce((b,v)=>{const d=parseFloat(v.amount)||0;return b+d},0),g=l.filter(b=>{const v=b.status?b.status.toLowerCase():"";return s==="merchant"?v==="failed"||v==="canceled":v==="fail"}).reduce((b,v)=>{const d=parseFloat(v.amount)||0;return b+d},0),x=l.reduce((b,v)=>{const d=parseFloat(v.fee)||0;return b+d},0),N=n>0?u/n:0,h=l.map(b=>parseFloat(b.amount)||0),k=h.length>0?Math.max(...h):0,w=h.length>0?Math.min(...h):0,_={};s==="merchant"&&l.forEach(b=>{const v=b.company||"Unknown";_[v]||(_[v]={total:0,completed:0,failed:0,canceled:0,revenue:0}),_[v].total++,_[v].revenue+=parseFloat(b.amount)||0;const d=b.status?b.status.toLowerCase():"";d==="completed"?_[v].completed++:d==="failed"?_[v].failed++:d==="canceled"&&_[v].canceled++});const o={};l.forEach(b=>{const v=b.paymentMethod||"Unknown";o[v]||(o[v]={total:0,completed:0,failed:0,canceled:0}),o[v].total++;const d=b.status?b.status.toLowerCase():"";s==="merchant"?d==="completed"?o[v].completed++:d==="failed"?o[v].failed++:d==="canceled"&&o[v].canceled++:d==="success"?o[v].completed++:d==="fail"&&o[v].failed++});const y={total:n,successful:t,failed:r,canceled:i,conversionRate:j,successfulRevenue:S,lostRevenue:g,totalAmount:u,totalFees:x,averageAmount:N,maxAmount:k,minAmount:w,companyStats:_,paymentMethodStats:o,depositMetrics:p,withdrawalMetrics:f,dataType:s};return console.log("Calculated metrics:",y),y}function pt(l,s){const n=[],{dataType:t}=s;if(s.conversionRate<50?n.push({type:"warning",icon:"⚠️",text:`Низкая конверсия: ${s.conversionRate.toFixed(1)}%. Требуется анализ причин отказов.`}):s.conversionRate>80&&n.push({type:"success",icon:"🎉",text:`Отличная конверсия: ${s.conversionRate.toFixed(1)}%. Система работает эффективно.`}),t==="merchant"&&s.canceled>0){const a=s.canceled/s.total*100;n.push({type:"info",icon:"⏸️",text:`${s.canceled} отмененных операций (${a.toFixed(1)}%). Возможно, стоит улучшить UX.`})}if(t==="merchant"&&Object.keys(s.companyStats).length>0){const a=Object.entries(s.companyStats).sort(([,c],[,p])=>p.revenue-c.revenue)[0];a&&n.push({type:"info",icon:"🏢",text:`Топ компания: ${a[0]} с выручкой ${a[1].revenue.toLocaleString("tr-TR")} TRY`})}const r=Object.entries(s.paymentMethodStats).sort(([,a],[,c])=>c.total-a.total)[0];if(r){const a=r[1].completed/r[1].total*100;n.push({type:"info",icon:"💳",text:`Популярный метод: ${r[0]} (${a.toFixed(1)}% конверсия)`})}const i=l.filter(a=>parseFloat(a.amount)>s.averageAmount*2).length;return i>0&&n.push({type:"info",icon:"💎",text:`${i} операций с высокой стоимостью (>${(s.averageAmount*2).toLocaleString("tr-TR",{maximumFractionDigits:0})} TRY).`}),n.push({type:"info",icon:"💰",text:`Общая выручка: ${s.successfulRevenue.toLocaleString("tr-TR")} TRY, комиссии: ${s.totalFees.toLocaleString("tr-TR")} TRY`}),n}function gt(l){const s={"0-500":0,"501-1000":0,"1001-2000":0,"2001-5000":0,"5000+":0};return l.forEach(n=>{const t=parseFloat(n.amount)||0;t<=500?s["0-500"]++:t<=1e3?s["501-1000"]++:t<=2e3?s["1001-2000"]++:t<=5e3?s["2001-5000"]++:s["5000+"]++}),s}function ft(l,s="merchant"){return[{label:"0-500",min:0,max:500},{label:"501-1000",min:501,max:1e3},{label:"1001-2000",min:1001,max:2e3},{label:"2001-5000",min:2001,max:5e3},{label:"5000+",min:5001,max:1/0}].map(t=>{const r=l.filter(c=>{const p=parseFloat(c.amount)||0;return p>=t.min&&p<=t.max}),i=r.length,a=r.filter(c=>{const p=c.status?c.status.toLowerCase():"";return s==="merchant"?p==="completed":p==="success"}).length;return{range:t.label,total:i,successful:a,conversion:i>0?a/i*100:0}})}function bt(l,s="merchant"){const n={};return l.forEach(t=>{const r=t.status||"unknown";n[r]=(n[r]||0)+1}),n}function yt(l){const s={};return l.forEach(n=>{const t=n.company||"Unknown";s[t]=(s[t]||0)+1}),s}function jt(l){const s={};return l.forEach(n=>{const t=n.paymentMethod||"Unknown";s[t]=(s[t]||0)+1}),s}function Nt(l){const s={};return l.forEach(n=>{let t;n.createdAt?t=n.createdAt.split(" ")[0]:t=new Date().toISOString().split("T")[0],s[t]||(s[t]={total:0,completed:0,failed:0,canceled:0,revenue:0}),s[t].total++,s[t].revenue+=parseFloat(n.amount)||0;const r=n.status?n.status.toLowerCase():"";r==="completed"||r==="success"?s[t].completed++:r==="failed"||r==="fail"?s[t].failed++:r==="canceled"&&s[t].canceled++}),Object.entries(s).map(([n,t])=>({date:n,...t,conversionRate:t.completed/t.total*100}))}function vt(l,s=10){const n={};return l.forEach(t=>{const r=t.userId||"Unknown",i=t.userName||t.fullName||"Unknown";n[r]||(n[r]={id:r,name:i,total:0,completed:0,failed:0,canceled:0,totalAmount:0}),n[r].total++,n[r].totalAmount+=parseFloat(t.amount)||0;const a=t.status?t.status.toLowerCase():"";a==="completed"||a==="success"?n[r].completed++:a==="failed"||a==="fail"?n[r].failed++:a==="canceled"&&n[r].canceled++}),Object.values(n).sort((t,r)=>r.totalAmount-t.totalAmount).slice(0,s)}function wt(l){const s=[],n=l.map(i=>parseFloat(i.amount)||0),t=n.reduce((i,a)=>i+a,0)/n.length,r=Math.sqrt(n.reduce((i,a)=>i+Math.pow(a-t,2),0)/n.length);return l.forEach((i,a)=>{const c=parseFloat(i.amount)||0;c>t+2*r&&s.push({type:"high_amount",row:a+1,value:c,description:`Необычно высокая сумма: ${c.toLocaleString("ru-RU")}`})}),l.forEach((i,a)=>{if(i.createdAt&&i.processedAt){const c=new Date(i.createdAt),f=new Date(i.processedAt)-c;f>30*60*1e3&&s.push({type:"slow_processing",row:a+1,value:f/(60*1e3),description:`Медленная обработка: ${Math.round(f/(60*1e3))} минут`})}}),s}/**
 * @license lucide-react v0.294.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */var Ct={xmlns:"http://www.w3.org/2000/svg",width:24,height:24,viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:2,strokeLinecap:"round",strokeLinejoin:"round"};/**
 * @license lucide-react v0.294.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const kt=l=>l.replace(/([a-z0-9])([A-Z])/g,"$1-$2").toLowerCase().trim(),T=(l,s)=>{const n=R.forwardRef(({color:t="currentColor",size:r=24,strokeWidth:i=2,absoluteStrokeWidth:a,className:c="",children:p,...f},j)=>R.createElement("svg",{ref:j,...Ct,width:r,height:r,stroke:t,strokeWidth:a?Number(i)*24/Number(r):i,className:["lucide",`lucide-${kt(l)}`,c].join(" "),...f},[...s.map(([S,u])=>R.createElement(S,u)),...Array.isArray(p)?p:[p]]));return n.displayName=`${l}`,n};/**
 * @license lucide-react v0.294.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const G=T("Activity",[["path",{d:"M22 12h-4l-3 9L9 3l-3 9H2",key:"d5dnw9"}]]);/**
 * @license lucide-react v0.294.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const je=T("AlertCircle",[["circle",{cx:"12",cy:"12",r:"10",key:"1mglay"}],["line",{x1:"12",x2:"12",y1:"8",y2:"12",key:"1pkeuh"}],["line",{x1:"12",x2:"12.01",y1:"16",y2:"16",key:"4dfq90"}]]);/**
 * @license lucide-react v0.294.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const X=T("AlertTriangle",[["path",{d:"m21.73 18-8-14a2 2 0 0 0-3.48 0l-8 14A2 2 0 0 0 4 21h16a2 2 0 0 0 1.73-3Z",key:"c3ski4"}],["path",{d:"M12 9v4",key:"juzpu7"}],["path",{d:"M12 17h.01",key:"p32p05"}]]);/**
 * @license lucide-react v0.294.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const At=T("ArrowDown",[["path",{d:"M12 5v14",key:"s699le"}],["path",{d:"m19 12-7 7-7-7",key:"1idqje"}]]);/**
 * @license lucide-react v0.294.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const _e=T("ArrowUp",[["path",{d:"m5 12 7-7 7 7",key:"hav0vg"}],["path",{d:"M12 19V5",key:"x0mq9r"}]]);/**
 * @license lucide-react v0.294.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Ne=T("BarChart3",[["path",{d:"M3 3v18h18",key:"1s2lah"}],["path",{d:"M18 17V9",key:"2bz60n"}],["path",{d:"M13 17V5",key:"1frdt8"}],["path",{d:"M8 17v-3",key:"17ska0"}]]);/**
 * @license lucide-react v0.294.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const $e=T("Brain",[["path",{d:"M9.5 2A2.5 2.5 0 0 1 12 4.5v15a2.5 2.5 0 0 1-4.96.44 2.5 2.5 0 0 1-2.96-3.08 3 3 0 0 1-.34-5.58 2.5 2.5 0 0 1 1.32-4.24 2.5 2.5 0 0 1 1.98-3A2.5 2.5 0 0 1 9.5 2Z",key:"1mhkh5"}],["path",{d:"M14.5 2A2.5 2.5 0 0 0 12 4.5v15a2.5 2.5 0 0 0 4.96.44 2.5 2.5 0 0 0 2.96-3.08 3 3 0 0 0 .34-5.58 2.5 2.5 0 0 0-1.32-4.24 2.5 2.5 0 0 0-1.98-3A2.5 2.5 0 0 0 14.5 2Z",key:"1d6s00"}]]);/**
 * @license lucide-react v0.294.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const V=T("Calendar",[["rect",{width:"18",height:"18",x:"3",y:"4",rx:"2",ry:"2",key:"eu3xkr"}],["line",{x1:"16",x2:"16",y1:"2",y2:"6",key:"m3sa8f"}],["line",{x1:"8",x2:"8",y1:"2",y2:"6",key:"18kwsl"}],["line",{x1:"3",x2:"21",y1:"10",y2:"10",key:"xt86sb"}]]);/**
 * @license lucide-react v0.294.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const pe=T("CheckCircle2",[["circle",{cx:"12",cy:"12",r:"10",key:"1mglay"}],["path",{d:"m9 12 2 2 4-4",key:"dzmm74"}]]);/**
 * @license lucide-react v0.294.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const ge=T("CheckCircle",[["path",{d:"M22 11.08V12a10 10 0 1 1-5.93-9.14",key:"g774vq"}],["path",{d:"m9 11 3 3L22 4",key:"1pflzl"}]]);/**
 * @license lucide-react v0.294.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const K=T("ChevronDown",[["path",{d:"m6 9 6 6 6-6",key:"qrunsl"}]]);/**
 * @license lucide-react v0.294.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const ve=T("ChevronUp",[["path",{d:"m18 15-6-6-6 6",key:"153udz"}]]);/**
 * @license lucide-react v0.294.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const we=T("Clock",[["circle",{cx:"12",cy:"12",r:"10",key:"1mglay"}],["polyline",{points:"12 6 12 12 16 14",key:"68esgv"}]]);/**
 * @license lucide-react v0.294.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Ee=T("Coins",[["circle",{cx:"8",cy:"8",r:"6",key:"3yglwk"}],["path",{d:"M18.09 10.37A6 6 0 1 1 10.34 18",key:"t5s6rm"}],["path",{d:"M7 6h1v4",key:"1obek4"}],["path",{d:"m16.71 13.88.7.71-2.82 2.82",key:"1rbuyh"}]]);/**
 * @license lucide-react v0.294.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Y=T("CreditCard",[["rect",{width:"20",height:"14",x:"2",y:"5",rx:"2",key:"ynyp8z"}],["line",{x1:"2",x2:"22",y1:"10",y2:"10",key:"1b3vmo"}]]);/**
 * @license lucide-react v0.294.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const ne=T("Database",[["ellipse",{cx:"12",cy:"5",rx:"9",ry:"3",key:"msslwz"}],["path",{d:"M3 5V19A9 3 0 0 0 21 19V5",key:"1wlel7"}],["path",{d:"M3 12A9 3 0 0 0 21 12",key:"mv7ke4"}]]);/**
 * @license lucide-react v0.294.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const O=T("DollarSign",[["line",{x1:"12",x2:"12",y1:"2",y2:"22",key:"7eqyqh"}],["path",{d:"M17 5H9.5a3.5 3.5 0 0 0 0 7h5a3.5 3.5 0 0 1 0 7H6",key:"1b0p4s"}]]);/**
 * @license lucide-react v0.294.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const de=T("Download",[["path",{d:"M21 15v4a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2v-4",key:"ih7n3h"}],["polyline",{points:"7 10 12 15 17 10",key:"2ggqvy"}],["line",{x1:"12",x2:"12",y1:"15",y2:"3",key:"1vk2je"}]]);/**
 * @license lucide-react v0.294.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const fe=T("ExternalLink",[["path",{d:"M18 13v6a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2V8a2 2 0 0 1 2-2h6",key:"a6xqqp"}],["polyline",{points:"15 3 21 3 21 9",key:"mznyad"}],["line",{x1:"10",x2:"21",y1:"14",y2:"3",key:"18c3s4"}]]);/**
 * @license lucide-react v0.294.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const St=T("EyeOff",[["path",{d:"M9.88 9.88a3 3 0 1 0 4.24 4.24",key:"1jxqfv"}],["path",{d:"M10.73 5.08A10.43 10.43 0 0 1 12 5c7 0 10 7 10 7a13.16 13.16 0 0 1-1.67 2.68",key:"9wicm4"}],["path",{d:"M6.61 6.61A13.526 13.526 0 0 0 2 12s3 7 10 7a9.74 9.74 0 0 0 5.39-1.61",key:"1jreej"}],["line",{x1:"2",x2:"22",y1:"2",y2:"22",key:"a6p6uj"}]]);/**
 * @license lucide-react v0.294.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const le=T("Eye",[["path",{d:"M2 12s3-7 10-7 10 7 10 7-3 7-10 7-10-7-10-7Z",key:"rwhkz3"}],["circle",{cx:"12",cy:"12",r:"3",key:"1v7zrd"}]]);/**
 * @license lucide-react v0.294.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const H=T("FileText",[["path",{d:"M14.5 2H6a2 2 0 0 0-2 2v16a2 2 0 0 0 2 2h12a2 2 0 0 0 2-2V7.5L14.5 2z",key:"1nnpy2"}],["polyline",{points:"14 2 14 8 20 8",key:"1ew0cm"}],["line",{x1:"16",x2:"8",y1:"13",y2:"13",key:"14keom"}],["line",{x1:"16",x2:"8",y1:"17",y2:"17",key:"17nazh"}],["line",{x1:"10",x2:"8",y1:"9",y2:"9",key:"1a5vjj"}]]);/**
 * @license lucide-react v0.294.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const z=T("Filter",[["polygon",{points:"22 3 2 3 10 12.46 10 19 14 21 14 12.46 22 3",key:"1yg77f"}]]);/**
 * @license lucide-react v0.294.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const W=T("Globe",[["circle",{cx:"12",cy:"12",r:"10",key:"1mglay"}],["path",{d:"M12 2a14.5 14.5 0 0 0 0 20 14.5 14.5 0 0 0 0-20",key:"13o1zl"}],["path",{d:"M2 12h20",key:"9i4pu4"}]]);/**
 * @license lucide-react v0.294.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const _t=T("Lightbulb",[["path",{d:"M15 14c.2-1 .7-1.7 1.5-2.5 1-.9 1.5-2.2 1.5-3.5A6 6 0 0 0 6 8c0 1 .2 2.2 1.5 3.5.7.7 1.3 1.5 1.5 2.5",key:"1gvzjb"}],["path",{d:"M9 18h6",key:"x1upvd"}],["path",{d:"M10 22h4",key:"ceow96"}]]);/**
 * @license lucide-react v0.294.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const It=T("Percent",[["line",{x1:"19",x2:"5",y1:"5",y2:"19",key:"1x9vlm"}],["circle",{cx:"6.5",cy:"6.5",r:"2.5",key:"4mh3h7"}],["circle",{cx:"17.5",cy:"17.5",r:"2.5",key:"1mdrzq"}]]);/**
 * @license lucide-react v0.294.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const xe=T("PieChart",[["path",{d:"M21.21 15.89A10 10 0 1 1 8 2.83",key:"k2fpak"}],["path",{d:"M22 12A10 10 0 0 0 12 2v10z",key:"1rfc4y"}]]);/**
 * @license lucide-react v0.294.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Oe=T("RefreshCw",[["path",{d:"M3 12a9 9 0 0 1 9-9 9.75 9.75 0 0 1 6.74 2.74L21 8",key:"v9h5vc"}],["path",{d:"M21 3v5h-5",key:"1q7to0"}],["path",{d:"M21 12a9 9 0 0 1-9 9 9.75 9.75 0 0 1-6.74-2.74L3 16",key:"3uifl3"}],["path",{d:"M8 16H3v5",key:"1cv678"}]]);/**
 * @license lucide-react v0.294.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Ce=T("Search",[["circle",{cx:"11",cy:"11",r:"8",key:"4ej97u"}],["path",{d:"m21 21-4.3-4.3",key:"1qie3q"}]]);/**
 * @license lucide-react v0.294.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const J=T("Shield",[["path",{d:"M12 22s8-4 8-10V5l-8-3-8 3v7c0 6 8 10 8 10",key:"1irkt0"}]]);/**
 * @license lucide-react v0.294.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const be=T("Target",[["circle",{cx:"12",cy:"12",r:"10",key:"1mglay"}],["circle",{cx:"12",cy:"12",r:"6",key:"1vlfrh"}],["circle",{cx:"12",cy:"12",r:"2",key:"1c9p78"}]]);/**
 * @license lucide-react v0.294.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Ie=T("TrendingDown",[["polyline",{points:"22 17 13.5 8.5 8.5 13.5 2 7",key:"1r2t7k"}],["polyline",{points:"16 17 22 17 22 11",key:"11uiuu"}]]);/**
 * @license lucide-react v0.294.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const U=T("TrendingUp",[["polyline",{points:"22 7 13.5 15.5 8.5 10.5 2 17",key:"126l90"}],["polyline",{points:"16 7 22 7 22 13",key:"kwv8wd"}]]);/**
 * @license lucide-react v0.294.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const ie=T("Upload",[["path",{d:"M21 15v4a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2v-4",key:"ih7n3h"}],["polyline",{points:"17 8 12 3 7 8",key:"t8dd8p"}],["line",{x1:"12",x2:"12",y1:"3",y2:"15",key:"widbto"}]]);/**
 * @license lucide-react v0.294.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Ue=T("User",[["path",{d:"M19 21v-2a4 4 0 0 0-4-4H9a4 4 0 0 0-4 4v2",key:"975kel"}],["circle",{cx:"12",cy:"7",r:"4",key:"17ys0d"}]]);/**
 * @license lucide-react v0.294.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const q=T("Users",[["path",{d:"M16 21v-2a4 4 0 0 0-4-4H6a4 4 0 0 0-4 4v2",key:"1yyitq"}],["circle",{cx:"9",cy:"7",r:"4",key:"nufk8"}],["path",{d:"M22 21v-2a4 4 0 0 0-3-3.87",key:"kshegd"}],["path",{d:"M16 3.13a4 4 0 0 1 0 7.75",key:"1da9ce"}]]);/**
 * @license lucide-react v0.294.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Ve=T("XCircle",[["circle",{cx:"12",cy:"12",r:"10",key:"1mglay"}],["path",{d:"m15 9-6 6",key:"1uzhvr"}],["path",{d:"m9 9 6 6",key:"z0biqf"}]]);/**
 * @license lucide-react v0.294.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Rt=T("X",[["path",{d:"M18 6 6 18",key:"1bl5f8"}],["path",{d:"m6 6 12 12",key:"d8bk6v"}]]);/**
 * @license lucide-react v0.294.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Mt=T("Zap",[["polygon",{points:"13 2 3 14 12 14 11 22 21 10 12 10 13 2",key:"45s27k"}]]),Tt=({onFileUpload:l,loading:s})=>{const[n,t]=R.useState(!1),[r,i]=R.useState(null),a=R.useRef(null),c=u=>{u.preventDefault(),u.stopPropagation(),u.type==="dragenter"||u.type==="dragover"?t(!0):u.type==="dragleave"&&t(!1)},p=u=>{if(u.preventDefault(),u.stopPropagation(),t(!1),u.dataTransfer.files&&u.dataTransfer.files[0]){const g=u.dataTransfer.files[0];f(g)}},f=u=>{if(!u.name.toLowerCase().endsWith(".csv")){alert("Пожалуйста, выберите CSV файл");return}i(u),l(u)},j=u=>{u.target.files&&u.target.files[0]&&f(u.target.files[0])},S=()=>{var u;(u=a.current)==null||u.click()};return e.jsxs("div",{className:"w-full max-w-2xl mx-auto",children:[e.jsxs("div",{className:`relative border-2 border-dashed rounded-2xl p-8 transition-all duration-300 ${n?"border-blue-400 bg-blue-500/10":"border-white/20 bg-white/5 hover:bg-white/10"}`,onDragEnter:c,onDragLeave:c,onDragOver:c,onDrop:p,children:[e.jsx("input",{ref:a,type:"file",accept:".csv",onChange:j,className:"hidden"}),e.jsxs("div",{className:"text-center space-y-4",children:[e.jsx("div",{className:"w-16 h-16 bg-gradient-to-br from-blue-500 to-purple-600 rounded-full flex items-center justify-center mx-auto",children:s?e.jsx("div",{className:"w-6 h-6 border-2 border-white border-t-transparent rounded-full animate-spin"}):r?e.jsx(ge,{className:"w-8 h-8 text-white"}):e.jsx(ie,{className:"w-8 h-8 text-white"})}),e.jsxs("div",{children:[e.jsx("h3",{className:"text-xl font-semibold text-white mb-2",children:s?"Обработка файла...":r?"Файл загружен":"Загрузите CSV файл"}),e.jsx("p",{className:"text-gray-300",children:s?"Пожалуйста, подождите...":r?r.name:"Перетащите файл сюда или нажмите кнопку"})]}),!r&&!s&&e.jsx("button",{onClick:S,className:"px-6 py-3 bg-gradient-to-r from-blue-500 to-purple-600 text-white rounded-xl hover:from-blue-600 hover:to-purple-700 transition-all duration-200 font-semibold",children:"Выбрать CSV файл"}),!r&&!s&&e.jsxs("div",{className:"mt-6 p-4 bg-white/5 rounded-xl",children:[e.jsx("h4",{className:"text-sm font-semibold text-white mb-2",children:"Поддерживаемые форматы:"}),e.jsxs("div",{className:"flex items-center justify-center space-x-2 text-sm text-gray-300",children:[e.jsx(H,{className:"w-4 h-4 text-blue-400"}),e.jsx("span",{children:"CSV файлы (.csv)"})]})]}),s&&e.jsx("div",{className:"mt-4 p-4 bg-blue-500/10 border border-blue-500/20 rounded-xl",children:e.jsxs("div",{className:"flex items-center space-x-3",children:[e.jsx("div",{className:"w-4 h-4 border-2 border-blue-400 border-t-transparent rounded-full animate-spin"}),e.jsx("span",{className:"text-blue-300",children:"Анализируем данные..."})]})}),r&&!s&&e.jsx("div",{className:"mt-4 p-4 bg-green-500/10 border border-green-500/20 rounded-xl",children:e.jsxs("div",{className:"flex items-center space-x-3",children:[e.jsx(ge,{className:"w-5 h-5 text-green-400"}),e.jsxs("div",{children:[e.jsx("span",{className:"text-green-300 font-medium",children:"Файл успешно загружен"}),e.jsx("p",{className:"text-green-300/70 text-sm",children:r.name})]})]})})]})]}),e.jsx("div",{className:"mt-6 space-y-3",children:e.jsxs("div",{className:"flex items-start space-x-3 p-4 bg-yellow-500/10 border border-yellow-500/20 rounded-xl",children:[e.jsx(je,{className:"w-5 h-5 text-yellow-400 mt-0.5"}),e.jsxs("div",{className:"text-sm text-yellow-300",children:[e.jsx("p",{className:"font-medium mb-1",children:"Важно:"}),e.jsxs("ul",{className:"space-y-1",children:[e.jsx("li",{children:"• Файл должен быть в формате CSV"}),e.jsx("li",{children:"• Файл должен содержать заголовки в первой строке"}),e.jsx("li",{children:"• Поддерживаются разделители: запятая (,), точка с запятой (;)"}),e.jsx("li",{children:"• Максимальный размер файла: 10 МБ"})]})]})]})})]})},Ft=({metrics:l,dataType:s="merchant"})=>{if(!l)return null;const n="TRY",t="TRY",r=s==="merchant"?"провайдера":"платформы",i=p=>new Intl.NumberFormat("tr-TR",{style:"currency",currency:t,minimumFractionDigits:0,maximumFractionDigits:0}).format(p),c=[{title:"Всего операций",value:l.total.toLocaleString("tr-TR"),icon:G,color:"from-blue-500 to-cyan-500",bgColor:"bg-blue-500/20",borderColor:"border-blue-500/30"},{title:"Успешные",value:l.successful.toLocaleString("tr-TR"),subtitle:`${l.conversionRate.toFixed(1)}% конверсия`,icon:ge,color:"from-green-500 to-emerald-500",bgColor:"bg-green-500/20",borderColor:"border-green-500/30"},{title:"Неудачные",value:l.failed.toLocaleString("tr-TR"),subtitle:`${(l.failed/l.total*100).toFixed(1)}% отказов`,icon:Ve,color:"from-red-500 to-pink-500",bgColor:"bg-red-500/20",borderColor:"border-red-500/30"},{title:"Отмененные",value:l.canceled.toLocaleString("tr-TR"),subtitle:s==="merchant"?`${(l.canceled/l.total*100).toFixed(1)}% отмен`:"Не применимо",icon:we,color:"from-yellow-500 to-orange-500",bgColor:"bg-yellow-500/20",borderColor:"border-yellow-500/30",hidden:s==="platform"},{title:"Общая выручка",value:i(l.successfulRevenue),subtitle:"Только успешные операции",icon:O,color:"from-emerald-500 to-teal-500",bgColor:"bg-emerald-500/20",borderColor:"border-emerald-500/30"},{title:"Потерянная выручка",value:i(l.lostRevenue),subtitle:"Неудачные и отмененные",icon:Ie,color:"from-red-500 to-rose-500",bgColor:"bg-red-500/20",borderColor:"border-red-500/30"},{title:"Общая сумма",value:i(l.totalAmount),subtitle:"Все операции",icon:O,color:"from-purple-500 to-indigo-500",bgColor:"bg-purple-500/20",borderColor:"border-purple-500/30"},{title:"Комиссии",value:i(l.totalFees),subtitle:"Общая сумма комиссий",icon:O,color:"from-indigo-500 to-blue-500",bgColor:"bg-indigo-500/20",borderColor:"border-indigo-500/30"},{title:"Средняя сумма",value:i(l.averageAmount),subtitle:"Среднее по всем операциям",icon:U,color:"from-cyan-500 to-blue-500",bgColor:"bg-cyan-500/20",borderColor:"border-cyan-500/30"},{title:"Депозиты",value:l.depositMetrics.total.toLocaleString("tr-TR"),subtitle:`${i(l.depositMetrics.amount)} • ${l.depositMetrics.successful} успешных`,icon:U,color:"from-green-500 to-emerald-500",bgColor:"bg-green-500/20",borderColor:"border-green-500/30"},{title:"Сумма успешных депозитов",value:i(l.depositMetrics.successfulAmount||0),subtitle:`${l.depositMetrics.successful||0} операций`,icon:O,color:"from-green-500 to-emerald-500",bgColor:"bg-green-500/20",borderColor:"border-green-500/30",hidden:!l.depositMetrics||l.depositMetrics.total===0},{title:"Выплаты",value:l.withdrawalMetrics.total.toLocaleString("tr-TR"),subtitle:`${i(l.withdrawalMetrics.amount)} • ${l.withdrawalMetrics.successful} успешных`,icon:Ie,color:"from-orange-500 to-red-500",bgColor:"bg-orange-500/20",borderColor:"border-orange-500/30"},{title:"Сумма успешных выплат",value:i(l.withdrawalMetrics.successfulAmount||0),subtitle:`${l.withdrawalMetrics.successful||0} операций`,icon:O,color:"from-green-500 to-emerald-500",bgColor:"bg-green-500/20",borderColor:"border-green-500/30",hidden:!l.withdrawalMetrics||l.withdrawalMetrics.total===0},{title:"Максимальная сумма",value:i(l.maxAmount),subtitle:"Самая крупная операция",icon:U,color:"from-pink-500 to-rose-500",bgColor:"bg-pink-500/20",borderColor:"border-pink-500/30"}].filter(p=>!p.hidden);return e.jsxs("div",{className:"space-y-6",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsx("h2",{className:"text-2xl font-bold text-white",children:"Ключевые метрики"}),e.jsxs("p",{className:"text-gray-300",children:["Основные показатели по ",r," • Валюта: ",n]})]}),e.jsxs("div",{className:"flex items-center space-x-2 px-3 py-1 bg-white/10 rounded-full",children:[e.jsx("div",{className:"w-2 h-2 bg-green-400 rounded-full"}),e.jsx("span",{className:"text-sm text-white",children:"Актуальные данные"})]})]}),e.jsx("div",{className:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 xl:grid-cols-4 gap-6",children:c.map((p,f)=>e.jsxs("div",{className:`bg-white/5 backdrop-blur-xl rounded-2xl p-6 border border-white/10 ${p.borderColor} hover:bg-white/10 transition-all duration-300`,children:[e.jsx("div",{className:`w-12 h-12 bg-gradient-to-br ${p.color} rounded-xl flex items-center justify-center mb-4`,children:e.jsx(p.icon,{className:"w-6 h-6 text-white"})}),e.jsxs("div",{className:"mb-2",children:[e.jsx("div",{className:"text-2xl font-bold text-white",children:p.value}),e.jsx("div",{className:"text-lg font-semibold text-gray-300",children:p.title})]}),p.subtitle&&e.jsx("div",{className:"text-sm text-gray-400",children:p.subtitle})]},f))}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-3 gap-6",children:[s==="merchant"&&Object.keys(l.companyStats).length>0&&e.jsxs("div",{className:"bg-white/5 backdrop-blur-xl rounded-2xl p-6 border border-white/10",children:[e.jsxs("h3",{className:"text-lg font-semibold text-white mb-4 flex items-center",children:[e.jsx(q,{className:"w-5 h-5 mr-2 text-blue-400"}),"Топ компаний"]}),e.jsx("div",{className:"space-y-3",children:Object.entries(l.companyStats).sort(([,p],[,f])=>f.revenue-p.revenue).slice(0,3).map(([p,f],j)=>e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{className:"flex items-center space-x-3",children:[e.jsx("div",{className:"w-6 h-6 bg-gradient-to-br from-blue-500 to-purple-600 rounded-full flex items-center justify-center text-xs font-bold text-white",children:j+1}),e.jsxs("div",{children:[e.jsx("div",{className:"text-sm font-medium text-white",children:p}),e.jsxs("div",{className:"text-xs text-gray-400",children:[f.total," операций"]})]})]}),e.jsxs("div",{className:"text-right",children:[e.jsx("div",{className:"text-sm font-semibold text-white",children:i(f.revenue)}),e.jsxs("div",{className:"text-xs text-gray-400",children:[(f.completed/f.total*100).toFixed(1),"% успех"]})]})]},p))})]}),Object.keys(l.paymentMethodStats).length>0&&e.jsxs("div",{className:"bg-white/5 backdrop-blur-xl rounded-2xl p-6 border border-white/10",children:[e.jsxs("h3",{className:"text-lg font-semibold text-white mb-4 flex items-center",children:[e.jsx(G,{className:"w-5 h-5 mr-2 text-green-400"}),"Методы оплаты"]}),e.jsx("div",{className:"space-y-3",children:Object.entries(l.paymentMethodStats).sort(([,p],[,f])=>f.total-p.total).slice(0,3).map(([p,f],j)=>e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{className:"flex items-center space-x-3",children:[e.jsx("div",{className:"w-6 h-6 bg-gradient-to-br from-green-500 to-emerald-600 rounded-full flex items-center justify-center text-xs font-bold text-white",children:j+1}),e.jsxs("div",{children:[e.jsx("div",{className:"text-sm font-medium text-white",children:p}),e.jsxs("div",{className:"text-xs text-gray-400",children:[f.total," операций"]})]})]}),e.jsxs("div",{className:"text-right",children:[e.jsx("div",{className:"text-sm font-semibold text-white",children:f.completed}),e.jsxs("div",{className:"text-xs text-gray-400",children:[(f.completed/f.total*100).toFixed(1),"% успех"]})]})]},p))})]}),e.jsxs("div",{className:"bg-white/5 backdrop-blur-xl rounded-2xl p-6 border border-white/10",children:[e.jsxs("h3",{className:"text-lg font-semibold text-white mb-4 flex items-center",children:[e.jsx(U,{className:"w-5 h-5 mr-2 text-purple-400"}),"Эффективность"]}),e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{children:[e.jsxs("div",{className:"flex justify-between text-sm mb-1",children:[e.jsx("span",{className:"text-gray-300",children:"Конверсия"}),e.jsxs("span",{className:"text-white font-semibold",children:[l.conversionRate.toFixed(1),"%"]})]}),e.jsx("div",{className:"w-full bg-gray-700 rounded-full h-2",children:e.jsx("div",{className:"bg-gradient-to-r from-green-500 to-emerald-500 h-2 rounded-full transition-all duration-500",style:{width:`${Math.min(l.conversionRate,100)}%`}})})]}),e.jsx("div",{children:e.jsxs("div",{className:"flex justify-between text-sm mb-1",children:[e.jsx("span",{className:"text-gray-300",children:"Средняя сумма"}),e.jsx("span",{className:"text-white font-semibold",children:i(l.averageAmount)})]})}),e.jsx("div",{children:e.jsxs("div",{className:"flex justify-between text-sm mb-1",children:[e.jsx("span",{className:"text-gray-300",children:"Комиссии"}),e.jsx("span",{className:"text-white font-semibold",children:i(l.totalFees)})]})})]})]})]})]})},Dt=({data:l,metrics:s,dataType:n="merchant"})=>{const[t,r]=R.useState("overview"),i="TRY",a="TRY",c=d=>new Intl.NumberFormat("tr-TR",{style:"currency",currency:a,minimumFractionDigits:0,maximumFractionDigits:0}).format(d),p=gt(l),f=ft(l,n),j=bt(l,n),S=n==="merchant"?yt(l):{},u=jt(l),g=Nt(l),x=vt(l,10),N=[{id:"overview",label:"Обзор",icon:Ne},{id:"status",label:"Статусы",icon:xe},{id:"amounts",label:"Суммы",icon:O},{id:"companies",label:"Компании",icon:q,hidden:n==="platform"},{id:"methods",label:"Методы оплаты",icon:Y},{id:"timeline",label:"Временная линия",icon:V},{id:"users",label:"Пользователи",icon:q}].filter(d=>!d.hidden),h=()=>e.jsxs("div",{className:"grid grid-cols-1 lg:grid-cols-2 gap-6",children:[e.jsxs("div",{className:"bg-white/5 backdrop-blur-xl rounded-2xl p-6 border border-white/10",children:[e.jsxs("h3",{className:"text-lg font-semibold text-white mb-4 flex items-center",children:[e.jsx(xe,{className:"w-5 h-5 mr-2 text-blue-400"}),"Распределение по статусам"]}),e.jsx("div",{className:"space-y-3",children:Object.entries(j).map(([d,C],A)=>{const m=(C/l.length*100).toFixed(1),M={completed:"from-green-500 to-emerald-500",success:"from-green-500 to-emerald-500",failed:"from-red-500 to-pink-500",fail:"from-red-500 to-pink-500",canceled:"from-yellow-500 to-orange-500"}[d.toLowerCase()]||"from-gray-500 to-gray-600";return e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{className:"flex items-center space-x-3",children:[e.jsx("div",{className:`w-4 h-4 bg-gradient-to-r ${M} rounded-full`}),e.jsx("span",{className:"text-sm font-medium text-white capitalize",children:d==="completed"?"Завершено":d==="success"?"Успешно":d==="failed"?"Неудачно":d==="fail"?"Ошибка":d==="canceled"?"Отменено":d})]}),e.jsxs("div",{className:"text-right",children:[e.jsx("div",{className:"text-sm font-semibold text-white",children:C}),e.jsxs("div",{className:"text-xs text-gray-400",children:[m,"%"]})]})]},d)})})]}),e.jsxs("div",{className:"bg-white/5 backdrop-blur-xl rounded-2xl p-6 border border-white/10",children:[e.jsxs("h3",{className:"text-lg font-semibold text-white mb-4 flex items-center",children:[e.jsx(O,{className:"w-5 h-5 mr-2 text-green-400"}),"Распределение по суммам"]}),e.jsx("div",{className:"space-y-3",children:Object.entries(p).map(([d,C],A)=>{const m=(C/l.length*100).toFixed(1),I=["from-blue-500 to-cyan-500","from-cyan-500 to-teal-500","from-teal-500 to-emerald-500","from-emerald-500 to-green-500","from-green-500 to-lime-500"];return e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{className:"flex items-center space-x-3",children:[e.jsx("div",{className:`w-4 h-4 bg-gradient-to-r ${I[A%I.length]} rounded-full`}),e.jsxs("span",{className:"text-sm font-medium text-white",children:[d," ",i]})]}),e.jsxs("div",{className:"text-right",children:[e.jsx("div",{className:"text-sm font-semibold text-white",children:C}),e.jsxs("div",{className:"text-xs text-gray-400",children:[m,"%"]})]})]},d)})})]})]}),k=()=>e.jsxs("div",{className:"bg-white/5 backdrop-blur-xl rounded-2xl p-6 border border-white/10",children:[e.jsxs("h3",{className:"text-lg font-semibold text-white mb-6 flex items-center",children:[e.jsx(xe,{className:"w-5 h-5 mr-2 text-blue-400"}),"Детальная статистика по статусам"]}),e.jsx("div",{className:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-6",children:Object.entries(j).map(([d,C],A)=>{const m=(C/l.length*100).toFixed(1),M={completed:"from-green-500 to-emerald-500",success:"from-green-500 to-emerald-500",failed:"from-red-500 to-pink-500",fail:"from-red-500 to-pink-500",canceled:"from-yellow-500 to-orange-500"}[d.toLowerCase()]||"from-gray-500 to-gray-600",D=d==="completed"?"Завершено":d==="success"?"Успешно":d==="failed"?"Неудачно":d==="fail"?"Ошибка":d==="canceled"?"Отменено":d;return e.jsxs("div",{className:"text-center p-4 bg-white/5 rounded-xl",children:[e.jsx("div",{className:`w-16 h-16 bg-gradient-to-br ${M} rounded-full flex items-center justify-center mx-auto mb-3`,children:e.jsx("span",{className:"text-white font-bold text-lg",children:C})}),e.jsx("div",{className:"text-white font-semibold mb-1",children:D}),e.jsxs("div",{className:"text-gray-400 text-sm",children:[m,"%"]})]},d)})})]}),w=()=>e.jsxs("div",{className:"space-y-6",children:[e.jsxs("div",{className:"bg-white/5 backdrop-blur-xl rounded-2xl p-6 border border-white/10",children:[e.jsxs("h3",{className:"text-lg font-semibold text-white mb-4 flex items-center",children:[e.jsx(O,{className:"w-5 h-5 mr-2 text-green-400"}),"Распределение операций по суммам"]}),e.jsx("div",{className:"space-y-4",children:Object.entries(p).map(([d,C],A)=>{const m=(C/l.length*100).toFixed(1),I=["from-blue-500 to-cyan-500","from-cyan-500 to-teal-500","from-teal-500 to-emerald-500","from-emerald-500 to-green-500","from-green-500 to-lime-500"];return e.jsxs("div",{className:"space-y-2",children:[e.jsxs("div",{className:"flex justify-between text-sm",children:[e.jsxs("span",{className:"text-white",children:[d," ",i]}),e.jsxs("span",{className:"text-gray-400",children:[C," операций (",m,"%)"]})]}),e.jsx("div",{className:"w-full bg-gray-700 rounded-full h-3",children:e.jsx("div",{className:`h-3 rounded-full bg-gradient-to-r ${I[A%I.length]} transition-all duration-500`,style:{width:`${m}%`}})})]},d)})})]}),e.jsxs("div",{className:"bg-white/5 backdrop-blur-xl rounded-2xl p-6 border border-white/10",children:[e.jsxs("h3",{className:"text-lg font-semibold text-white mb-4 flex items-center",children:[e.jsx(U,{className:"w-5 h-5 mr-2 text-purple-400"}),"Конверсия по диапазонам сумм"]}),e.jsx("div",{className:"space-y-4",children:f.map((d,C)=>{const A=["from-blue-500 to-cyan-500","from-cyan-500 to-teal-500","from-teal-500 to-emerald-500","from-emerald-500 to-green-500","from-green-500 to-lime-500"];return e.jsxs("div",{className:"space-y-2",children:[e.jsxs("div",{className:"flex justify-between text-sm",children:[e.jsxs("span",{className:"text-white",children:[d.range," ",i]}),e.jsxs("span",{className:"text-gray-400",children:[d.conversion.toFixed(1),"% конверсия"]})]}),e.jsx("div",{className:"w-full bg-gray-700 rounded-full h-3",children:e.jsx("div",{className:`h-3 rounded-full bg-gradient-to-r ${A[C%A.length]} transition-all duration-500`,style:{width:`${Math.min(d.conversion,100)}%`}})}),e.jsxs("div",{className:"text-xs text-gray-400",children:[d.successful," из ",d.total," операций успешны"]})]},d.range)})})]})]}),_=()=>e.jsxs("div",{className:"bg-white/5 backdrop-blur-xl rounded-2xl p-6 border border-white/10",children:[e.jsxs("h3",{className:"text-lg font-semibold text-white mb-4 flex items-center",children:[e.jsx(q,{className:"w-5 h-5 mr-2 text-blue-400"}),"Топ компаний по выручке"]}),e.jsx("div",{className:"space-y-4",children:Object.entries(S).sort(([,d],[,C])=>C-d).slice(0,10).map(([d,C],A)=>{const m=(C/l.length*100).toFixed(1),I=["from-blue-500 to-cyan-500","from-cyan-500 to-teal-500","from-teal-500 to-emerald-500","from-emerald-500 to-green-500","from-green-500 to-lime-500"];return e.jsxs("div",{className:"space-y-2",children:[e.jsxs("div",{className:"flex justify-between text-sm",children:[e.jsx("span",{className:"text-white",children:d}),e.jsxs("span",{className:"text-gray-400",children:[C," операций (",m,"%)"]})]}),e.jsx("div",{className:"w-full bg-gray-700 rounded-full h-3",children:e.jsx("div",{className:`h-3 rounded-full bg-gradient-to-r ${I[A%I.length]} transition-all duration-500`,style:{width:`${m}%`}})})]},d)})})]}),o=()=>e.jsxs("div",{className:"bg-white/5 backdrop-blur-xl rounded-2xl p-6 border border-white/10",children:[e.jsxs("h3",{className:"text-lg font-semibold text-white mb-4 flex items-center",children:[e.jsx(Y,{className:"w-5 h-5 mr-2 text-green-400"}),"Распределение по методам оплаты"]}),e.jsx("div",{className:"space-y-4",children:Object.entries(u).sort(([,d],[,C])=>C-d).slice(0,10).map(([d,C],A)=>{const m=(C/l.length*100).toFixed(1),I=["from-blue-500 to-cyan-500","from-cyan-500 to-teal-500","from-teal-500 to-emerald-500","from-emerald-500 to-green-500","from-green-500 to-lime-500"];return e.jsxs("div",{className:"space-y-2",children:[e.jsxs("div",{className:"flex justify-between text-sm",children:[e.jsx("span",{className:"text-white",children:d}),e.jsxs("span",{className:"text-gray-400",children:[C," операций (",m,"%)"]})]}),e.jsx("div",{className:"w-full bg-gray-700 rounded-full h-3",children:e.jsx("div",{className:`h-3 rounded-full bg-gradient-to-r ${I[A%I.length]} transition-all duration-500`,style:{width:`${m}%`}})})]},d)})})]}),y=()=>e.jsxs("div",{className:"bg-white/5 backdrop-blur-xl rounded-2xl p-6 border border-white/10",children:[e.jsxs("h3",{className:"text-lg font-semibold text-white mb-4 flex items-center",children:[e.jsx(V,{className:"w-5 h-5 mr-2 text-purple-400"}),"Динамика операций по времени"]}),e.jsx("div",{className:"space-y-4",children:g.slice(-10).map((d,C)=>{const A=["from-blue-500 to-cyan-500","from-cyan-500 to-teal-500","from-teal-500 to-emerald-500","from-emerald-500 to-green-500","from-green-500 to-lime-500"];return e.jsxs("div",{className:"space-y-2",children:[e.jsxs("div",{className:"flex justify-between text-sm",children:[e.jsx("span",{className:"text-white",children:d.date}),e.jsxs("span",{className:"text-gray-400",children:[d.total," операций • ",d.conversionRate.toFixed(1),"% конверсия"]})]}),e.jsx("div",{className:"w-full bg-gray-700 rounded-full h-3",children:e.jsx("div",{className:`h-3 rounded-full bg-gradient-to-r ${A[C%A.length]} transition-all duration-500`,style:{width:`${Math.min(d.total/Math.max(...g.map(m=>m.total))*100,100)}%`}})}),e.jsxs("div",{className:"text-xs text-gray-400",children:["Успешно: ",d.completed," • Неудачно: ",d.failed,n==="merchant"&&d.canceled>0&&` • Отменено: ${d.canceled}`]})]},d.date)})})]}),b=()=>e.jsxs("div",{className:"bg-white/5 backdrop-blur-xl rounded-2xl p-6 border border-white/10",children:[e.jsxs("h3",{className:"text-lg font-semibold text-white mb-4 flex items-center",children:[e.jsx(q,{className:"w-5 h-5 mr-2 text-indigo-400"}),"Топ пользователей по объему операций"]}),e.jsx("div",{className:"space-y-4",children:x.map((d,C)=>{const A=["from-blue-500 to-cyan-500","from-cyan-500 to-teal-500","from-teal-500 to-emerald-500","from-emerald-500 to-green-500","from-green-500 to-lime-500"];return e.jsxs("div",{className:"space-y-2",children:[e.jsxs("div",{className:"flex justify-between text-sm",children:[e.jsxs("div",{className:"flex items-center space-x-3",children:[e.jsx("div",{className:"w-6 h-6 bg-gradient-to-br from-indigo-500 to-purple-600 rounded-full flex items-center justify-center text-xs font-bold text-white",children:C+1}),e.jsx("span",{className:"text-white",children:d.name})]}),e.jsxs("span",{className:"text-gray-400",children:[c(d.totalAmount)," • ",d.total," операций"]})]}),e.jsx("div",{className:"w-full bg-gray-700 rounded-full h-3",children:e.jsx("div",{className:`h-3 rounded-full bg-gradient-to-r ${A[C%A.length]} transition-all duration-500`,style:{width:`${Math.min(d.totalAmount/Math.max(...x.map(m=>m.totalAmount))*100,100)}%`}})}),e.jsxs("div",{className:"text-xs text-gray-400",children:["Успешно: ",d.completed," • Неудачно: ",d.failed,n==="merchant"&&d.canceled>0&&` • Отменено: ${d.canceled}`]})]},d.id)})})]}),v=()=>{switch(t){case"overview":return h();case"status":return k();case"amounts":return w();case"companies":return _();case"methods":return o();case"timeline":return y();case"users":return b();default:return h()}};return e.jsxs("div",{className:"space-y-6",children:[e.jsx("div",{className:"flex items-center justify-between",children:e.jsxs("div",{children:[e.jsx("h2",{className:"text-2xl font-bold text-white",children:"Аналитика и графики"}),e.jsxs("p",{className:"text-gray-300",children:["Детальная визуализация данных • ",l.length," записей • Валюта: ",i]})]})}),e.jsx("div",{className:"flex flex-wrap gap-2",children:N.map(d=>e.jsxs("button",{onClick:()=>r(d.id),className:`px-4 py-2 rounded-lg font-medium transition-all duration-200 flex items-center space-x-2 ${t===d.id?"bg-gradient-to-r from-blue-500 to-purple-600 text-white":"bg-white/10 text-gray-300 hover:bg-white/20"}`,children:[e.jsx(d.icon,{className:"w-4 h-4"}),e.jsx("span",{children:d.label})]},d.id))}),e.jsx("div",{className:"animate-fade-in",children:v()})]})},Lt=({data:l,dataType:s="merchant"})=>{const[n,t]=R.useState({key:null,direction:"asc"}),[r,i]=R.useState(""),[a,c]=R.useState(1),[p]=R.useState(20);R.useEffect(()=>{c(1)},[r,l]);const f="TRY",j="TRY",S=d=>new Intl.NumberFormat("tr-TR",{style:"currency",currency:j,minimumFractionDigits:0,maximumFractionDigits:0}).format(d),u=d=>{if(!d)return"-";try{return new Date(d).toLocaleString("tr-TR")}catch{return d}},g=d=>{const C=d?d.toLowerCase():"";if(s==="merchant")switch(C){case"completed":return"bg-green-500/20 text-green-300 border-green-500/30";case"failed":return"bg-red-500/20 text-red-300 border-red-500/30";case"canceled":return"bg-yellow-500/20 text-yellow-300 border-yellow-500/30";default:return"bg-gray-500/20 text-gray-300 border-gray-500/30"}else switch(C){case"success":return"bg-green-500/20 text-green-300 border-green-500/30";case"fail":return"bg-red-500/20 text-red-300 border-red-500/30";default:return"bg-gray-500/20 text-gray-300 border-gray-500/30"}},x=d=>{const C=d?d.toLowerCase():"";if(s==="merchant")switch(C){case"completed":return"Завершено";case"failed":return"Неудачно";case"canceled":return"Отменено";default:return d||"Неизвестно"}else switch(C){case"success":return"Успешно";case"fail":return"Ошибка";default:return d||"Неизвестно"}},N=l.filter(d=>{const C=r.toLowerCase();return d.id&&d.id.toLowerCase().includes(C)||d.status&&d.status.toLowerCase().includes(C)||d.company&&d.company.toLowerCase().includes(C)||d.userName&&d.userName.toLowerCase().includes(C)||d.paymentMethod&&d.paymentMethod.toLowerCase().includes(C)||d.amount&&d.amount.toString().includes(C)}),h=[...N].sort((d,C)=>{if(!n.key)return 0;let A=d[n.key],m=C[n.key];return(n.key==="amount"||n.key==="fee")&&(A=parseFloat(A)||0,m=parseFloat(m)||0),(n.key==="createdAt"||n.key==="processedAt")&&(A=new Date(A||0),m=new Date(m||0)),A<m?n.direction==="asc"?-1:1:A>m?n.direction==="asc"?1:-1:0}),k=Math.ceil(h.length/p),w=(a-1)*p,_=w+p,o=h.slice(w,_),y=d=>{t(C=>({key:d,direction:C.key===d&&C.direction==="asc"?"desc":"asc"}))},b=({columnKey:d})=>n.key!==d?e.jsx(K,{className:"w-4 h-4 text-gray-400"}):n.direction==="asc"?e.jsx(ve,{className:"w-4 h-4 text-blue-400"}):e.jsx(K,{className:"w-4 h-4 text-blue-400"}),v=[{key:"id",label:"ID",sortable:!0},{key:"status",label:"Статус",sortable:!0},{key:"amount",label:"Сумма",sortable:!0},{key:"company",label:"Компания",sortable:!0,hidden:s==="platform"},{key:"userName",label:"Пользователь",sortable:!0},{key:"paymentMethod",label:"Метод оплаты",sortable:!0},{key:"createdAt",label:"Дата создания",sortable:!0},{key:"fee",label:"Комиссия",sortable:!0}].filter(d=>!d.hidden);return e.jsxs("div",{className:"space-y-6",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsx("h2",{className:"text-2xl font-bold text-white",children:"Детальные данные"}),e.jsxs("p",{className:"text-gray-300",children:[N.length," записей из ",l.length," • Валюта: ",f]})]}),e.jsxs("button",{className:"px-4 py-2 bg-gradient-to-r from-green-500 to-emerald-600 text-white rounded-lg hover:from-green-600 hover:to-emerald-700 transition-all duration-200 flex items-center space-x-2",children:[e.jsx(de,{className:"w-4 h-4"}),e.jsx("span",{children:"Экспорт"})]})]}),e.jsxs("div",{className:"flex flex-col sm:flex-row gap-4",children:[e.jsxs("div",{className:"relative flex-1",children:[e.jsx(Ce,{className:"absolute left-3 top-1/2 transform -translate-y-1/2 w-4 h-4 text-gray-400"}),e.jsx("input",{type:"text",placeholder:"Поиск по ID, статусу, компании, пользователю...",value:r,onChange:d=>i(d.target.value),className:"w-full pl-10 pr-4 py-2 bg-white/10 border border-white/20 rounded-lg text-white placeholder-gray-400 focus:outline-none focus:ring-2 focus:ring-blue-500 focus:border-transparent"})]}),e.jsxs("div",{className:"flex items-center space-x-2",children:[e.jsx(z,{className:"w-4 h-4 text-gray-400"}),e.jsxs("span",{className:"text-sm text-gray-400",children:[N.length," результатов"]})]})]}),e.jsxs("div",{className:"bg-white/5 backdrop-blur-xl rounded-2xl border border-white/10 overflow-hidden",children:[e.jsx("div",{className:"overflow-x-auto",children:e.jsxs("table",{className:"w-full",children:[e.jsx("thead",{className:"bg-white/10",children:e.jsx("tr",{children:v.map(d=>e.jsx("th",{className:`px-6 py-4 text-left text-sm font-semibold text-white ${d.sortable?"cursor-pointer hover:bg-white/10":""}`,onClick:()=>d.sortable&&y(d.key),children:e.jsxs("div",{className:"flex items-center space-x-2",children:[e.jsx("span",{children:d.label}),d.sortable&&e.jsx(b,{columnKey:d.key})]})},d.key))})}),e.jsx("tbody",{className:"divide-y divide-white/10",children:o.map((d,C)=>e.jsxs("tr",{className:"hover:bg-white/5 transition-colors duration-200",children:[e.jsx("td",{className:"px-6 py-4 text-sm text-white font-mono",children:d.id||"-"}),e.jsx("td",{className:"px-6 py-4",children:e.jsx("span",{className:`inline-flex items-center px-2 py-1 rounded-full text-xs font-medium border ${g(d.status)}`,children:x(d.status)})}),e.jsx("td",{className:"px-6 py-4 text-sm text-white font-semibold",children:S(d.amount)}),s==="merchant"&&e.jsx("td",{className:"px-6 py-4 text-sm text-gray-300",children:d.company||"-"}),e.jsx("td",{className:"px-6 py-4 text-sm text-gray-300",children:e.jsxs("div",{children:[e.jsx("div",{className:"font-medium text-white",children:d.fullName||d.userName||"-"}),d.userId&&e.jsxs("div",{className:"text-xs text-gray-400",children:["ID: ",d.userId]})]})}),e.jsx("td",{className:"px-6 py-4 text-sm text-gray-300",children:d.paymentMethod||"-"}),e.jsx("td",{className:"px-6 py-4 text-sm text-gray-300",children:u(d.createdAt)}),e.jsx("td",{className:"px-6 py-4 text-sm text-gray-300",children:d.fee?S(d.fee):"-"})]},d.id||C))})]})}),k>1&&e.jsx("div",{className:"px-6 py-4 bg-white/5 border-t border-white/10",children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{className:"text-sm text-gray-400",children:["Показано ",w+1,"-",Math.min(_,N.length)," из ",N.length," записей"]}),e.jsxs("div",{className:"flex items-center space-x-2",children:[e.jsx("button",{onClick:()=>c(d=>Math.max(d-1,1)),disabled:a===1,className:"px-3 py-1 bg-white/10 text-white rounded-lg hover:bg-white/20 disabled:opacity-50 disabled:cursor-not-allowed transition-colors duration-200",children:"Назад"}),e.jsx("div",{className:"flex items-center space-x-1",children:Array.from({length:Math.min(5,k)},(d,C)=>{const A=C+1;return e.jsx("button",{onClick:()=>c(A),className:`px-3 py-1 rounded-lg transition-colors duration-200 ${a===A?"bg-blue-500 text-white":"bg-white/10 text-gray-300 hover:bg-white/20"}`,children:A},A)})}),e.jsx("button",{onClick:()=>c(d=>Math.min(d+1,k)),disabled:a===k,className:"px-3 py-1 bg-white/10 text-white rounded-lg hover:bg-white/20 disabled:opacity-50 disabled:cursor-not-allowed transition-colors duration-200",children:"Вперед"})]})]})})]}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-3 gap-4",children:[e.jsxs("div",{className:"bg-white/5 backdrop-blur-xl rounded-xl p-4 border border-white/10",children:[e.jsx("div",{className:"text-sm text-gray-400",children:"Всего записей"}),e.jsx("div",{className:"text-2xl font-bold text-white",children:l.length})]}),e.jsxs("div",{className:"bg-white/5 backdrop-blur-xl rounded-xl p-4 border border-white/10",children:[e.jsx("div",{className:"text-sm text-gray-400",children:"Отфильтровано"}),e.jsx("div",{className:"text-2xl font-bold text-white",children:N.length})]}),e.jsxs("div",{className:"bg-white/5 backdrop-blur-xl rounded-xl p-4 border border-white/10",children:[e.jsx("div",{className:"text-sm text-gray-400",children:"Общая сумма"}),e.jsx("div",{className:"text-2xl font-bold text-white",children:S(l.reduce((d,C)=>d+(parseFloat(C.amount)||0),0))})]})]})]})},Pt=({data:l})=>{const[s,n]=R.useState({key:null,direction:"asc"}),[t,r]=R.useState(""),[i,a]=R.useState(1),[c]=R.useState(15);R.useEffect(()=>{a(1)},[t,l]);const p=(o,y="TRY")=>new Intl.NumberFormat("tr-TR",{style:"currency",currency:y,minimumFractionDigits:0,maximumFractionDigits:0}).format(o),f=o=>{if(!o)return"-";try{return new Date(o).toLocaleString("tr-TR",{year:"numeric",month:"2-digit",day:"2-digit",hour:"2-digit",minute:"2-digit"})}catch{return o}},j=o=>{switch(o?o.toLowerCase():""){case"success":return"bg-green-500/20 text-green-300 border-green-500/30";case"fail":return"bg-red-500/20 text-red-300 border-red-500/30";case"in_process":return"bg-yellow-500/20 text-yellow-300 border-yellow-500/30";default:return"bg-gray-500/20 text-gray-300 border-gray-500/30"}},S=o=>{switch(o?o.toLowerCase():""){case"success":return"Успешно";case"fail":return"Ошибка";case"in_process":return"В процессе";default:return o||"Неизвестно"}},u=o=>{const y=o?o.toLowerCase():"";return y.includes("deposit")||y==="пополнение"?"bg-blue-500/20 text-blue-300":y.includes("withdraw")||y==="вывод"?"bg-orange-500/20 text-orange-300":"bg-purple-500/20 text-purple-300"},g=l.filter(o=>{const y=t.toLowerCase();return o.id&&o.id.toString().toLowerCase().includes(y)||o.status&&o.status.toLowerCase().includes(y)||o.company&&o.company.toLowerCase().includes(y)||o.fullName&&o.fullName.toLowerCase().includes(y)||o.userId&&o.userId.toString().toLowerCase().includes(y)||o.paymentMethod&&o.paymentMethod.toLowerCase().includes(y)||o.amount&&o.amount.toString().includes(y)}),x=[...g].sort((o,y)=>{if(!s.key)return 0;const b=o[s.key]||"",v=y[s.key]||"";if(s.key==="amount"||s.key==="fee")return s.direction==="asc"?parseFloat(b)-parseFloat(v):parseFloat(v)-parseFloat(b);if(s.key==="createdAt"||s.key==="processedAt"){const C=new Date(b),A=new Date(v);return s.direction==="asc"?C-A:A-C}const d=b.toString().localeCompare(v.toString());return s.direction==="asc"?d:-d}),N=Math.ceil(x.length/c),h=(i-1)*c,k=x.slice(h,h+c),w=o=>{n(y=>({key:o,direction:y.key===o&&y.direction==="asc"?"desc":"asc"}))},_=({columnKey:o})=>s.key!==o?e.jsx(K,{className:"w-4 h-4 text-gray-400"}):s.direction==="asc"?e.jsx(ve,{className:"w-4 h-4 text-blue-400"}):e.jsx(K,{className:"w-4 h-4 text-blue-400"});return e.jsxs("div",{className:"space-y-6",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsx("h2",{className:"text-2xl font-bold text-white",children:"Операции платформы"}),e.jsxs("p",{className:"text-gray-300",children:[g.length," операций из ",l.length," • Данные API коллектора"]})]}),e.jsxs("button",{className:"px-4 py-2 bg-gradient-to-r from-green-500 to-emerald-600 text-white rounded-lg hover:from-green-600 hover:to-emerald-700 transition-all duration-200 flex items-center space-x-2",children:[e.jsx(de,{className:"w-4 h-4"}),e.jsx("span",{children:"Экспорт"})]})]}),e.jsxs("div",{className:"flex flex-col sm:flex-row gap-4",children:[e.jsxs("div",{className:"relative flex-1",children:[e.jsx(Ce,{className:"absolute left-3 top-1/2 transform -translate-y-1/2 w-4 h-4 text-gray-400"}),e.jsx("input",{type:"text",placeholder:"Поиск по ID, пользователю, статусу, проекту...",value:t,onChange:o=>r(o.target.value),className:"w-full pl-10 pr-4 py-2 bg-white/10 border border-white/20 rounded-lg text-white placeholder-gray-400 focus:outline-none focus:ring-2 focus:ring-blue-500 focus:border-transparent"})]}),e.jsxs("div",{className:"flex items-center space-x-2",children:[e.jsx(z,{className:"w-4 h-4 text-gray-400"}),e.jsxs("span",{className:"text-sm text-gray-400",children:[g.length," результатов"]})]})]}),e.jsxs("div",{className:"bg-white/5 backdrop-blur-xl rounded-2xl border border-white/10 overflow-hidden",children:[e.jsx("div",{className:"overflow-x-auto",children:e.jsxs("table",{className:"w-full",children:[e.jsx("thead",{className:"bg-white/10",children:e.jsxs("tr",{children:[e.jsx("th",{className:"px-4 py-4 text-left text-sm font-semibold text-white cursor-pointer hover:bg-white/10",onClick:()=>w("id"),children:e.jsxs("div",{className:"flex items-center space-x-2",children:[e.jsx("span",{children:"ID Операции"}),e.jsx(_,{columnKey:"id"})]})}),e.jsx("th",{className:"px-4 py-4 text-left text-sm font-semibold text-white cursor-pointer hover:bg-white/10",onClick:()=>w("status"),children:e.jsxs("div",{className:"flex items-center space-x-2",children:[e.jsx("span",{children:"Статус"}),e.jsx(_,{columnKey:"status"})]})}),e.jsx("th",{className:"px-4 py-4 text-left text-sm font-semibold text-white cursor-pointer hover:bg-white/10",onClick:()=>w("transactionType"),children:e.jsxs("div",{className:"flex items-center space-x-2",children:[e.jsx("span",{children:"Тип"}),e.jsx(_,{columnKey:"transactionType"})]})}),e.jsx("th",{className:"px-4 py-4 text-left text-sm font-semibold text-white cursor-pointer hover:bg-white/10",onClick:()=>w("amount"),children:e.jsxs("div",{className:"flex items-center space-x-2",children:[e.jsx("span",{children:"Сумма"}),e.jsx(_,{columnKey:"amount"})]})}),e.jsx("th",{className:"px-4 py-4 text-left text-sm font-semibold text-white",children:"Пользователь"}),e.jsx("th",{className:"px-4 py-4 text-left text-sm font-semibold text-white cursor-pointer hover:bg-white/10",onClick:()=>w("company"),children:e.jsxs("div",{className:"flex items-center space-x-2",children:[e.jsx("span",{children:"Проект"}),e.jsx(_,{columnKey:"company"})]})}),e.jsx("th",{className:"px-4 py-4 text-left text-sm font-semibold text-white cursor-pointer hover:bg-white/10",onClick:()=>w("createdAt"),children:e.jsxs("div",{className:"flex items-center space-x-2",children:[e.jsx("span",{children:"Создано"}),e.jsx(_,{columnKey:"createdAt"})]})}),e.jsx("th",{className:"px-4 py-4 text-left text-sm font-semibold text-white",children:"Детали"})]})}),e.jsx("tbody",{className:"divide-y divide-white/10",children:k.map((o,y)=>e.jsxs("tr",{className:"hover:bg-white/5 transition-colors duration-200",children:[e.jsxs("td",{className:"px-4 py-4 text-sm",children:[e.jsx("div",{className:"font-mono text-white text-xs",children:o.id?o.id.slice(-12):"-"}),o.clientOperationId&&e.jsxs("div",{className:"font-mono text-gray-400 text-xs mt-1",children:["Клиент: ",o.clientOperationId.slice(-8)]})]}),e.jsxs("td",{className:"px-4 py-4",children:[e.jsx("span",{className:`inline-flex items-center px-2 py-1 rounded-full text-xs font-medium border ${j(o.status)}`,children:S(o.status)}),o.operationState&&o.operationState!==o.status&&e.jsx("div",{className:"text-xs text-gray-400 mt-1",children:o.operationState})]}),e.jsx("td",{className:"px-4 py-4",children:e.jsx("span",{className:`inline-flex items-center px-2 py-1 rounded-full text-xs font-medium ${u(o.transactionType)}`,children:o.transactionType||"Неизвестно"})}),e.jsxs("td",{className:"px-4 py-4 text-sm",children:[e.jsx("div",{className:"font-semibold text-white",children:p(o.amount)}),o.fee>0&&e.jsxs("div",{className:"text-xs text-gray-400",children:["Комиссия: ",p(o.fee)]})]}),e.jsx("td",{className:"px-4 py-4 text-sm",children:e.jsxs("div",{className:"flex items-center space-x-2",children:[e.jsx(Ue,{className:"w-4 h-4 text-gray-400"}),e.jsx("div",{children:o.fullName?e.jsxs(e.Fragment,{children:[e.jsx("div",{className:"font-medium text-white",children:o.fullName}),e.jsxs("div",{className:"text-xs text-gray-400",children:["ID: ",o.userId]})]}):e.jsxs("div",{className:"text-gray-400",children:["ID: ",o.userId||"-"]})})]})}),e.jsxs("td",{className:"px-4 py-4 text-sm",children:[e.jsx("div",{className:"font-medium text-white",children:o.company||"-"}),o.serviceEnv&&e.jsx("div",{className:"text-xs text-gray-400",children:o.serviceEnv})]}),e.jsxs("td",{className:"px-4 py-4 text-sm text-gray-300",children:[e.jsx("div",{children:f(o.createdAt)}),o.processedAt&&o.processedAt!==o.createdAt&&e.jsxs("div",{className:"text-xs text-gray-500 mt-1",children:["Обработано: ",f(o.processedAt)]})]}),e.jsx("td",{className:"px-4 py-4 text-sm",children:e.jsxs("div",{className:"flex flex-col space-y-1",children:[o.paymentMethod&&e.jsxs("div",{className:"flex items-center space-x-1 text-xs",children:[e.jsx(Y,{className:"w-3 h-3 text-gray-400"}),e.jsx("span",{className:"text-gray-400",children:o.paymentMethod})]}),o.linkId&&e.jsxs("div",{className:"flex items-center space-x-1 text-xs",children:[e.jsx(fe,{className:"w-3 h-3 text-gray-400"}),e.jsx("span",{className:"text-gray-400 font-mono",children:o.linkId.slice(-8)})]})]})})]},o.id||y))})]})}),N>1&&e.jsxs("div",{className:"bg-white/5 px-6 py-4 flex items-center justify-between border-t border-white/10",children:[e.jsxs("div",{className:"text-sm text-gray-400",children:["Страница ",i," из ",N," • Показано ",k.length," из ",g.length]}),e.jsxs("div",{className:"flex items-center space-x-2",children:[e.jsx("button",{onClick:()=>a(Math.max(1,i-1)),disabled:i===1,className:"px-3 py-1 bg-white/10 text-white rounded-lg hover:bg-white/20 disabled:opacity-50 disabled:cursor-not-allowed transition-colors duration-200",children:"Предыдущая"}),e.jsx("button",{onClick:()=>a(Math.min(N,i+1)),disabled:i===N,className:"px-3 py-1 bg-white/10 text-white rounded-lg hover:bg-white/20 disabled:opacity-50 disabled:cursor-not-allowed transition-colors duration-200",children:"Следующая"})]})]})]})]})},$t=({data:l,filters:s,onFiltersChange:n,dataType:t="merchant"})=>{var _;const[r,i]=R.useState(!1),[a,c]=R.useState(s),p="TRY",f=t==="merchant"?"провайдера":"платформы",j=o=>{const y=l.map(v=>v[o]).filter(Boolean),b=[...new Set(y)].sort();return console.log(`📊 Unique values for "${o}":`,b),b},S=(()=>{const o=j("status");return console.log("📋 Available statuses in data:",o),t==="merchant"?o.map(y=>{const b=y.toLowerCase();let v=y;return b==="completed"?v="Завершено":b==="failed"?v="Неудачно":b==="canceled"&&(v="Отменено"),{value:y,label:v}}):o.map(y=>{const b=y.toLowerCase();let v=y;return b==="success"?v="Успешно":b==="fail"?v="Ошибка":b==="in_process"&&(v="В процессе"),{value:y,label:v}})})(),u=t==="merchant"?j("company").map(o=>({value:o,label:o})):[],g=j("paymentMethod").map(o=>({value:o,label:o})),x=(()=>{const o=j("transactionType");return console.log("📋 Available transaction types in data:",o),o.map(y=>{const b=y.toLowerCase();let v=y;return b==="deposit"||b==="пополнение"?v="Депозит":(b==="withdraw"||b==="вывод")&&(v="Выплата"),{value:y,label:v}})})();console.log("🏢 Company options:",u),console.log("💳 Payment method options:",g),console.log("🔄 Transaction type options:",x),R.useEffect(()=>{c(s)},[s]);const N=()=>{n(a)},h=()=>{const o={status:"",company:"",paymentMethod:"",transactionType:"",dateRange:{start:"",end:""},amountRange:{min:"",max:""}};c(o),n(o)},k=()=>a.status||a.company||a.paymentMethod||a.transactionType||a.dateRange.start||a.dateRange.end||a.amountRange.min||a.amountRange.max,w=()=>{let o=0;return a.status&&o++,a.company&&o++,a.paymentMethod&&o++,a.transactionType&&o++,(a.dateRange.start||a.dateRange.end)&&o++,(a.amountRange.min||a.amountRange.max)&&o++,o};return e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{className:"flex items-center space-x-3",children:[e.jsx("div",{className:"w-8 h-8 bg-gradient-to-br from-blue-500 to-purple-600 rounded-lg flex items-center justify-center",children:e.jsx(z,{className:"w-4 h-4 text-white"})}),e.jsxs("div",{children:[e.jsx("h3",{className:"text-lg font-semibold text-white",children:"Фильтры"}),e.jsxs("p",{className:"text-sm text-gray-400",children:["Настройте отображение данных • Источник: ",f]})]})]}),e.jsxs("div",{className:"flex items-center space-x-2",children:[e.jsx("span",{className:"text-sm text-gray-300",children:(()=>{let o=[...l];return a.status&&(o=o.filter(y=>y.status===a.status)),a.company&&(o=o.filter(y=>y.company===a.company)),a.paymentMethod&&(o=o.filter(y=>y.paymentMethod===a.paymentMethod)),a.transactionType&&(o=o.filter(y=>y.transactionType===a.transactionType)),(a.dateRange.start||a.dateRange.end)&&(o=o.filter(y=>{if(!y.createdAt)return!0;const b=y.createdAt.split(" ")[0];return!(a.dateRange.start&&b<a.dateRange.start||a.dateRange.end&&b>a.dateRange.end)})),`${o.length} из ${l.length} записей`})()}),k()&&e.jsxs("div",{className:"flex items-center space-x-2 px-3 py-1 bg-blue-500/20 border border-blue-500/30 rounded-full",children:[e.jsxs("span",{className:"text-sm text-blue-300",children:[w()," активных фильтров"]}),e.jsx("button",{onClick:h,className:"w-4 h-4 text-blue-300 hover:text-blue-200 transition-colors duration-200",children:e.jsx(Rt,{className:"w-3 h-3"})})]}),e.jsxs("button",{onClick:()=>i(!r),className:"px-4 py-2 bg-white/10 text-white rounded-lg hover:bg-white/20 transition-colors duration-200 flex items-center space-x-2",children:[e.jsx(z,{className:"w-4 h-4"}),e.jsxs("span",{children:[r?"Скрыть":"Показать"," фильтры"]})]})]})]}),r&&e.jsxs("div",{className:"bg-white/5 backdrop-blur-xl rounded-2xl p-6 border border-white/10 space-y-6",children:[e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-6",children:[e.jsxs("div",{className:"space-y-2",children:[e.jsxs("label",{className:"text-sm font-medium text-white flex items-center",children:[e.jsx("div",{className:"w-4 h-4 bg-gradient-to-br from-green-500 to-emerald-500 rounded-full mr-2"}),"Статус операции"]}),e.jsxs("select",{value:a.status,onChange:o=>c(y=>({...y,status:o.target.value})),className:"w-full px-3 py-2 bg-white/10 border border-white/20 rounded-lg text-white focus:outline-none focus:ring-2 focus:ring-blue-500 focus:border-transparent",children:[e.jsx("option",{value:"",children:"Все статусы"}),S.map(o=>e.jsx("option",{value:o.value,children:o.label},o.value))]})]}),t==="merchant"&&e.jsxs("div",{className:"space-y-2",children:[e.jsxs("label",{className:"text-sm font-medium text-white flex items-center",children:[e.jsx(q,{className:"w-4 h-4 text-blue-400 mr-2"}),"Компания"]}),e.jsxs("select",{value:a.company,onChange:o=>c(y=>({...y,company:o.target.value})),className:"w-full px-3 py-2 bg-white/10 border border-white/20 rounded-lg text-white focus:outline-none focus:ring-2 focus:ring-blue-500 focus:border-transparent",children:[e.jsx("option",{value:"",children:"Все компании"}),u.map(o=>e.jsx("option",{value:o.value,children:o.label},o.value))]})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsxs("label",{className:"text-sm font-medium text-white flex items-center",children:[e.jsx(Y,{className:"w-4 h-4 text-green-400 mr-2"}),"Метод оплаты"]}),e.jsxs("select",{value:a.paymentMethod,onChange:o=>c(y=>({...y,paymentMethod:o.target.value})),className:"w-full px-3 py-2 bg-white/10 border border-white/20 rounded-lg text-white focus:outline-none focus:ring-2 focus:ring-blue-500 focus:border-transparent",children:[e.jsx("option",{value:"",children:"Все методы"}),g.map(o=>e.jsx("option",{value:o.value,children:o.label},o.value))]})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsxs("label",{className:"text-sm font-medium text-white flex items-center",children:[e.jsx(z,{className:"w-4 h-4 text-orange-400 mr-2"}),"Тип транзакции"]}),e.jsxs("select",{value:a.transactionType,onChange:o=>c(y=>({...y,transactionType:o.target.value})),className:"w-full px-3 py-2 bg-white/10 border border-white/20 rounded-lg text-white focus:outline-none focus:ring-2 focus:ring-blue-500 focus:border-transparent",children:[e.jsx("option",{value:"",children:"Все типы"}),x.map(o=>e.jsx("option",{value:o.value,children:o.label},o.value))]})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsxs("label",{className:"text-sm font-medium text-white flex items-center",children:[e.jsx(V,{className:"w-4 h-4 text-purple-400 mr-2"}),"Дата начала"]}),e.jsx("input",{type:"date",value:a.dateRange.start,onChange:o=>c(y=>({...y,dateRange:{...y.dateRange,start:o.target.value}})),className:"w-full px-3 py-2 bg-white/10 border border-white/20 rounded-lg text-white focus:outline-none focus:ring-2 focus:ring-blue-500 focus:border-transparent"}),l.length>0&&e.jsxs("div",{className:"text-xs text-gray-400",children:["Диапазон данных: ",(()=>{const o=l.map(v=>new Date(v.createdAt)).filter(v=>!isNaN(v.getTime()));if(o.length===0)return"Нет валидных дат";const y=new Date(Math.min(...o)),b=new Date(Math.max(...o));return`${y.toISOString().split("T")[0]} - ${b.toISOString().split("T")[0]}`})()]})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsxs("label",{className:"text-sm font-medium text-white flex items-center",children:[e.jsx(V,{className:"w-4 h-4 text-purple-400 mr-2"}),"Дата окончания"]}),e.jsx("input",{type:"date",value:a.dateRange.end,onChange:o=>c(y=>({...y,dateRange:{...y.dateRange,end:o.target.value}})),className:"w-full px-3 py-2 bg-white/10 border border-white/20 rounded-lg text-white focus:outline-none focus:ring-2 focus:ring-blue-500 focus:border-transparent"})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsxs("label",{className:"text-sm font-medium text-white flex items-center",children:[e.jsx(O,{className:"w-4 h-4 text-green-400 mr-2"}),"Минимальная сумма (",p,")"]}),e.jsx("input",{type:"number",placeholder:"0",value:a.amountRange.min,onChange:o=>c(y=>({...y,amountRange:{...y.amountRange,min:o.target.value}})),className:"w-full px-3 py-2 bg-white/10 border border-white/20 rounded-lg text-white placeholder-gray-400 focus:outline-none focus:ring-2 focus:ring-blue-500 focus:border-transparent"})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsxs("label",{className:"text-sm font-medium text-white flex items-center",children:[e.jsx(O,{className:"w-4 h-4 text-green-400 mr-2"}),"Максимальная сумма (",p,")"]}),e.jsx("input",{type:"number",placeholder:"Без ограничений",value:a.amountRange.max,onChange:o=>c(y=>({...y,amountRange:{...y.amountRange,max:o.target.value}})),className:"w-full px-3 py-2 bg-white/10 border border-white/20 rounded-lg text-white placeholder-gray-400 focus:outline-none focus:ring-2 focus:ring-blue-500 focus:border-transparent"})]})]}),e.jsxs("div",{className:"flex items-center justify-between pt-4 border-t border-white/10",children:[e.jsx("div",{className:"text-sm text-gray-400",children:k()?e.jsxs("span",{children:["Активно ",w()," фильтр",w()!==1?"ов":""]}):e.jsx("span",{children:"Фильтры не применены"})}),e.jsxs("div",{className:"flex items-center space-x-3",children:[e.jsx("button",{onClick:h,className:"px-4 py-2 bg-white/10 text-white rounded-lg hover:bg-white/20 transition-colors duration-200",children:"Сбросить"}),e.jsx("button",{onClick:N,className:"px-6 py-2 bg-gradient-to-r from-blue-500 to-purple-600 text-white rounded-lg hover:from-blue-600 hover:to-purple-700 transition-all duration-200 font-semibold",children:"Применить фильтры"})]})]})]}),!r&&k()&&e.jsx("div",{className:"bg-white/5 backdrop-blur-xl rounded-xl p-4 border border-white/10",children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{className:"flex items-center space-x-4",children:[e.jsx("span",{className:"text-sm text-gray-300",children:"Активные фильтры:"}),e.jsxs("div",{className:"flex flex-wrap gap-2",children:[a.status&&e.jsxs("span",{className:"px-2 py-1 bg-blue-500/20 text-blue-300 rounded-full text-xs",children:["Статус: ",(_=S.find(o=>o.value===a.status))==null?void 0:_.label]}),a.company&&e.jsxs("span",{className:"px-2 py-1 bg-blue-500/20 text-blue-300 rounded-full text-xs",children:["Компания: ",a.company]}),a.paymentMethod&&e.jsxs("span",{className:"px-2 py-1 bg-blue-500/20 text-blue-300 rounded-full text-xs",children:["Метод: ",a.paymentMethod]}),(a.dateRange.start||a.dateRange.end)&&e.jsxs("span",{className:"px-2 py-1 bg-blue-500/20 text-blue-300 rounded-full text-xs",children:["Дата: ",a.dateRange.start||"..."," - ",a.dateRange.end||"..."]}),(a.amountRange.min||a.amountRange.max)&&e.jsxs("span",{className:"px-2 py-1 bg-blue-500/20 text-blue-300 rounded-full text-xs",children:["Сумма: ",a.amountRange.min||"0"," - ",a.amountRange.max||"∞"," ",p]})]})]}),e.jsx("button",{onClick:h,className:"text-blue-400 hover:text-blue-300 text-sm transition-colors duration-200",children:"Очистить все"})]})})]})};function Et({insights:l}){const s=n=>{switch(n){case"success":return"border-green-500/30 bg-green-500/10 text-green-300";case"warning":return"border-yellow-500/30 bg-yellow-500/10 text-yellow-300";case"danger":return"border-red-500/30 bg-red-500/10 text-red-300";case"info":default:return"border-blue-500/30 bg-blue-500/10 text-blue-300"}};return e.jsxs("div",{className:"p-6",children:[e.jsxs("div",{className:"flex items-center gap-3 mb-6",children:[e.jsx(_t,{className:"w-6 h-6 text-yellow-400"}),e.jsx("h2",{className:"text-xl font-semibold text-white",children:"Ключевые инсайты"})]}),e.jsx("div",{className:"space-y-4",children:l.map((n,t)=>e.jsxs("div",{className:`flex items-start gap-3 p-4 rounded-lg border ${s(n.type)} animate-slide-up`,style:{animationDelay:`${t*.1}s`},children:[e.jsx("span",{className:"text-2xl flex-shrink-0",children:n.icon}),e.jsx("p",{className:"text-sm font-medium leading-relaxed",children:n.text})]},t))})]})}function Ot({data:l,anomalies:s}){const n=[{type:"Необычная сумма",description:"Операция на сумму значительно превышающую среднюю",severity:"Высокий",count:l.filter(i=>parseFloat(i["Initial Amount"])>1e4).length,recommendation:"Проверить подлинность крупных операций"},{type:"Частые отказы",description:"Повышенное количество неудачных операций",severity:"Средний",count:l.filter(i=>i.Status==="fail").length,recommendation:"Анализировать причины отказов"},{type:"Временные паттерны",description:"Необычная активность в определенное время",severity:"Низкий",count:Math.floor(Math.random()*5),recommendation:"Мониторить активность в нерабочее время"}],t=i=>{switch(i){case"Высокий":return"bg-red-500/20 text-red-300 border-red-500/30";case"Средний":return"bg-yellow-500/20 text-yellow-300 border-yellow-500/30";case"Низкий":return"bg-green-500/20 text-green-300 border-green-500/30";default:return"bg-gray-500/20 text-gray-300 border-gray-500/30"}},r=i=>{switch(i){case"Высокий":return e.jsx(X,{className:"w-5 h-5 text-red-400"});case"Средний":return e.jsx(le,{className:"w-5 h-5 text-yellow-400"});case"Низкий":return e.jsx(J,{className:"w-5 h-5 text-green-400"});default:return e.jsx(J,{className:"w-5 h-5 text-gray-400"})}};return e.jsxs("div",{className:"space-y-6",children:[e.jsxs("div",{className:"flex items-center gap-3 mb-6",children:[e.jsx(X,{className:"w-6 h-6 text-orange-400"}),e.jsx("h3",{className:"text-xl font-semibold text-white",children:"Обнаружение аномалий"})]}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-3 gap-4",children:[e.jsx("div",{className:"bg-gradient-to-br from-red-500/20 to-red-600/20 rounded-xl p-6 border border-red-500/30",children:e.jsxs("div",{className:"flex items-center justify-between mb-4",children:[e.jsx(X,{className:"w-8 h-8 text-red-400"}),e.jsxs("div",{className:"text-right",children:[e.jsx("div",{className:"text-2xl font-bold text-white",children:n.filter(i=>i.severity==="Высокий").length}),e.jsx("div",{className:"text-red-300 text-sm",children:"Критические"})]})]})}),e.jsx("div",{className:"bg-gradient-to-br from-yellow-500/20 to-yellow-600/20 rounded-xl p-6 border border-yellow-500/30",children:e.jsxs("div",{className:"flex items-center justify-between mb-4",children:[e.jsx(le,{className:"w-8 h-8 text-yellow-400"}),e.jsxs("div",{className:"text-right",children:[e.jsx("div",{className:"text-2xl font-bold text-white",children:n.filter(i=>i.severity==="Средний").length}),e.jsx("div",{className:"text-yellow-300 text-sm",children:"Внимание"})]})]})}),e.jsx("div",{className:"bg-gradient-to-br from-green-500/20 to-green-600/20 rounded-xl p-6 border border-green-500/30",children:e.jsxs("div",{className:"flex items-center justify-between mb-4",children:[e.jsx(J,{className:"w-8 h-8 text-green-400"}),e.jsxs("div",{className:"text-right",children:[e.jsx("div",{className:"text-2xl font-bold text-white",children:n.filter(i=>i.severity==="Низкий").length}),e.jsx("div",{className:"text-green-300 text-sm",children:"Информация"})]})]})})]}),e.jsxs("div",{className:"space-y-4",children:[e.jsx("h4",{className:"text-lg font-medium text-white",children:"Обнаруженные аномалии"}),n.map((i,a)=>e.jsxs("div",{className:`p-6 rounded-xl border ${t(i.severity)}`,children:[e.jsxs("div",{className:"flex items-start justify-between mb-4",children:[e.jsxs("div",{className:"flex items-center gap-3",children:[r(i.severity),e.jsxs("div",{children:[e.jsx("h5",{className:"font-medium text-white",children:i.type}),e.jsx("p",{className:"text-white/70 text-sm mt-1",children:i.description})]})]}),e.jsxs("div",{className:"text-right",children:[e.jsx("div",{className:"text-lg font-bold text-white",children:i.count}),e.jsx("div",{className:"text-white/70 text-sm",children:"случаев"})]})]}),e.jsxs("div",{className:"bg-white/5 rounded-lg p-3",children:[e.jsx("div",{className:"text-white/70 text-sm mb-1",children:"Рекомендация:"}),e.jsx("div",{className:"text-white text-sm",children:i.recommendation})]})]},a))]}),e.jsxs("div",{className:"bg-white/5 rounded-xl p-6",children:[e.jsx("h4",{className:"text-lg font-medium text-white mb-4",children:"Настройки мониторинга"}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:[e.jsxs("div",{className:"space-y-3",children:[e.jsxs("div",{className:"flex items-center justify-between p-3 bg-white/5 rounded-lg",children:[e.jsx("span",{className:"text-white",children:"Автоматические уведомления"}),e.jsx("div",{className:"w-10 h-6 bg-blue-500 rounded-full flex items-center justify-end px-1",children:e.jsx("div",{className:"w-4 h-4 bg-white rounded-full"})})]}),e.jsxs("div",{className:"flex items-center justify-between p-3 bg-white/5 rounded-lg",children:[e.jsx("span",{className:"text-white",children:"Порог критичности"}),e.jsxs("select",{className:"bg-white/10 text-white rounded px-2 py-1 text-sm",children:[e.jsx("option",{children:"Высокий"}),e.jsx("option",{children:"Средний"}),e.jsx("option",{children:"Низкий"})]})]})]}),e.jsxs("div",{className:"space-y-3",children:[e.jsxs("div",{className:"flex items-center justify-between p-3 bg-white/5 rounded-lg",children:[e.jsx("span",{className:"text-white",children:"Интервал проверки"}),e.jsxs("select",{className:"bg-white/10 text-white rounded px-2 py-1 text-sm",children:[e.jsx("option",{children:"5 минут"}),e.jsx("option",{children:"15 минут"}),e.jsx("option",{children:"1 час"})]})]}),e.jsxs("div",{className:"flex items-center justify-between p-3 bg-white/5 rounded-lg",children:[e.jsx("span",{className:"text-white",children:"История аномалий"}),e.jsx("button",{className:"text-blue-400 hover:text-blue-300 text-sm",children:"Посмотреть все"})]})]})]})]})]})}const Ut=({onTimezoneSelect:l,selectedTimezone:s="UTC"})=>{const[n,t]=R.useState(!1),r=[{id:"UTC",name:"UTC (Всемирное время)",offset:"+00:00"},{id:"Europe/Moscow",name:"Москва (MSK)",offset:"+03:00"},{id:"Europe/Istanbul",name:"Стамбул (TRT)",offset:"+03:00"},{id:"Europe/London",name:"Лондон (GMT)",offset:"+00:00"},{id:"Europe/Berlin",name:"Берлин (CET)",offset:"+01:00"},{id:"Asia/Dubai",name:"Дубай (GST)",offset:"+04:00"},{id:"Asia/Tokyo",name:"Токио (JST)",offset:"+09:00"},{id:"America/New_York",name:"Нью-Йорк (EST)",offset:"-05:00"},{id:"America/Los_Angeles",name:"Лос-Анджелес (PST)",offset:"-08:00"}],i=r.find(c=>c.id===s)||r[0],a=c=>{l(c.id),t(!1)};return e.jsxs("div",{className:"relative",children:[e.jsxs("button",{onClick:()=>t(!n),className:"w-full px-4 py-3 bg-white/10 border border-white/20 rounded-lg text-white hover:bg-white/20 transition-colors duration-200 flex items-center justify-between",children:[e.jsxs("div",{className:"flex items-center space-x-3",children:[e.jsx(W,{className:"w-5 h-5 text-blue-400"}),e.jsxs("div",{className:"text-left",children:[e.jsx("div",{className:"font-medium",children:i.name}),e.jsx("div",{className:"text-sm text-gray-300",children:i.offset})]})]}),e.jsx("div",{className:`transform transition-transform duration-200 ${n?"rotate-180":""}`,children:e.jsx("svg",{className:"w-5 h-5 text-gray-400",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M19 9l-7 7-7-7"})})})]}),n&&e.jsx("div",{className:"absolute top-full left-0 right-0 mt-2 bg-white/10 backdrop-blur-xl border border-white/20 rounded-lg shadow-xl z-50 max-h-64 overflow-y-auto",children:r.map(c=>e.jsxs("button",{onClick:()=>a(c),className:`w-full px-4 py-3 text-left hover:bg-white/20 transition-colors duration-200 flex items-center justify-between ${s===c.id?"bg-blue-500/20 text-blue-300":"text-white"}`,children:[e.jsxs("div",{className:"flex items-center space-x-3",children:[e.jsx(we,{className:"w-4 h-4"}),e.jsxs("div",{children:[e.jsx("div",{className:"font-medium",children:c.name}),e.jsx("div",{className:"text-sm text-gray-300",children:c.offset})]})]}),s===c.id&&e.jsx("div",{className:"w-2 h-2 bg-blue-400 rounded-full"})]},c.id))})]})},$=R.forwardRef(({className:l,variant:s="default",blur:n=!0,border:t=!0,children:r,...i},a)=>{const c="rounded-2xl overflow-hidden transition-all duration-200",p={default:"bg-white/5 hover:bg-white/10",solid:"bg-gray-800",gradient:"bg-gradient-to-br from-white/10 to-white/5",glass:"bg-white/[0.02]",primary:"bg-gradient-to-br from-purple-500/20 to-pink-500/20"},f=n?"backdrop-blur-xl":"",j=t?"border border-white/10 hover:border-white/20":"";return e.jsx("div",{ref:a,className:ce(c,p[s],f,j,l),...i,children:r})});$.displayName="Card";const E=({className:l,children:s,...n})=>e.jsx("div",{className:ce("p-6",l),...n,children:s}),Z=({className:l,children:s,...n})=>e.jsx("h3",{className:ce("text-lg font-semibold text-white",l),...n,children:s}),Vt=({data:l,dataType:s,timezone:n="UTC"})=>{const[t,r]=R.useState(0);R.useEffect(()=>{r(u=>u+1)},[l]),console.log("🎨 BeautifulChartsGrid received data:",{dataLength:(l==null?void 0:l.length)||0,dataType:s,timezone:n,sampleData:(l==null?void 0:l.slice(0,2))||null});const i=(u,g)=>{const x=new Date(u);if(g==="UTC")return x;const h={"Europe/Moscow":3,"Europe/Istanbul":3,"Europe/London":0,"Europe/Berlin":1,"Asia/Dubai":4,"Asia/Tokyo":9,"America/New_York":-5,"America/Los_Angeles":-8}[g]||0;return new Date(x.getTime()+h*60*60*1e3)},a=R.useMemo(()=>{if(console.log("⏰ Processing hourly data for beautiful charts..."),!l||!Array.isArray(l)||l.length===0)return console.log("⚠️ No data available for hourly charts"),[];const u={};l.forEach((x,N)=>{const h=x.createdAt||x.date||x.operation_created_at;if(!h)return;const w=i(h,n).getHours(),_=parseFloat(x.amount||0);u[w]||(u[w]={hour:`${w.toString().padStart(2,"0")}:00`,shortHour:`${w}h`,volume:0,count:0,success:0,failed:0,successVolume:0,failedVolume:0}),u[w].volume+=_,u[w].count+=1;const o=(x.status||"").toLowerCase(),y=x.isCompleted||o==="completed"||o==="success"||o==="complete",b=x.isFailed||o==="failed"||o==="fail"||o==="canceled"||o==="cancelled";y?(u[w].success+=1,u[w].successVolume+=_):b&&(u[w].failed+=1,u[w].failedVolume+=_)});const g=Array.from({length:24},(x,N)=>u[N]||{hour:`${N.toString().padStart(2,"0")}:00`,shortHour:`${N}h`,volume:0,count:0,success:0,failed:0,successVolume:0,failedVolume:0}).filter(x=>x.count>0);return console.log("⏰ Beautiful hourly processing complete:",{activeHours:g.length,totalSuccess:g.reduce((x,N)=>x+N.success,0),totalVolume:g.reduce((x,N)=>x+N.volume,0)}),g.slice(0,12)},[l,n]),c=R.useMemo(()=>{if(console.log("📅 Processing daily data for beautiful charts..."),!l||!Array.isArray(l)||l.length===0)return console.log("⚠️ No data available for daily charts"),[];const u={};l.forEach((x,N)=>{const h=x.createdAt||x.date||x.operation_created_at;if(!h)return;const k=i(h,n),w=k.toISOString().split("T")[0],_=parseFloat(x.amount||0);u[w]||(u[w]={date:w,displayDate:k.toLocaleDateString("ru-RU",{month:"short",day:"numeric"}),volume:0,count:0,success:0,failed:0,successVolume:0,failedVolume:0,conversionRate:0}),u[w].volume+=_,u[w].count+=1;const o=(x.status||"").toLowerCase(),y=x.isCompleted||o==="completed"||o==="success"||o==="complete",b=x.isFailed||o==="failed"||o==="fail"||o==="canceled"||o==="cancelled";y?(u[w].success+=1,u[w].successVolume+=_):b&&(u[w].failed+=1,u[w].failedVolume+=_)});const g=Object.values(u).map(x=>({...x,conversionRate:x.count>0?x.success/x.count*100:0})).slice().sort((x,N)=>N.volume-x.volume).slice(0,10);return console.log("📅 Beautiful daily processing complete:",{activeDays:g.length,totalSuccess:g.reduce((x,N)=>x+N.success,0),totalVolume:g.reduce((x,N)=>x+N.volume,0)}),g},[l,n]),p=R.useMemo(()=>{const u=l.length,g=l.filter(d=>{const C=(d.status||"").toLowerCase();return d.isCompleted||C==="completed"||C==="success"||C==="complete"}).length,x=l.reduce((d,C)=>d+parseFloat(C.amount||0),0),N=l.filter(d=>{const C=(d.status||"").toLowerCase();return d.isCompleted||C==="completed"||C==="success"||C==="complete"}).reduce((d,C)=>d+parseFloat(C.amount||0),0),h=l.filter(d=>d.isDeposit||d.type==="deposit"||d.transactionType&&d.transactionType.toLowerCase().includes("пополнение")),k=h.filter(d=>{const C=(d.status||"").toLowerCase();return d.isCompleted||C==="completed"||C==="success"||C==="complete"}),w=h.reduce((d,C)=>d+parseFloat(C.amount||0),0),_=k.reduce((d,C)=>d+parseFloat(C.amount||0),0),o=l.filter(d=>d.isWithdraw||d.type==="withdraw"||d.transactionType&&d.transactionType.toLowerCase().includes("вывод")),y=o.filter(d=>{const C=(d.status||"").toLowerCase();return d.isCompleted||C==="completed"||C==="success"||C==="complete"}),b=o.reduce((d,C)=>d+parseFloat(C.amount||0),0),v=y.reduce((d,C)=>d+parseFloat(C.amount||0),0);return{totalOperations:u,successfulOperations:g,totalVolume:x,successfulVolume:N,conversionRate:u>0?g/u*100:0,averageAmount:u>0?x/u:0,deposits:{total:h.length,successful:k.length,volume:w,successfulVolume:_,conversionRate:h.length>0?k.length/h.length*100:0,averageAmount:h.length>0?w/h.length:0},withdrawals:{total:o.length,successful:y.length,volume:b,successfulVolume:v,conversionRate:o.length>0?y.length/o.length*100:0,averageAmount:o.length>0?b/o.length:0}}},[l]),f=R.useMemo(()=>{if(!l||l.length===0)return"TRY";const u=l.find(x=>x.currency);if(u)return console.log("💰 Currency detected from data:",u.currency),u.currency;const g=l.find(x=>x.amountFormatted);if(g){const x=g.amountFormatted;if(x.includes("TRY")||x.includes("₺"))return"TRY";if(x.includes("EUR")||x.includes("€"))return"EUR";if(x.includes("USD")||x.includes("$"))return"USD"}return console.log("💰 No currency detected, using default: TRY"),"TRY"},[l]),j=u=>{const g=f,x=g==="TRY"?"tr-TR":"en-US";return new Intl.NumberFormat(x,{style:"currency",currency:g,minimumFractionDigits:0,maximumFractionDigits:0}).format(u)},S=({active:u,payload:g,label:x})=>u&&g&&g.length?e.jsxs("div",{className:"bg-gray-900/95 backdrop-blur-lg border border-purple-500/30 rounded-xl p-4 shadow-2xl",children:[e.jsx("p",{className:"text-white font-semibold mb-2",children:x}),g.map((N,h)=>e.jsxs("div",{className:"flex items-center justify-between gap-4",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("div",{className:"w-3 h-3 rounded-full",style:{backgroundColor:N.color}}),e.jsx("span",{className:"text-gray-300 text-sm",children:N.name})]}),e.jsx("span",{className:"text-white font-medium",children:typeof N.value=="number"&&N.value>1e3?j(N.value):N.value})]},h))]}):null;return e.jsxs("div",{className:"space-y-8",children:[e.jsxs("div",{className:"text-center space-y-4",children:[e.jsxs("div",{className:"relative",children:[e.jsx("div",{className:"absolute inset-0 bg-gradient-to-r from-purple-600 to-pink-600 rounded-full blur-xl opacity-20 animate-pulse"}),e.jsx("div",{className:"relative w-24 h-24 bg-gradient-to-br from-purple-500 to-pink-600 rounded-full flex items-center justify-center mx-auto",children:e.jsx(G,{className:"w-12 h-12 text-white animate-bounce"})})]}),e.jsxs("div",{children:[e.jsx("h1",{className:"text-4xl font-bold bg-gradient-to-r from-purple-400 to-pink-400 bg-clip-text text-transparent",children:"Красивая Аналитика"}),e.jsxs("p",{className:"text-xl text-gray-300 mt-2",children:["Интерактивные графики и живая статистика • ",n]})]})]}),e.jsx("div",{className:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-4 gap-6",children:[{title:"Общий объем",value:j(p.totalVolume),subtitle:`${p.totalOperations} операций`,icon:O,gradient:"from-blue-500 to-cyan-500",change:"+12.5%"},{title:"Успешные",value:j(p.successfulVolume),subtitle:`${p.successfulOperations} операций`,icon:U,gradient:"from-green-500 to-emerald-500",change:"+8.2%"},{title:"Конверсия",value:`${p.conversionRate.toFixed(1)}%`,subtitle:"Общая конверсия",icon:be,gradient:"from-purple-500 to-pink-500",change:"+2.1%"},{title:"Средний чек",value:j(p.averageAmount),subtitle:"На операцию",icon:It,gradient:"from-orange-500 to-red-500",change:"+5.8%"}].map((u,g)=>e.jsx($,{className:"group hover:scale-105 transition-all duration-300 cursor-pointer",children:e.jsxs(E,{className:"p-6 relative overflow-hidden",children:[e.jsx("div",{className:"absolute top-0 right-0 w-32 h-32 bg-gradient-to-br opacity-10 rounded-full transform translate-x-8 -translate-y-8 group-hover:scale-110 transition-transform duration-300",style:{backgroundImage:"linear-gradient(135deg, var(--tw-gradient-stops))"}}),e.jsxs("div",{className:"relative z-10",children:[e.jsxs("div",{className:"flex items-center justify-between mb-4",children:[e.jsx("div",{className:`w-12 h-12 bg-gradient-to-br ${u.gradient} rounded-xl flex items-center justify-center group-hover:rotate-12 transition-transform duration-300`,children:e.jsx(u.icon,{className:"w-6 h-6 text-white"})}),e.jsx("div",{className:"text-right",children:e.jsxs("div",{className:"flex items-center text-sm text-green-400",children:[e.jsx(_e,{className:"w-4 h-4 mr-1"}),u.change]})})]}),e.jsxs("div",{children:[e.jsx("p",{className:"text-sm text-gray-400 mb-1",children:u.title}),e.jsx("p",{className:"text-2xl font-bold text-white mb-1 group-hover:text-purple-400 transition-colors duration-300",children:u.value}),e.jsx("p",{className:"text-xs text-gray-500",children:u.subtitle})]})]})]})},g))}),(p.deposits.total>0||p.withdrawals.total>0)&&e.jsxs(e.Fragment,{children:[e.jsxs("div",{className:"text-center space-y-2",children:[e.jsx("h2",{className:"text-2xl font-bold bg-gradient-to-r from-emerald-400 to-red-400 bg-clip-text text-transparent",children:"Депозиты vs Выплаты"}),e.jsx("p",{className:"text-gray-300",children:"Симметричное сравнение операций для анализа баланса"})]}),e.jsxs("div",{className:"grid grid-cols-1 lg:grid-cols-2 gap-8",children:[e.jsxs("div",{className:"space-y-4",children:[e.jsx("div",{className:"text-center",children:e.jsxs("h3",{className:"text-xl font-bold text-emerald-400 flex items-center justify-center gap-2",children:[e.jsx(At,{className:"w-6 h-6"}),"Депозиты (Пополнения)"]})}),e.jsxs("div",{className:"grid grid-cols-1 sm:grid-cols-2 gap-4",children:[e.jsx($,{className:"border-emerald-500/20 bg-emerald-500/5",children:e.jsxs(E,{className:"p-4 text-center",children:[e.jsx("div",{className:"text-2xl font-bold text-emerald-400",children:p.deposits.total}),e.jsx("div",{className:"text-sm text-gray-400",children:"Всего операций"})]})}),e.jsx($,{className:"border-emerald-500/20 bg-emerald-500/5",children:e.jsxs(E,{className:"p-4 text-center",children:[e.jsx("div",{className:"text-2xl font-bold text-emerald-400",children:p.deposits.successful}),e.jsx("div",{className:"text-sm text-gray-400",children:"Успешных"})]})}),e.jsx($,{className:"border-emerald-500/20 bg-emerald-500/5",children:e.jsxs(E,{className:"p-4 text-center",children:[e.jsx("div",{className:"text-2xl font-bold text-emerald-400",children:j(p.deposits.successfulVolume)}),e.jsx("div",{className:"text-sm text-gray-400",children:"Успешный объем"})]})}),e.jsx($,{className:"border-emerald-500/20 bg-emerald-500/5",children:e.jsxs(E,{className:"p-4 text-center",children:[e.jsxs("div",{className:"text-2xl font-bold text-emerald-400",children:[p.deposits.conversionRate.toFixed(1),"%"]}),e.jsx("div",{className:"text-sm text-gray-400",children:"Конверсия"})]})})]})]}),e.jsxs("div",{className:"space-y-4",children:[e.jsx("div",{className:"text-center",children:e.jsxs("h3",{className:"text-xl font-bold text-red-400 flex items-center justify-center gap-2",children:[e.jsx(_e,{className:"w-6 h-6"}),"Выплаты (Выводы)"]})}),e.jsxs("div",{className:"grid grid-cols-1 sm:grid-cols-2 gap-4",children:[e.jsx($,{className:"border-red-500/20 bg-red-500/5",children:e.jsxs(E,{className:"p-4 text-center",children:[e.jsx("div",{className:"text-2xl font-bold text-red-400",children:p.withdrawals.total}),e.jsx("div",{className:"text-sm text-gray-400",children:"Всего операций"})]})}),e.jsx($,{className:"border-red-500/20 bg-red-500/5",children:e.jsxs(E,{className:"p-4 text-center",children:[e.jsx("div",{className:"text-2xl font-bold text-red-400",children:p.withdrawals.successful}),e.jsx("div",{className:"text-sm text-gray-400",children:"Успешных"})]})}),e.jsx($,{className:"border-red-500/20 bg-red-500/5",children:e.jsxs(E,{className:"p-4 text-center",children:[e.jsx("div",{className:"text-2xl font-bold text-red-400",children:j(p.withdrawals.successfulVolume)}),e.jsx("div",{className:"text-sm text-gray-400",children:"Успешный объем"})]})}),e.jsx($,{className:"border-red-500/20 bg-red-500/5",children:e.jsxs(E,{className:"p-4 text-center",children:[e.jsxs("div",{className:"text-2xl font-bold text-red-400",children:[p.withdrawals.conversionRate.toFixed(1),"%"]}),e.jsx("div",{className:"text-sm text-gray-400",children:"Конверсия"})]})})]})]})]}),e.jsx($,{className:"border-purple-500/20 bg-purple-500/5",children:e.jsxs(E,{className:"p-6",children:[e.jsxs(Z,{className:"mb-6 flex items-center gap-3",children:[e.jsx("div",{className:"w-10 h-10 bg-gradient-to-br from-purple-500 to-pink-500 rounded-xl flex items-center justify-center",children:e.jsx(G,{className:"w-5 h-5 text-white"})}),e.jsxs("div",{children:[e.jsx("h3",{className:"text-xl font-bold text-white",children:"Сравнение депозитов и выплат"}),e.jsx("p",{className:"text-sm text-gray-400",children:"Визуальное сравнение объемов и конверсии"})]})]}),e.jsx("div",{className:"h-64",children:e.jsx(Q,{width:"100%",height:"100%",children:e.jsxs(me,{data:[{type:"Депозиты",volume:p.deposits.successfulVolume,count:p.deposits.successful,conversion:p.deposits.conversionRate},{type:"Выплаты",volume:p.withdrawals.successfulVolume,count:p.withdrawals.successful,conversion:p.withdrawals.conversionRate}],margin:{top:20,right:30,left:20,bottom:5},children:[e.jsxs("defs",{children:[e.jsxs("linearGradient",{id:"depositGradient",x1:"0",y1:"0",x2:"0",y2:"1",children:[e.jsx("stop",{offset:"0%",stopColor:"#10B981",stopOpacity:1}),e.jsx("stop",{offset:"100%",stopColor:"#059669",stopOpacity:.8})]}),e.jsxs("linearGradient",{id:"withdrawalGradient",x1:"0",y1:"0",x2:"0",y2:"1",children:[e.jsx("stop",{offset:"0%",stopColor:"#EF4444",stopOpacity:1}),e.jsx("stop",{offset:"100%",stopColor:"#DC2626",stopOpacity:.8})]})]}),e.jsx(ee,{strokeDasharray:"3 3",stroke:"#374151",opacity:.3}),e.jsx(te,{dataKey:"type",stroke:"#9CA3AF",fontSize:12}),e.jsx(se,{stroke:"#9CA3AF",fontSize:12,tickFormatter:j}),e.jsx(ae,{content:e.jsx(S,{})}),e.jsx(ue,{dataKey:"volume",fill:(u,g)=>g===0?"url(#depositGradient)":"url(#withdrawalGradient)",radius:[4,4,0,0],name:"Объем"})]},`comparison-${t}`)})})]})})]}),e.jsxs("div",{className:"space-y-8",children:[e.jsxs("div",{className:"grid grid-cols-1 xl:grid-cols-2 gap-8",children:[e.jsx($,{className:"group hover:shadow-2xl hover:shadow-purple-500/10 transition-all duration-500",children:e.jsxs(E,{className:"p-6",children:[e.jsxs(Z,{className:"mb-6 flex items-center gap-3",children:[e.jsx("div",{className:"w-10 h-10 bg-gradient-to-br from-blue-500 to-cyan-500 rounded-xl flex items-center justify-center",children:e.jsx(we,{className:"w-5 h-5 text-white"})}),e.jsxs("div",{children:[e.jsx("h3",{className:"text-xl font-bold text-white",children:"Топ часы по объему"}),e.jsx("p",{className:"text-sm text-gray-400",children:"Активные часы с транзакциями"})]})]}),e.jsx("div",{className:"h-80",children:e.jsx(Q,{width:"100%",height:"100%",children:e.jsxs(me,{data:Array.isArray(a)?a:[],margin:{top:20,right:30,left:20,bottom:5},children:[e.jsx("defs",{children:e.jsxs("linearGradient",{id:"hourlyGradient",x1:"0",y1:"0",x2:"0",y2:"1",children:[e.jsx("stop",{offset:"0%",stopColor:"#8B5CF6",stopOpacity:1}),e.jsx("stop",{offset:"100%",stopColor:"#06B6D4",stopOpacity:.8})]})}),e.jsx(ee,{strokeDasharray:"3 3",stroke:"#374151",opacity:.3}),e.jsx(te,{dataKey:"shortHour",stroke:"#9CA3AF",fontSize:12,tickMargin:10}),e.jsx(se,{stroke:"#9CA3AF",fontSize:12,tickFormatter:j}),e.jsx(ae,{content:e.jsx(S,{})}),e.jsx(ue,{dataKey:"volume",fill:"url(#hourlyGradient)",radius:[4,4,0,0],name:"Объем"})]},`hourly-${t}`)})})]})}),e.jsx($,{className:"group hover:shadow-2xl hover:shadow-green-500/10 transition-all duration-500",children:e.jsxs(E,{className:"p-6",children:[e.jsxs(Z,{className:"mb-6 flex items-center gap-3",children:[e.jsx("div",{className:"w-10 h-10 bg-gradient-to-br from-green-500 to-emerald-500 rounded-xl flex items-center justify-center",children:e.jsx(V,{className:"w-5 h-5 text-white"})}),e.jsxs("div",{children:[e.jsx("h3",{className:"text-xl font-bold text-white",children:"Топ дни по объему"}),e.jsx("p",{className:"text-sm text-gray-400",children:"Лучшие дни по выручке"})]})]}),e.jsx("div",{className:"h-80",children:e.jsx(Q,{width:"100%",height:"100%",children:e.jsxs(me,{data:Array.isArray(c)?c:[],margin:{top:20,right:30,left:20,bottom:5},children:[e.jsx("defs",{children:e.jsxs("linearGradient",{id:"dailyGradient",x1:"0",y1:"0",x2:"0",y2:"1",children:[e.jsx("stop",{offset:"0%",stopColor:"#10B981",stopOpacity:1}),e.jsx("stop",{offset:"100%",stopColor:"#059669",stopOpacity:.8})]})}),e.jsx(ee,{strokeDasharray:"3 3",stroke:"#374151",opacity:.3}),e.jsx(te,{dataKey:"displayDate",stroke:"#9CA3AF",fontSize:12,angle:-45,textAnchor:"end",height:80}),e.jsx(se,{stroke:"#9CA3AF",fontSize:12,tickFormatter:j}),e.jsx(ae,{content:e.jsx(S,{})}),e.jsx(ue,{dataKey:"volume",fill:"url(#dailyGradient)",radius:[4,4,0,0],name:"Объем"})]},`daily-${t}`)})})]})})]}),e.jsx($,{className:"group hover:shadow-2xl hover:shadow-purple-500/10 transition-all duration-500",children:e.jsxs(E,{className:"p-6",children:[e.jsxs(Z,{className:"mb-6 flex items-center gap-3",children:[e.jsx("div",{className:"w-10 h-10 bg-gradient-to-br from-purple-500 to-pink-500 rounded-xl flex items-center justify-center",children:e.jsx(be,{className:"w-5 h-5 text-white"})}),e.jsxs("div",{children:[e.jsx("h3",{className:"text-xl font-bold text-white",children:"Конверсия по дням"}),e.jsx("p",{className:"text-sm text-gray-400",children:"Процент успешных операций"})]})]}),e.jsx("div",{className:"h-64",children:e.jsx(Q,{width:"100%",height:"100%",children:e.jsxs(Ye,{data:Array.isArray(c)?[...c].sort((u,g)=>new Date(u.date)-new Date(g.date)):[],margin:{top:20,right:30,left:20,bottom:5},children:[e.jsx("defs",{children:e.jsxs("linearGradient",{id:"conversionGradient",x1:"0",y1:"0",x2:"0",y2:"1",children:[e.jsx("stop",{offset:"0%",stopColor:"#F59E0B",stopOpacity:.8}),e.jsx("stop",{offset:"100%",stopColor:"#F59E0B",stopOpacity:.1})]})}),e.jsx(ee,{strokeDasharray:"3 3",stroke:"#374151",opacity:.3}),e.jsx(te,{dataKey:"displayDate",stroke:"#9CA3AF",fontSize:12}),e.jsx(se,{stroke:"#9CA3AF",fontSize:12,tickFormatter:u=>`${u}%`}),e.jsx(ae,{content:e.jsx(S,{})}),e.jsx(qe,{type:"monotone",dataKey:"conversionRate",stroke:"#F59E0B",fill:"url(#conversionGradient)",strokeWidth:3,name:"Конверсия (%)"})]},`conversion-${t}`)})})]})})]}),e.jsx($,{className:"bg-gradient-to-r from-purple-500/10 to-pink-500/10 border-purple-500/20",children:e.jsx(E,{className:"p-6",children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{className:"flex items-center gap-4",children:[e.jsx("div",{className:"w-12 h-12 bg-gradient-to-br from-purple-500 to-pink-500 rounded-xl flex items-center justify-center",children:e.jsx(Mt,{className:"w-6 h-6 text-white"})}),e.jsxs("div",{children:[e.jsx("h3",{className:"text-lg font-bold text-white",children:"Живая аналитика"}),e.jsx("p",{className:"text-sm text-gray-400",children:"Данные обновляются в реальном времени"})]})]}),e.jsxs("div",{className:"text-right",children:[e.jsx("p",{className:"text-2xl font-bold text-white",children:p.totalOperations}),e.jsx("p",{className:"text-sm text-gray-400",children:"операций обработано"})]})]})})})]})};We.register(Ge,Ke,He,Ze,Xe,Je,Qe,et,tt);function zt({data:l}){const s=R.useMemo(()=>[{label:"0-500",min:0,max:500},{label:"501-1000",min:501,max:1e3},{label:"1001-2000",min:1001,max:2e3},{label:"2001-5000",min:2001,max:5e3},{label:"5000+",min:5001,max:1/0}].map(i=>{const a=l.filter(f=>{const j=parseFloat(f["Initial Amount"])||0;return j>=i.min&&j<=i.max}),c=a.length,p=a.filter(f=>(f.Status?f.Status.toLowerCase():"")==="success").length;return{range:i.label,total:c,successful:p,conversion:c>0?p/c*100:0}}),[l]),n=R.useMemo(()=>["Пн","Вт","Ср","Чт","Пт","Сб","Вс"].map(i=>({day:i,operations:Math.floor(Math.random()*50)+20,conversion:Math.random()*40+40})),[]);R.useMemo(()=>{const r={};return l.forEach(i=>{const a=i.Status||"unknown";r[a]=(r[a]||0)+1}),r},[l]),R.useMemo(()=>{const r={};return l.forEach(i=>{const a=i["Operation State"]||"unknown";r[a]=(r[a]||0)+1}),r},[l]);const t={responsive:!0,maintainAspectRatio:!1,plugins:{legend:{labels:{color:"rgba(255, 255, 255, 0.8)",font:{size:12}}},tooltip:{backgroundColor:"rgba(0, 0, 0, 0.8)",titleColor:"white",bodyColor:"white",borderColor:"rgba(255, 255, 255, 0.2)",borderWidth:1}},scales:{x:{ticks:{color:"rgba(255, 255, 255, 0.7)"},grid:{color:"rgba(255, 255, 255, 0.1)"}},y:{ticks:{color:"rgba(255, 255, 255, 0.7)"},grid:{color:"rgba(255, 255, 255, 0.1)"}}}};return e.jsxs("div",{className:"space-y-6",children:[e.jsxs("div",{className:"flex items-center gap-3 mb-6",children:[e.jsx(Ne,{className:"w-6 h-6 text-blue-400"}),e.jsx("h3",{className:"text-xl font-semibold text-white",children:"Визуализация данных"})]}),e.jsxs("div",{className:"grid grid-cols-1 lg:grid-cols-2 gap-6",children:[e.jsxs("div",{className:"bg-white/5 backdrop-blur-sm rounded-xl p-6 border border-white/10",children:[e.jsxs("div",{className:"flex items-center gap-3 mb-4",children:[e.jsx(U,{className:"w-5 h-5 text-green-400"}),e.jsx("h4",{className:"text-lg font-medium text-white",children:"Конверсия по суммам"})]}),e.jsx("div",{className:"h-64",children:e.jsx(st,{data:{labels:s.map(r=>r.range),datasets:[{label:"Конверсия (%)",data:s.map(r=>r.conversion),backgroundColor:"rgba(34, 197, 94, 0.8)",borderColor:"rgba(34, 197, 94, 1)",borderWidth:1,borderRadius:8,borderSkipped:!1}]},options:t})})]}),e.jsxs("div",{className:"bg-white/5 backdrop-blur-sm rounded-xl p-6 border border-white/10",children:[e.jsxs("div",{className:"flex items-center gap-3 mb-4",children:[e.jsx(G,{className:"w-5 h-5 text-purple-400"}),e.jsx("h4",{className:"text-lg font-medium text-white",children:"Недельный тренд"})]}),e.jsx("div",{className:"h-64",children:e.jsx(at,{data:{labels:n.map(r=>r.day),datasets:[{label:"Операции",data:n.map(r=>r.operations),borderColor:"rgba(147, 51, 234, 1)",backgroundColor:"rgba(147, 51, 234, 0.1)",fill:!0,tension:.4,pointBackgroundColor:"rgba(147, 51, 234, 1)",pointBorderColor:"rgba(255, 255, 255, 0.8)",pointBorderWidth:2,pointRadius:4},{label:"Конверсия (%)",data:n.map(r=>r.conversion),borderColor:"rgba(34, 197, 94, 1)",backgroundColor:"rgba(34, 197, 94, 0.1)",fill:!0,tension:.4,pointBackgroundColor:"rgba(34, 197, 94, 1)",pointBorderColor:"rgba(255, 255, 255, 0.8)",pointBorderWidth:2,pointRadius:4}]},options:t})})]})]}),e.jsxs("div",{className:"bg-white/5 backdrop-blur-sm rounded-xl p-6 border border-white/10",children:[e.jsx("h4",{className:"text-lg font-medium text-white mb-4",children:"Анализ по диапазонам сумм"}),e.jsx("div",{className:"grid grid-cols-1 md:grid-cols-5 gap-4",children:s.map((r,i)=>e.jsxs("div",{className:"text-center",children:[e.jsx("div",{className:"text-lg font-bold text-blue-400",children:r.total}),e.jsxs("div",{className:"text-white/70 text-xs mb-1",children:[r.range," TRY"]}),e.jsxs("div",{className:"text-sm font-medium text-green-400",children:[r.conversion.toFixed(1),"%"]})]},i))})]})]})}function Bt({data:l,metrics:s}){const n={nextWeekConversion:Math.min(100,s.conversionRate+(Math.random()-.5)*10),expectedRevenue:s.successfulRevenue*1.1,riskFactors:[{factor:"Сезонность",impact:"Средний",probability:65},{factor:"Конкуренция",impact:"Высокий",probability:45},{factor:"Технические сбои",impact:"Низкий",probability:15}]},t=[{title:"Оптимизация конверсии",description:"Улучшить процесс завершения операций",impact:"Высокий",effort:"Средний"},{title:"Анализ неудачных операций",description:"Выявить причины отказов и устранить их",impact:"Высокий",effort:"Высокий"},{title:"Мониторинг аномалий",description:"Настроить систему раннего предупреждения",impact:"Средний",effort:"Низкий"}];return e.jsxs("div",{className:"space-y-6",children:[e.jsxs("div",{className:"flex items-center gap-3 mb-6",children:[e.jsx($e,{className:"w-6 h-6 text-purple-400"}),e.jsx("h3",{className:"text-xl font-semibold text-white",children:"Прогнозная аналитика"})]}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-6",children:[e.jsxs("div",{className:"bg-gradient-to-br from-blue-500/20 to-blue-600/20 rounded-xl p-6 border border-blue-500/30",children:[e.jsxs("div",{className:"flex items-center gap-3 mb-4",children:[e.jsx(U,{className:"w-5 h-5 text-blue-400"}),e.jsx("h4",{className:"text-lg font-medium text-white",children:"Прогноз конверсии"})]}),e.jsxs("div",{className:"text-3xl font-bold text-white mb-2",children:[n.nextWeekConversion.toFixed(1),"%"]}),e.jsx("div",{className:"text-blue-300 text-sm",children:"Ожидаемая конверсия на следующей неделе"}),e.jsxs("div",{className:"mt-4 flex items-center gap-2",children:[e.jsx("div",{className:"flex-1 bg-blue-900/30 rounded-full h-2",children:e.jsx("div",{className:"bg-blue-400 h-2 rounded-full transition-all duration-500",style:{width:`${n.nextWeekConversion}%`}})}),e.jsxs("span",{className:"text-blue-300 text-sm",children:[n.nextWeekConversion>s.conversionRate?"+":"",(n.nextWeekConversion-s.conversionRate).toFixed(1),"%"]})]})]}),e.jsxs("div",{className:"bg-gradient-to-br from-green-500/20 to-green-600/20 rounded-xl p-6 border border-green-500/30",children:[e.jsxs("div",{className:"flex items-center gap-3 mb-4",children:[e.jsx(be,{className:"w-5 h-5 text-green-400"}),e.jsx("h4",{className:"text-lg font-medium text-white",children:"Прогноз дохода"})]}),e.jsxs("div",{className:"text-3xl font-bold text-white mb-2",children:[(n.expectedRevenue/1e3).toFixed(0),"K"]}),e.jsx("div",{className:"text-green-300 text-sm",children:"Ожидаемый доход (TRY)"}),e.jsxs("div",{className:"mt-4 text-green-300 text-sm",children:["+",((n.expectedRevenue/s.successfulRevenue-1)*100).toFixed(1),"% от текущего уровня"]})]})]}),e.jsxs("div",{className:"bg-white/5 rounded-xl p-6",children:[e.jsxs("div",{className:"flex items-center gap-3 mb-4",children:[e.jsx(je,{className:"w-5 h-5 text-orange-400"}),e.jsx("h4",{className:"text-lg font-medium text-white",children:"Факторы риска"})]}),e.jsx("div",{className:"space-y-3",children:n.riskFactors.map((r,i)=>e.jsxs("div",{className:"flex items-center justify-between p-3 bg-white/5 rounded-lg",children:[e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("div",{className:`w-3 h-3 rounded-full ${r.impact==="Высокий"?"bg-red-400":r.impact==="Средний"?"bg-yellow-400":"bg-green-400"}`}),e.jsx("span",{className:"text-white font-medium",children:r.factor})]}),e.jsxs("div",{className:"flex items-center gap-4",children:[e.jsxs("span",{className:"text-white/70 text-sm",children:[r.impact," риск"]}),e.jsxs("span",{className:"text-white/70 text-sm",children:[r.probability,"%"]})]})]},i))})]}),e.jsxs("div",{className:"bg-white/5 rounded-xl p-6",children:[e.jsx("h4",{className:"text-lg font-medium text-white mb-4",children:"Рекомендации"}),e.jsx("div",{className:"space-y-4",children:t.map((r,i)=>e.jsxs("div",{className:"p-4 bg-white/5 rounded-lg",children:[e.jsxs("div",{className:"flex items-start justify-between mb-2",children:[e.jsx("h5",{className:"text-white font-medium",children:r.title}),e.jsxs("div",{className:"flex gap-2",children:[e.jsxs("span",{className:`px-2 py-1 rounded text-xs ${r.impact==="Высокий"?"bg-green-500/20 text-green-300":r.impact==="Средний"?"bg-yellow-500/20 text-yellow-300":"bg-blue-500/20 text-blue-300"}`,children:[r.impact," эффект"]}),e.jsxs("span",{className:`px-2 py-1 rounded text-xs ${r.effort==="Высокий"?"bg-red-500/20 text-red-300":r.effort==="Средний"?"bg-yellow-500/20 text-yellow-300":"bg-green-500/20 text-green-300"}`,children:[r.effort," усилия"]})]})]}),e.jsx("p",{className:"text-white/70 text-sm",children:r.description})]},i))})]})]})}const Re=({dataSource:l="csv",preloadedData:s=null,onBackToSelector:n=null})=>{const[t,r]=R.useState(s||[]),[i,a]=R.useState(s||[]),[c,p]=R.useState(null),[f,j]=R.useState([]),[S,u]=R.useState([]),[g,x]=R.useState(!1),[N,h]=R.useState(null),[k,w]=R.useState(l==="api"?"platform":null),[_,o]=R.useState("UTC"),[y,b]=R.useState({status:"",company:"",paymentMethod:"",transactionType:"",dateRange:{start:"",end:""},amountRange:{min:"",max:""}}),v=A=>{x(!0),h(null);const m=new FileReader;m.onload=I=>{try{const M=I.target.result;console.log("File content preview:",M.substring(0,500));const D=xt(M);if(console.log("Parsed data:",D.length,"rows"),D.length===0){h("Не удалось извлечь данные из файла. Проверьте формат файла."),x(!1);return}const L=D[0],P=L.hash||L.linkId||L.paymentMethod?"merchant":"platform";console.log("Detected data type:",P),r(D),a(D),w(P),x(!1)}catch(M){console.error("Error parsing file:",M),h("Ошибка при обработке файла: "+M.message),x(!1)}},m.onerror=()=>{h("Ошибка при чтении файла"),x(!1)},m.readAsText(A)};R.useEffect(()=>{s&&s.length>0&&(console.log("Loading preloaded data:",s.length,"items from",l),r(s),a(s),w(l==="api"?"platform":"merchant"))},[s,l]);const d=A=>{console.log("🔍 Applying filters:",A,"Data source:",l,"Data type:",k),console.log("📋 Sample data structure:",t.slice(0,2).map(I=>({status:I.status,company:I.company,paymentMethod:I.paymentMethod,transactionType:I.transactionType,type:I.type,isDeposit:I.isDeposit,isWithdraw:I.isWithdraw,createdAt:I.createdAt})));let m=[...t];if(A.status){const I=m.length;m=m.filter(M=>{if(l==="api"||l==="enhanced-api")return M.status===A.status;const D=(M.status||"").toLowerCase(),L=A.status.toLowerCase(),P=D===L||D.includes(L);return m.indexOf(M)<3&&console.log(`🔍 Status filter debug for row ${m.indexOf(M)}:`,{rowStatus:M.status,rowStatusLower:D,filterStatus:A.status,filterStatusLower:L,matches:P}),P}),console.log(`📊 Status filter: ${I} → ${m.length} (filter: "${A.status}")`)}if(A.company){const I=m.length;m=m.filter(M=>(M.company||M.project||"")===A.company),console.log(`🏢 Company filter: ${I} → ${m.length} (filter: "${A.company}")`)}if(A.paymentMethod){const I=m.length;m=m.filter(M=>(M.paymentMethod||M.paymentMethodCode||M.paymentProduct||"")===A.paymentMethod),console.log(`💳 Payment method filter: ${I} → ${m.length} (filter: "${A.paymentMethod}")`)}if(A.transactionType){const I=m.length;m=m.filter(M=>{const D=M.transactionType||M.type||"",L=A.transactionType.toLowerCase(),P=D.toLowerCase(),B=D===A.transactionType||P===L||L==="депозит"&&(M.isDeposit||P.includes("deposit")||P.includes("пополнение"))||L==="выплата"&&(M.isWithdraw||P.includes("withdraw")||P.includes("вывод"))||L.includes("deposit")&&(M.isDeposit||P.includes("deposit")||P.includes("пополнение"))||L.includes("withdraw")&&(M.isWithdraw||P.includes("withdraw")||P.includes("вывод"));return m.indexOf(M)<3&&console.log(`🔄 Transaction type filter debug for row ${m.indexOf(M)}:`,{transactionType:M.transactionType,type:M.type,filterType:A.transactionType,filterTypeLower:L,transactionTypeLower:P,isDeposit:M.isDeposit,isWithdraw:M.isWithdraw,matches:B}),B}),console.log(`🔄 Transaction type filter: ${I} → ${m.length} (filter: "${A.transactionType}")`)}if(A.dateRange.start||A.dateRange.end){const I=m.length;console.log("📅 Date filter applied. Before:",I,"Range:",A.dateRange,"Timezone:",_),m=m.filter(M=>{if(!M.createdAt)return console.log("⚠️ Row without createdAt:",M.id||"unknown"),!0;const D=new Date(M.createdAt);if(isNaN(D.getTime()))return console.log("⚠️ Invalid date format:",M.createdAt),!0;let L;try{M.createdAt.includes(" ")?L=M.createdAt.split(" ")[0]:M.createdAt.includes("T")?L=M.createdAt.split("T")[0]:L=M.createdAt}catch(P){return console.log("⚠️ Error parsing date:",M.createdAt,P),!0}return!(A.dateRange.start&&L<A.dateRange.start||A.dateRange.end&&L>A.dateRange.end)}),console.log(`📅 Date filter: ${I} → ${m.length} (range: ${A.dateRange.start} - ${A.dateRange.end})`)}(A.amountRange.min||A.amountRange.max)&&(m=m.filter(I=>{const M=parseFloat(I.amount)||0,D=parseFloat(A.amountRange.min)||0,L=parseFloat(A.amountRange.max)||1/0;return M>=D&&M<=L})),console.log(`🎯 Final result: ${t.length} → ${m.length} rows (${(m.length/t.length*100).toFixed(1)}% remaining)`),console.log("📋 Applied filters summary:",{status:A.status||"none",company:A.company||"none",paymentMethod:A.paymentMethod||"none",transactionType:A.transactionType||"none",dateRange:A.dateRange.start||A.dateRange.end?`${A.dateRange.start} - ${A.dateRange.end}`:"none",amountRange:A.amountRange.min||A.amountRange.max?`${A.amountRange.min} - ${A.amountRange.max}`:"none"}),b(A),a(m)},C=A=>{o(A),d(y)};return R.useEffect(()=>{if(i.length>0&&k){const A=ht(i,k);p(A);const m=pt(i,A);j(m);const I=wt(i);u(I)}},[i,k]),t.length===0&&l==="csv"?e.jsx("div",{className:"min-h-screen bg-gradient-to-br from-slate-900 via-purple-900 to-slate-900 flex items-center justify-center p-4",children:e.jsxs("div",{className:"w-full max-w-4xl space-y-8",children:[e.jsxs("div",{className:"text-center space-y-4",children:[e.jsx("div",{className:"w-20 h-20 bg-gradient-to-br from-blue-500 to-purple-600 rounded-full flex items-center justify-center mx-auto",children:e.jsx(U,{className:"w-10 h-10 text-white"})}),e.jsx("h1",{className:"text-4xl font-bold text-white",children:"Аналитика операций"}),e.jsx("p",{className:"text-xl text-gray-300 max-w-2xl mx-auto",children:"Загрузите CSV файл для анализа финансовых операций"})]}),e.jsx(Tt,{onFileUpload:v,loading:g}),N&&e.jsx("div",{className:"bg-red-500/20 border border-red-500/30 rounded-xl p-4 text-red-300",children:N})]})}):e.jsxs("div",{className:"min-h-screen bg-gradient-to-br from-slate-900 via-purple-900 to-slate-900",children:[e.jsx("div",{className:"bg-white/5 backdrop-blur-xl border-b border-white/10",children:e.jsx("div",{className:"max-w-7xl mx-auto px-4 py-6",children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{className:"flex items-center space-x-4",children:[e.jsx("div",{className:"w-12 h-12 bg-gradient-to-br from-blue-500 to-purple-600 rounded-xl flex items-center justify-center",children:e.jsx(U,{className:"w-6 h-6 text-white"})}),e.jsxs("div",{children:[e.jsx("h1",{className:"text-2xl font-bold text-white",children:"Аналитика операций"}),e.jsxs("div",{className:"flex items-center space-x-4",children:[e.jsxs("p",{className:"text-gray-300",children:[i.length," записей из ",t.length," •",l==="api"?e.jsx("span",{className:"text-green-400 ml-1",children:"🌐 API платформы"}):e.jsxs("span",{className:"text-blue-400 ml-1",children:["📂 ",k==="platform"?"Платформа":"Провайдер"]})]}),l==="api"&&e.jsx("span",{className:"px-2 py-1 bg-green-500/20 text-green-300 rounded-full text-xs border border-green-500/30",children:"Реальное время"})]})]})]}),e.jsxs("div",{className:"flex items-center space-x-4",children:[n&&e.jsx("button",{onClick:n,className:"px-4 py-2 bg-purple-500/20 text-purple-300 rounded-lg hover:bg-purple-500/30 transition-colors duration-200",children:"← Источник данных"}),l==="csv"&&e.jsx("button",{onClick:()=>{r([]),a([]),p(null),w(null),h(null),b({status:"",company:"",paymentMethod:"",transactionType:"",dateRange:{start:"",end:""},amountRange:{min:"",max:""}})},className:"px-4 py-2 bg-blue-500/20 text-blue-300 rounded-lg hover:bg-blue-500/30 transition-colors duration-200",children:"Загрузить новый файл"}),l==="api"&&n&&e.jsx("button",{onClick:n,className:"px-4 py-2 bg-green-500/20 text-green-300 rounded-lg hover:bg-green-500/30 transition-colors duration-200",children:"🔄 Обновить данные"})]})]})})}),e.jsxs("div",{className:"max-w-7xl mx-auto px-4 py-8 space-y-8",children:[c&&e.jsx(Ft,{metrics:c,dataType:k}),e.jsx("div",{className:"bg-white/5 backdrop-blur-xl rounded-2xl p-6 border border-white/10",children:e.jsxs("div",{className:"grid grid-cols-1 lg:grid-cols-3 gap-6",children:[e.jsx("div",{className:"lg:col-span-2",children:e.jsx($t,{data:t,filters:y,onFiltersChange:d,dataType:k})}),e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{className:"flex items-center space-x-3",children:[e.jsx("div",{className:"w-8 h-8 bg-gradient-to-br from-green-500 to-blue-600 rounded-lg flex items-center justify-center",children:e.jsx(U,{className:"w-4 h-4 text-white"})}),e.jsxs("div",{children:[e.jsx("h3",{className:"text-lg font-semibold text-white",children:"Часовой пояс"}),e.jsx("p",{className:"text-sm text-gray-400",children:"Выберите часовой пояс для анализа"})]})]}),e.jsx(Ut,{selectedTimezone:_,onTimezoneSelect:C})]})]})}),e.jsx(Dt,{data:i,metrics:c,dataType:k}),e.jsxs("div",{className:"bg-white/5 backdrop-blur-xl rounded-2xl p-6 border border-white/10",children:[e.jsxs("div",{className:"flex items-center space-x-3 mb-6",children:[e.jsx("div",{className:"w-8 h-8 bg-gradient-to-br from-purple-500 to-pink-600 rounded-lg flex items-center justify-center",children:e.jsx(G,{className:"w-4 h-4 text-white"})}),e.jsxs("div",{children:[e.jsx("h3",{className:"text-lg font-semibold text-white",children:"Временной анализ"}),e.jsxs("p",{className:"text-sm text-gray-400",children:["Активность по часам, дням недели и динамика • Часовой пояс: ",_]})]})]}),e.jsx(Vt,{data:i,timezone:_,dataType:k})]}),e.jsxs("div",{className:"bg-white/5 backdrop-blur-xl rounded-2xl p-6 border border-white/10",children:[e.jsxs("div",{className:"flex items-center space-x-3 mb-6",children:[e.jsx("div",{className:"w-8 h-8 bg-gradient-to-br from-blue-500 to-cyan-600 rounded-lg flex items-center justify-center",children:e.jsx(Ne,{className:"w-4 h-4 text-white"})}),e.jsxs("div",{children:[e.jsx("h3",{className:"text-lg font-semibold text-white",children:"Расширенная визуализация"}),e.jsx("p",{className:"text-sm text-gray-400",children:"Интерактивные графики с подробной аналитикой"})]})]}),e.jsx(zt,{data:i})]}),c&&e.jsxs("div",{className:"bg-white/5 backdrop-blur-xl rounded-2xl p-6 border border-white/10",children:[e.jsxs("div",{className:"flex items-center space-x-3 mb-6",children:[e.jsx("div",{className:"w-8 h-8 bg-gradient-to-br from-indigo-500 to-purple-600 rounded-lg flex items-center justify-center",children:e.jsx($e,{className:"w-4 h-4 text-white"})}),e.jsxs("div",{children:[e.jsx("h3",{className:"text-lg font-semibold text-white",children:"Прогнозная аналитика"}),e.jsx("p",{className:"text-sm text-gray-400",children:"Прогнозы и рекомендации на основе данных"})]})]}),e.jsx(Bt,{data:i,metrics:c})]}),l==="api"?e.jsx(Pt,{data:i}):e.jsx(Lt,{data:i,dataType:k}),f.length>0&&e.jsx(Et,{insights:f}),S.length>0&&e.jsx(Ot,{data:i,anomalies:S})]})]})},Yt=({onSourceChange:l,currentSource:s,onReconciliationClick:n})=>{const[t,r]=R.useState(s||"csv"),i=[{id:"csv",title:"Загрузка CSV файла",description:"Анализ данных от провайдера из CSV файла",icon:ie,color:"from-blue-500 to-cyan-600",features:["Детальный анализ транзакций","Поддержка больших файлов","Историческая аналитика","Данные от провайдера"]},{id:"api",title:"API платформы",description:"Получение актуальных данных через API коллектора",icon:W,color:"from-green-500 to-emerald-600",features:["Актуальная информация","Фильтрация по проектам","Реальное время","Данные платформы"]},{id:"enhanced-api",title:"Расширенный API 🚀",description:"Новые возможности коллектора: криптовалюты, информация о картах",icon:ne,color:"from-purple-500 to-pink-600",features:["💰 Поддержка криптовалют","💳 Детальная информация о картах","💱 Валютные курсы","🛡️ 3D Secure данные","🌍 IP геолокация"],isNew:!0}],a=c=>{r(c),l(c)};return e.jsx("div",{className:"min-h-screen bg-gradient-to-br from-slate-900 via-purple-900 to-slate-900 flex items-center justify-center p-4",children:e.jsxs("div",{className:"w-full max-w-6xl space-y-8",children:[e.jsxs("div",{className:"text-center space-y-4",children:[e.jsx("div",{className:"w-20 h-20 bg-gradient-to-br from-blue-500 to-purple-600 rounded-full flex items-center justify-center mx-auto",children:e.jsx(ne,{className:"w-10 h-10 text-white"})}),e.jsx("h1",{className:"text-4xl font-bold text-white",children:"Выберите источник данных"}),e.jsx("p",{className:"text-xl text-gray-300 max-w-2xl mx-auto",children:"Выберите способ получения данных для аналитики финансовых операций"})]}),e.jsx("div",{className:"grid grid-cols-1 lg:grid-cols-2 gap-8",children:i.map(c=>{const p=c.icon,f=t===c.id;return e.jsxs("div",{className:`relative group cursor-pointer transition-all duration-300 ${f?"scale-105 z-10":"hover:scale-102 hover:z-10"}`,onClick:()=>a(c.id),children:[e.jsxs("div",{className:`
                  bg-white/10 backdrop-blur-xl rounded-2xl p-8 border transition-all duration-300
                  ${f?"border-blue-500/50 bg-white/15 shadow-2xl shadow-blue-500/20":"border-white/20 hover:border-white/30 hover:bg-white/15"}
                `,children:[e.jsxs("div",{className:"flex items-center space-x-4 mb-6",children:[e.jsx("div",{className:`w-16 h-16 bg-gradient-to-br ${c.color} rounded-xl flex items-center justify-center`,children:e.jsx(p,{className:"w-8 h-8 text-white"})}),e.jsxs("div",{children:[e.jsx("h3",{className:"text-2xl font-bold text-white",children:c.title}),e.jsx("p",{className:"text-gray-300",children:c.description})]})]}),e.jsxs("div",{className:"space-y-3",children:[e.jsx("h4",{className:"text-lg font-semibold text-white",children:"Возможности:"}),e.jsx("ul",{className:"space-y-2",children:c.features.map((j,S)=>e.jsxs("li",{className:"flex items-center space-x-2 text-gray-300",children:[e.jsx("div",{className:"w-2 h-2 bg-gradient-to-r from-blue-400 to-purple-400 rounded-full"}),e.jsx("span",{children:j})]},S))})]}),f&&e.jsx("div",{className:"absolute top-4 right-4",children:e.jsx("div",{className:"w-8 h-8 bg-blue-500 rounded-full flex items-center justify-center",children:e.jsx("svg",{className:"w-5 h-5 text-white",fill:"currentColor",viewBox:"0 0 20 20",children:e.jsx("path",{fillRule:"evenodd",d:"M16.707 5.293a1 1 0 010 1.414l-8 8a1 1 0 01-1.414 0l-4-4a1 1 0 011.414-1.414L8 12.586l7.293-7.293a1 1 0 011.414 0z",clipRule:"evenodd"})})})}),e.jsx("div",{className:"mt-8",children:e.jsx("button",{className:`w-full py-3 px-6 rounded-lg font-semibold transition-all duration-200 ${f?"bg-gradient-to-r from-blue-500 to-purple-600 text-white shadow-lg":"bg-white/10 text-white hover:bg-white/20"}`,children:f?"Выбрано":"Выбрать этот источник"})})]}),f&&e.jsx("div",{className:"absolute inset-0 bg-gradient-to-br from-blue-500/20 to-purple-600/20 rounded-2xl blur-xl -z-10"})]},c.id)})}),e.jsxs("div",{className:"bg-white/5 backdrop-blur-xl rounded-2xl p-6 border border-white/10",children:[e.jsxs("div",{className:"flex items-center space-x-3 mb-4",children:[e.jsx(H,{className:"w-6 h-6 text-blue-400"}),e.jsx("h3",{className:"text-lg font-semibold text-white",children:"Сравнение источников"})]}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-3 gap-6 text-sm",children:[e.jsxs("div",{children:[e.jsx("h4",{className:"font-semibold text-white mb-2",children:"📂 CSV файлы (провайдер)"}),e.jsxs("ul",{className:"space-y-1 text-gray-300",children:[e.jsx("li",{children:"• Детальная информация о транзакциях"}),e.jsx("li",{children:"• Данные от Carrousel-Zorro, Zro_Monetix"}),e.jsx("li",{children:"• Статусы: Completed, Canceled, Failed"}),e.jsx("li",{children:"• Полная информация о комиссиях"})]})]}),e.jsxs("div",{children:[e.jsx("h4",{className:"font-semibold text-white mb-2",children:"🌐 API платформы"}),e.jsxs("ul",{className:"space-y-1 text-gray-300",children:[e.jsx("li",{children:"• Актуальные данные в реальном времени"}),e.jsx("li",{children:"• Проекты: Monetix, Caroussel"}),e.jsx("li",{children:"• Статусы: Success, Fail"}),e.jsx("li",{children:"• Фильтрация по датам и проектам"})]})]}),e.jsxs("div",{children:[e.jsxs("h4",{className:"font-semibold text-white mb-2",children:["🚀 Расширенный API ",e.jsx("span",{className:"text-xs bg-purple-500/30 px-2 py-1 rounded-full",children:"НОВОЕ"})]}),e.jsxs("ul",{className:"space-y-1 text-gray-300",children:[e.jsx("li",{children:"• Поддержка криптовалют (fiat/crypto)"}),e.jsx("li",{children:"• Информация о картах и 3D Secure"}),e.jsx("li",{children:"• Валютные курсы и MCC коды"}),e.jsx("li",{children:"• IP адреса и геолокация"})]})]})]})]}),e.jsx("div",{className:"text-center",children:e.jsxs("div",{className:"bg-white/5 backdrop-blur-sm border border-white/10 rounded-xl p-6",children:[e.jsx("h3",{className:"text-xl font-bold text-white mb-3",children:"🔄 Сверка данных"}),e.jsx("p",{className:"text-gray-300 mb-4",children:"Сравните данные от провайдера и платформы для выявления расхождений"}),e.jsx("button",{onClick:n,className:"px-6 py-3 bg-gradient-to-r from-orange-500 to-red-600 text-white font-semibold rounded-lg shadow-lg hover:from-orange-600 hover:to-red-700 transition-all duration-200",children:"Запустить сверку"})]})}),t&&e.jsx("div",{className:"text-center",children:e.jsxs("button",{onClick:()=>l(t),className:"px-8 py-4 bg-gradient-to-r from-blue-500 to-purple-600 text-white font-bold rounded-xl shadow-lg hover:from-blue-600 hover:to-purple-700 transition-all duration-200 text-lg",children:["Продолжить с ",t==="csv"?"CSV файлами":t==="enhanced-api"?"Расширенным API":"API платформы"]})})]})})},qt={}.VITE_API_BASE_URL||"https://payment.woozuki.com/collector1/api/v1",Wt={}.VITE_API_KEY||"master-3E193252DE4A4B4C80862F67B2972D3D";class Gt{constructor(){this.baseUrl=qt,this.apiKey=Wt}buildUrl(s,n={}){const t=new URL(`${this.baseUrl}/${s}`);return t.searchParams.set("apikey",this.apiKey),Object.entries(n).forEach(([r,i])=>{i!=null&&i!==""&&t.searchParams.set(r,i)}),t.toString()}async makeRequest(s,n={}){const t=this.buildUrl(s,n);console.log("API Request URL:",t);try{const r=await fetch(t,{method:"GET",headers:{Accept:"application/json","Content-Type":"application/json"}});if(!r.ok)throw new Error(`HTTP error! status: ${r.status}`);const i=await r.json();return console.log("API Response:",i),i}catch(r){throw console.error("API Request failed:",r),r}}async getOperations(s={}){const n={};return s.project&&(n.project=s.project),s.status&&(n.status=s.status),s.descending!==void 0&&(n.descending=s.descending),s.count&&(n.count=s.count),s.date&&(n.date=s.date),s.from&&(n.from=s.from),s.to&&(n.to=s.to),await this.makeRequest("operation",n)}async getLatestOperations(s,n=100){return await this.getOperations({project:s,descending:!0,count:n,status:"success"})}async getOperationsByDate(s,n,t=null){const r={project:s,date:n,descending:!1};return t&&(r.status=t),await this.getOperations(r)}async getOperationsByDateRange(s,n,t,r=null){const i={project:s,from:n,to:t,descending:!1};return r&&(i.status=r),await this.getOperations(i)}getAvailableProjects(){return[{value:"",label:"Все проекты"},{value:"monetix",label:"Monetix"},{value:"caroussel",label:"Caroussel"}]}getAvailableStatuses(){return[{value:"success",label:"Успешно"},{value:"fail",label:"Ошибка"},{value:"in_process",label:"В процессе"}]}}const re=new Gt;function Kt(l){if(!l||!Array.isArray(l))return console.warn("Invalid API data:",l),[];console.log(`Normalizing ${l.length} operations from API`);const s=l.map((n,t)=>{var g,x,N,h,k,w,_,o;console.log(`Processing operation ${t+1}:`,{id:n.operation_id,status:n.current_status,hasComplete:!!n.complete_amount,hasCardStart:!!(n.card_start&&n.card_start.length>0),hasCreateParams:!!n.create_params});let r="",i="",a="";try{if((h=(N=(x=(g=n.create_params)==null?void 0:g.params)==null?void 0:x.payment)==null?void 0:N.payer)!=null&&h.person){const y=n.create_params.params.payment.payer.person;i=y.first_name||"",a=y.last_name||"",r=`${i} ${a}`.trim()}}catch(y){console.warn("Error extracting user name:",y)}const c=((k=n.create_params)==null?void 0:k.method)||"",p=c==="payment.in",f=c==="payment.out";let j=0,S="TRY";if(n.complete_amount)j=parseFloat(n.complete_amount),S=n.complete_currency||"TRY";else if(n.card_start&&n.card_start.length>0)j=parseFloat(n.card_start[0].amount||0),S=n.card_start[0].currency||"TRY";else try{const y=(o=(_=(w=n.create_params)==null?void 0:w.params)==null?void 0:_.payment)==null?void 0:o.amount;y&&(j=parseFloat(y.value||0)/100,S=y.currency||"TRY")}catch(y){console.warn("Error extracting amount from create_params:",y)}console.log(`Operation ${n.operation_id}: amount=${j} ${S}, source=${n.complete_amount?"complete":n.card_start&&n.card_start.length>0?"card_start":"create_params"}`);let u=0;try{n.card_finish&&n.card_finish.length>0&&(u=parseFloat(n.card_finish[0].charged_fee||0))}catch(y){console.warn("Error extracting fee:",y)}return{id:n.operation_id||n.reference_id||"",status:n.current_status||n.payment_status||"",amount:j,type:p?"deposit":f?"withdraw":"unknown",company:n.project||"",fee:u,feeRatio:u>0&&j>0?`${(u/j*100).toFixed(2)}%`:"0%",transactionType:p?"Пополнение":f?"Вывод":"Неизвестно",isDeposit:p,isWithdraw:f,userName:r||n.user_id||"",userId:n.user_id||"",fullName:r,createdAt:n.operation_created_at||n.complete_created_at||"",processedAt:n.complete_modified_at||n.operation_modified_at||"",paymentMethod:n.payment_method_code||n.payment_product||"",paymentGateway:n.payment_product||"",hash:n.operation_id||"",ipAddress:n.ip_addr||"",linkId:n.reference_id||"",clientOperationId:n.client_operation_id||"",isCompleted:(n.current_status||"").toLowerCase()==="success",isCanceled:!1,isFailed:(n.current_status||"").toLowerCase()==="fail",isInProcess:(n.current_status||"").toLowerCase()==="in_process",amountFormatted:new Intl.NumberFormat("tr-TR",{style:"currency",currency:S}).format(j),feeFormatted:new Intl.NumberFormat("tr-TR",{style:"currency",currency:S}).format(u),operationState:n.operation_state||"",paymentMethodType:n.payment_method_type||"",integrationMethod:n.integration_type||"",serviceEnv:n.service_env||"",projectEnv:n.project_env||"",dataSource:"api"}}).filter(n=>{const t=n.id&&(n.amount>0||n.status==="in_process");return t||console.warn("Skipping invalid operation:",{id:n.id,amount:n.amount,status:n.status}),t});return console.log(`Successfully normalized ${s.length} valid operations`),s.length>0&&console.log("Sample normalized operation:",s[0]),s}const ye="/.netlify/functions";async function Ht(l,s){try{console.log("📤 Sending files to reconciliation server..."),console.log("🔗 API URL:",ye);const n=50*1024*1024;if(console.log("📊 File sizes:",{merchant:`${(l.size/1024/1024).toFixed(2)}MB`,platform:`${(s.size/1024/1024).toFixed(2)}MB`,merchantBytes:l.size,platformBytes:s.size,maxSizeBytes:n}),l.size>n||s.size>n)throw new Error(`Файл слишком большой. Максимальный размер: 50MB. Merchant: ${(l.size/1024/1024).toFixed(2)}MB, Platform: ${(s.size/1024/1024).toFixed(2)}MB`);console.log("📄 Converting files to base64...");const t=await Me(l),r=await Me(s);console.log("📤 Sending request to server...");const i=await fetch(`${ye}/reconcile`,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({merchantFile:t,platformFile:r})});if(!i.ok){const c=await i.json();throw new Error(c.error||`HTTP ${i.status}: ${i.statusText}`)}const a=await i.json();return console.log("✅ Reconciliation completed successfully"),a}catch(n){throw console.error("❌ Reconciliation API error:",n),n}}function Me(l){return new Promise((s,n)=>{const t=new FileReader;t.onload=()=>{const r=t.result.split(",")[1];s(r)},t.onerror=()=>n(new Error("Ошибка чтения файла")),t.readAsDataURL(l)})}async function Zt(){try{const l=await fetch(`${ye}/health`);if(l.ok){const s=await l.json();return console.log("✅ Server health check passed:",s),!0}else return console.warn("⚠️ Server health check failed:",l.status),!1}catch(l){return console.error("❌ Server health check error:",l),!1}}const Xt=({onDataLoad:l,loading:s,setLoading:n,onBack:t=null})=>{const[r,i]=R.useState({project:"",status:"success",dateMode:"latest",date:"",from:"",to:"",count:100,descending:!0}),[a,c]=R.useState(null),p=re.getAvailableProjects(),f=re.getAvailableStatuses(),j=[{value:"latest",label:"Последние операции"},{value:"single",label:"Конкретная дата"},{value:"range",label:"Диапазон дат"}],S=async()=>{n(!0),c(null);try{let g={status:r.status,descending:r.descending};switch(r.project&&(g.project=r.project),r.dateMode){case"latest":g.count=r.count;break;case"single":if(!r.date){c("Выберите дату"),n(!1);return}g.date=r.date;break;case"range":if(!r.from||!r.to){c("Выберите диапазон дат"),n(!1);return}g.from=r.from,g.to=r.to;break}console.log("Loading data with filters:",g);const x=await re.getOperations(g);l(x,"api")}catch(g){console.error("Failed to load API data:",g),c(`Ошибка загрузки данных: ${g.message}`)}finally{n(!1)}},u=[{name:"Все проекты (100 последних)",action:()=>{i({...r,project:"",status:"success",dateMode:"latest",count:100,descending:!0})}},{name:"Все статусы (50 последних)",action:()=>{i({...r,project:"",status:"",dateMode:"latest",count:50,descending:!0})}},{name:"Последние 50 Monetix",action:()=>{i({...r,project:"monetix",status:"success",dateMode:"latest",count:50,descending:!0})}},{name:"Сегодня все проекты",action:()=>{const g=new Date().toISOString().split("T")[0];i({...r,project:"",status:"success",dateMode:"single",date:g})}},{name:"Последняя неделя все проекты",action:()=>{const g=new Date,x=new Date(g.getTime()-7*24*60*60*1e3);i({...r,project:"",dateMode:"range",from:x.toISOString().split("T")[0],to:g.toISOString().split("T")[0]})}}];return e.jsx("div",{className:"min-h-screen bg-gradient-to-br from-slate-900 via-purple-900 to-slate-900 flex items-center justify-center p-4",children:e.jsxs("div",{className:"w-full max-w-4xl space-y-8",children:[e.jsxs("div",{className:"text-center space-y-4",children:[e.jsx("div",{className:"w-20 h-20 bg-gradient-to-br from-green-500 to-emerald-600 rounded-full flex items-center justify-center mx-auto",children:e.jsx(W,{className:"w-10 h-10 text-white"})}),e.jsx("h1",{className:"text-4xl font-bold text-white",children:"API Коллектора"}),e.jsx("p",{className:"text-xl text-gray-300 max-w-2xl mx-auto",children:"Настройте фильтры для получения актуальных данных с платформы"}),t&&e.jsx("button",{onClick:t,className:"mt-4 px-6 py-2 bg-white/10 text-white rounded-lg hover:bg-white/20 transition-colors duration-200",children:"← Назад к выбору источника"})]}),e.jsxs("div",{className:"bg-white/10 backdrop-blur-xl rounded-2xl p-8 border border-white/20",children:[e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-6",children:[e.jsxs("div",{className:"space-y-2",children:[e.jsxs("label",{className:"text-sm font-medium text-white flex items-center",children:[e.jsx(ne,{className:"w-4 h-4 text-green-400 mr-2"}),"Проект"]}),e.jsx("select",{value:r.project,onChange:g=>i({...r,project:g.target.value}),className:"w-full px-3 py-2 bg-white/10 border border-white/20 rounded-lg text-white focus:outline-none focus:ring-2 focus:ring-green-500",children:p.map(g=>e.jsx("option",{value:g.value,children:g.label},g.value))})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsxs("label",{className:"text-sm font-medium text-white flex items-center",children:[e.jsx("div",{className:"w-4 h-4 bg-gradient-to-br from-green-500 to-emerald-500 rounded-full mr-2"}),"Статус"]}),e.jsxs("select",{value:r.status,onChange:g=>i({...r,status:g.target.value}),className:"w-full px-3 py-2 bg-white/10 border border-white/20 rounded-lg text-white focus:outline-none focus:ring-2 focus:ring-green-500",children:[e.jsx("option",{value:"",children:"Все статусы"}),f.map(g=>e.jsx("option",{value:g.value,children:g.label},g.value))]})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsxs("label",{className:"text-sm font-medium text-white flex items-center",children:[e.jsx(V,{className:"w-4 h-4 text-purple-400 mr-2"}),"Режим выборки"]}),e.jsx("select",{value:r.dateMode,onChange:g=>i({...r,dateMode:g.target.value}),className:"w-full px-3 py-2 bg-white/10 border border-white/20 rounded-lg text-white focus:outline-none focus:ring-2 focus:ring-green-500",children:j.map(g=>e.jsx("option",{value:g.value,children:g.label},g.value))})]}),r.dateMode==="latest"&&e.jsxs("div",{className:"space-y-2",children:[e.jsxs("label",{className:"text-sm font-medium text-white flex items-center",children:[e.jsx(q,{className:"w-4 h-4 text-blue-400 mr-2"}),"Количество записей"]}),e.jsx("input",{type:"number",min:"1",max:"1000",value:r.count,onChange:g=>i({...r,count:parseInt(g.target.value)||100}),className:"w-full px-3 py-2 bg-white/10 border border-white/20 rounded-lg text-white focus:outline-none focus:ring-2 focus:ring-green-500"})]}),r.dateMode==="single"&&e.jsxs("div",{className:"space-y-2",children:[e.jsxs("label",{className:"text-sm font-medium text-white flex items-center",children:[e.jsx(V,{className:"w-4 h-4 text-purple-400 mr-2"}),"Дата"]}),e.jsx("input",{type:"date",value:r.date,onChange:g=>i({...r,date:g.target.value}),className:"w-full px-3 py-2 bg-white/10 border border-white/20 rounded-lg text-white focus:outline-none focus:ring-2 focus:ring-green-500"})]}),r.dateMode==="range"&&e.jsxs(e.Fragment,{children:[e.jsxs("div",{className:"space-y-2",children:[e.jsxs("label",{className:"text-sm font-medium text-white flex items-center",children:[e.jsx(V,{className:"w-4 h-4 text-purple-400 mr-2"}),"От"]}),e.jsx("input",{type:"date",value:r.from,onChange:g=>i({...r,from:g.target.value}),className:"w-full px-3 py-2 bg-white/10 border border-white/20 rounded-lg text-white focus:outline-none focus:ring-2 focus:ring-green-500"})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsxs("label",{className:"text-sm font-medium text-white flex items-center",children:[e.jsx(V,{className:"w-4 h-4 text-purple-400 mr-2"}),"До"]}),e.jsx("input",{type:"date",value:r.to,onChange:g=>i({...r,to:g.target.value}),className:"w-full px-3 py-2 bg-white/10 border border-white/20 rounded-lg text-white focus:outline-none focus:ring-2 focus:ring-green-500"})]})]})]}),e.jsx("div",{className:"mt-6",children:e.jsxs("label",{className:"flex items-center space-x-2 text-white",children:[e.jsx("input",{type:"checkbox",checked:r.descending,onChange:g=>i({...r,descending:g.target.checked}),className:"w-4 h-4 text-green-600 bg-white/10 border-white/20 rounded focus:ring-green-500"}),e.jsx("span",{children:"Новые записи сверху"})]})}),e.jsx("div",{className:"mt-8",children:e.jsx("button",{onClick:S,disabled:s,className:`w-full py-3 px-6 rounded-lg font-semibold transition-all duration-200 flex items-center justify-center space-x-2 ${s?"bg-gray-500 cursor-not-allowed":"bg-gradient-to-r from-green-500 to-emerald-600 hover:from-green-600 hover:to-emerald-700"} text-white`,children:s?e.jsxs(e.Fragment,{children:[e.jsx(Oe,{className:"w-5 h-5 animate-spin"}),e.jsx("span",{children:"Загрузка..."})]}):e.jsxs(e.Fragment,{children:[e.jsx(de,{className:"w-5 h-5"}),e.jsx("span",{children:"Загрузить данные"})]})})}),a&&e.jsx("div",{className:"mt-4 p-4 bg-red-500/20 border border-red-500/30 rounded-lg text-red-300",children:a})]}),e.jsxs("div",{className:"bg-white/5 backdrop-blur-xl rounded-2xl p-6 border border-white/10",children:[e.jsx("h3",{className:"text-lg font-semibold text-white mb-4",children:"Быстрые настройки"}),e.jsx("div",{className:"grid grid-cols-1 md:grid-cols-3 gap-4",children:u.map((g,x)=>e.jsx("button",{onClick:g.action,className:"p-4 bg-white/10 rounded-lg text-white hover:bg-white/20 transition-colors duration-200 text-left",children:g.name},x))})]}),e.jsxs("div",{className:"bg-white/5 backdrop-blur-xl rounded-2xl p-6 border border-white/10",children:[e.jsx("h3",{className:"text-lg font-semibold text-white mb-4",children:"Информация об API"}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-6 text-sm text-gray-300",children:[e.jsxs("div",{children:[e.jsx("h4",{className:"font-semibold text-white mb-2",children:"Доступные проекты:"}),e.jsxs("ul",{className:"space-y-1",children:[e.jsxs("li",{children:["• ",e.jsx("span",{className:"text-green-400",children:"Monetix"})," - основной проект"]}),e.jsxs("li",{children:["• ",e.jsx("span",{className:"text-blue-400",children:"Caroussel"})," - дополнительный проект"]})]})]}),e.jsxs("div",{children:[e.jsx("h4",{className:"font-semibold text-white mb-2",children:"Статусы операций:"}),e.jsxs("ul",{className:"space-y-1",children:[e.jsxs("li",{children:["• ",e.jsx("span",{className:"text-green-400",children:"Success"})," - успешные операции"]}),e.jsxs("li",{children:["• ",e.jsx("span",{className:"text-red-400",children:"Fail"})," - неудачные операции"]})]})]})]})]})]})})};class Jt{constructor(){this.baseApi=re,this.endpoints={operations:"operation",analytics:"analytics",realtime:"realtime",notifications:"notifications",insights:"insights",users:"users",geography:"geography",performance:"performance"}}async getOperations(s={}){return await this.baseApi.getOperations(s)}getAvailableProjects(){return this.baseApi.getAvailableProjects()}getAvailableStatuses(){return this.baseApi.getAvailableStatuses()}async getOperationsEnhanced(s={}){console.log("🚀 Enhanced API Request - Input filters:",s);const n={};s.project_id&&(n.project=s.project_id),s.status&&(n.status=s.status),s.count&&(n.count=s.count),s.descending!==void 0&&(n.descending=s.descending),s.date&&(n.date=s.date),s.from&&(n.from=s.from),s.to&&(n.to=s.to),console.log("📤 API Request parameters:",n);try{const t=await this.baseApi.makeRequest("operation",n);return console.log("📥 Raw API Response:",{dataType:typeof t,isArray:Array.isArray(t),length:Array.isArray(t)?t.length:"not array",firstItem:Array.isArray(t)&&t.length>0?t[0]:null}),Array.isArray(t)&&t.length>0&&console.log("📋 Sample data structure:",{keys:Object.keys(t[0]),status:t[0].operation_status||t[0].status,amount:t[0].operation_amount||t[0].amount,date:t[0].operation_created_at||t[0].date}),t}catch(t){throw console.error("❌ Enhanced API Request failed:",t),t}}async getRealTimeData(s={}){return console.log("Real-time data - awaiting API documentation"),null}async getNotifications(s={}){return console.log("Notifications - awaiting API documentation"),null}async getInsights(s={}){return console.log("AI Insights - awaiting API documentation"),null}async getUserAnalytics(s={}){return console.log("User analytics - awaiting API documentation"),null}async getGeographyData(s={}){return console.log("Geography data - awaiting API documentation"),null}async getPerformanceMetrics(s={}){return console.log("Performance metrics - awaiting API documentation"),null}async getComparativeAnalysis(s,n){return console.log("Comparative analysis - awaiting API documentation"),null}async getForecast(s={}){return console.log("Forecast - awaiting API documentation"),null}async makeEnhancedRequest(s,n={}){const t={}.REACT_APP_API_BASE_URL||"https://sandbox.finmar.tech/collector/api/v3",r=new URLSearchParams;Object.entries(n).forEach(([a,c])=>{c!=null&&c!==""&&r.append(a,c)});const i=`${t}/${s}${r.toString()?"?"+r.toString():""}`;try{const a=btoa(`${{}.REACT_APP_API_USERNAME||""}:${{}.REACT_APP_API_PASSWORD||""}`),c=await fetch(i,{method:"GET",headers:{Accept:"application/json","Content-Type":"application/json",Authorization:`Basic ${a}`}});if(!c.ok)throw new Error(`HTTP error! status: ${c.status}`);const p=await c.json();return console.log(`Enhanced API Response from ${s}:`,p),p}catch(a){throw console.error(`Enhanced API Request to ${s} failed:`,a),a}}async checkEndpointAvailability(s){try{const n={}.REACT_APP_API_BASE_URL||"https://sandbox.finmar.tech/collector/api/v3",t=btoa(`${{}.REACT_APP_API_USERNAME||""}:${{}.REACT_APP_API_PASSWORD||""}`);return(await fetch(`${n}/${s}`,{method:"HEAD",headers:{Authorization:`Basic ${t}`}})).ok}catch{return!1}}async getEndpointSchema(s){try{return await this.makeEnhancedRequest(`${s}/schema`)}catch{return null}}}const Qt=new Jt;function es(l,s="operations"){switch(s){case"operations":return Te(l);case"enhanced-operations":return Te(l);case"users":return l;case"geography":return l;default:return console.warn(`Unknown data type: ${s}`),l}}function Te(l){if(console.log("🔄 Starting data normalization:",{inputType:typeof l,isArray:Array.isArray(l),length:Array.isArray(l)?l.length:"not array"}),!l||!Array.isArray(l))return console.warn("❌ Invalid enhanced API data:",l),[];if(l.length>0){const t=l[0],r=Object.keys(t),i=r.filter(a=>a.toLowerCase().includes("direction")||a.toLowerCase().includes("type")||a.toLowerCase().includes("method")||a.toLowerCase().includes("operation"));console.log("🔍 Available fields for direction detection:",{totalFields:r.length,directionRelatedFields:i,sampleKeys:r.slice(0,10)})}const s=l.map((t,r)=>{var o,y,b,v,d,C,A,m,I,M,D,L,P,B,ke;r<3&&console.log(`🔍 Processing operation ${r+1}:`,{originalKeys:Object.keys(t),operation_status:t.operation_status,status:t.status,operation_amount:t.operation_amount,amount:t.amount,operation_created_at:t.operation_created_at,date:t.date});let i=0,a="TRY",c=0;if(t.card_start&&t.card_start.length>0){const F=t.card_start[0];i=parseFloat(F.amount||0),a=F.currency||"TRY"}if(i===0&&((b=(y=(o=t.create_params)==null?void 0:o.params)==null?void 0:y.payment)!=null&&b.amount)){const F=t.create_params.params.payment.amount;i=parseFloat(F.value||0)/100,a=F.currency||"TRY"}i===0&&(i=parseFloat(t.operation_amount||((v=t.payment_info)==null?void 0:v.amount)||t.amount||t.transactionAmount||0)),a==="TRY"&&t.operation_currency&&(a=t.operation_currency),r<3&&console.log(`💰 Amount extraction for operation ${r+1}:`,{card_start_amount:(C=(d=t.card_start)==null?void 0:d[0])==null?void 0:C.amount,create_params_amount:(M=(I=(m=(A=t.create_params)==null?void 0:A.params)==null?void 0:m.payment)==null?void 0:I.amount)==null?void 0:M.value,final_amount:i,currency:a});const p=((D=t.create_params)==null?void 0:D.method)||"";let f=!1,j=!1,S="unknown";if(p==="payment.in"?(f=!0,S="deposit"):p==="payment.out"&&(j=!0,S="withdraw"),!f&&!j&&t.operation_type){const F=t.operation_type.toLowerCase();F.includes("deposit")||F.includes("in")||F.includes("пополнение")?(f=!0,S="deposit"):(F.includes("withdraw")||F.includes("out")||F.includes("вывод"))&&(j=!0,S="withdraw")}if(!f&&!j&&t.transaction_type){const F=t.transaction_type.toLowerCase();F.includes("deposit")||F.includes("in")||F.includes("пополнение")?(f=!0,S="deposit"):(F.includes("withdraw")||F.includes("out")||F.includes("вывод"))&&(j=!0,S="withdraw")}if(!f&&!j&&((L=t.payment_info)!=null&&L.direction)){const F=t.payment_info.direction.toLowerCase();F==="in"||F==="deposit"?(f=!0,S="deposit"):(F==="out"||F==="withdraw")&&(j=!0,S="withdraw")}if(!f&&!j&&t.direction){const F=t.direction.toLowerCase();F==="in"||F==="deposit"||F==="incoming"?(f=!0,S="deposit"):(F==="out"||F==="withdraw"||F==="outgoing")&&(j=!0,S="withdraw")}if(!f&&!j&&t.flow){const F=t.flow.toLowerCase();F==="in"||F==="deposit"||F==="incoming"?(f=!0,S="deposit"):(F==="out"||F==="withdraw"||F==="outgoing")&&(j=!0,S="withdraw")}!f&&!j&&i!==0&&(i>0?(f=!0,S="deposit"):i<0&&(j=!0,S="withdraw",i=Math.abs(i)));const u=t.payment_method_code||t.payment_method||((P=t.payment_info)==null?void 0:P.method)||"unknown",g=t.payment_method_type||"fiat",x=g==="crypto"||u.toLowerCase().includes("crypto")||u.toLowerCase().includes("bitcoin")||u.toLowerCase().includes("ethereum"),N=!x;r<3&&console.log(`🏦 Transaction type for operation ${r+1}:`,{"create_params.method":p,operation_type:t.operation_type,transaction_type:t.transaction_type,"payment_info.direction":(B=t.payment_info)==null?void 0:B.direction,direction:t.direction,flow:t.flow,amount:i,transactionDirection:S,isDeposit:f,isWithdraw:j,paymentMethod:u,paymentMethodType:g,isCrypto:x});const h=t.current_status||t.payment_status||t.operation_status||t.status||"unknown",k=h.toLowerCase();r<3&&console.log(`📊 Status extraction for operation ${r+1}:`,{current_status:t.current_status,payment_status:t.payment_status,operation_status:t.operation_status,final_status:h});const w=k==="success"||k==="completed"||k==="complete",_={id:t.operation_id||t.id,status:h,amount:i,currency:a,fee:c,feeRatio:c>0&&i>0?`${(c/i*100).toFixed(2)}%`:"0%",type:S,isDeposit:f,isWithdraw:j,transactionType:f?"Пополнение":j?"Вывод":"Неизвестно",directionSources:{"create_params.method":p,operation_type:t.operation_type||null,transaction_type:t.transaction_type||null,"payment_info.direction":((ke=t.payment_info)==null?void 0:ke.direction)||null,direction:t.direction||null,flow:t.flow||null,determined_direction:S,detection_success:S!=="unknown"},referenceId:t.reference_id||t.operation_id||t.id,clientOperationId:t.client_operation_id||t.operation_hash||t.hash,project:t.project||t.project_name||"unknown",credentialsOwner:t.credentials_owner||t.project||"unknown",userId:t.user_id||t.id||"unknown",ipAddress:t.ip_addr||t.user_ip||null,contact:t.contact||null,paymentProduct:t.payment_product||"api_payment",paymentMethodType:t.payment_method_type||(x?"crypto":"fiat"),paymentMethodCode:t.payment_method_code||u,isCrypto:x,isFiat:N,operationState:t.operation_state||(w?"complete":"in_process"),paymentStatusFlag:t.payment_status_flag||{success:w,in_process:k==="in_process"||k==="processing",fail:k==="fail"||k==="failed",user_input_required:k.includes("input")},service:t.service||null,serviceEnv:t.service_env||null,projectEnv:t.project_env||null,integrationType:t.integration_type||"api",cardInfo:t.payment_info?{cardNumber:t.payment_info.card_number||null,panToken:null,paymentMethodId:null,paymentSystemId:null,paymentMethodName:t.payment_method||u,paymentSystemName:null}:null,cardFinishInfo:{mccCode:null,is3DSecureAttempted:!1,result:h},rates:{},hasRates:!1,createdAt:t.operation_created_at||t.date||new Date().toISOString(),modifiedAt:t.operation_modified_at||t.operation_updated_at||t.date||new Date().toISOString(),completeCreatedAt:t.operation_created_at||t.date||new Date().toISOString(),completeModifiedAt:t.operation_modified_at||t.operation_updated_at||t.date||new Date().toISOString(),callbacks:[],hasCallbacks:!1,isCompleted:w,isInProcess:k==="in_process"||k==="processing",isFailed:k==="fail"||k==="failed",requiresUserInput:k.includes("input"),amountFormatted:new Intl.NumberFormat("en-US",{style:"currency",currency:a,minimumFractionDigits:0}).format(i),feeFormatted:new Intl.NumberFormat("en-US",{style:"currency",currency:a,minimumFractionDigits:0}).format(c),dataSource:"enhanced-api"};return r<3&&console.log(`✅ Normalized operation ${r+1}:`,{id:_.id,status:_.status,amount:_.amount,isCompleted:_.isCompleted,isSuccessful:w,rawStatus:h,normalizedStatus:k}),_}),n=s.reduce((t,r)=>(t.total++,r.isDeposit&&t.deposits++,r.isWithdraw&&t.withdrawals++,r.type==="unknown"&&t.unknown++,t),{total:0,deposits:0,withdrawals:0,unknown:0});return console.log("🏁 Enhanced normalization complete:",{totalOperations:s.length,successfulCount:s.filter(t=>t.isCompleted).length,statusBreakdown:s.reduce((t,r)=>(t[r.status]=(t[r.status]||0)+1,t),{}),directionBreakdown:{deposits:n.deposits,withdrawals:n.withdrawals,unknown:n.unknown,detectionRate:((n.deposits+n.withdrawals)/n.total*100).toFixed(1)+"%"}}),s}const ze=R.forwardRef(({className:l,variant:s="default",size:n="md",loading:t=!1,disabled:r=!1,children:i,...a},c)=>{const p="inline-flex items-center justify-center font-medium transition-all duration-200 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-offset-gray-900 disabled:opacity-50 disabled:cursor-not-allowed",f={default:"bg-white/10 text-white hover:bg-white/20 focus:ring-white/50 border border-white/20 hover:border-white/30",primary:"bg-gradient-to-r from-purple-500 to-pink-500 text-white hover:from-purple-600 hover:to-pink-600 focus:ring-purple-500 shadow-lg",success:"bg-gradient-to-r from-green-500 to-emerald-500 text-white hover:from-green-600 hover:to-emerald-600 focus:ring-green-500 shadow-lg",danger:"bg-gradient-to-r from-red-500 to-pink-500 text-white hover:from-red-600 hover:to-pink-600 focus:ring-red-500 shadow-lg",ghost:"text-gray-300 hover:text-white hover:bg-white/10 focus:ring-white/30",outline:"border border-gray-600 text-gray-300 hover:text-white hover:border-gray-500 hover:bg-white/5 focus:ring-gray-500"},j={sm:"px-3 py-1.5 text-sm rounded-lg",md:"px-4 py-2 text-sm rounded-lg",lg:"px-6 py-3 text-base rounded-xl",xl:"px-8 py-4 text-lg rounded-xl"};return e.jsxs("button",{ref:c,className:ce(p,f[s],j[n],(t||r)&&"cursor-not-allowed",l),disabled:t||r,...a,children:[t&&e.jsxs("svg",{className:"w-4 h-4 mr-2 animate-spin",fill:"none",viewBox:"0 0 24 24",children:[e.jsx("circle",{className:"opacity-25",cx:"12",cy:"12",r:"10",stroke:"currentColor",strokeWidth:"4"}),e.jsx("path",{className:"opacity-75",fill:"currentColor",d:"M4 12a8 8 0 018-8V0C5.373 0 0 5.373 0 12h4zm2 5.291A7.962 7.962 0 014 12H0c0 3.042 1.135 5.824 3 7.938l3-2.647z"})]}),i]})});ze.displayName="Button";const ts=({onDataLoad:l,loading:s,setLoading:n,onBack:t=null})=>{const[r,i]=R.useState({project_id:"",status:"success",payment_method_type:"",operation_state:"",reference_id:"",client_operation_id:"",dateMode:"latest",date:"",from:"",to:"",count:100,descending:!0,from_operation_create_id:"",credentials_owner:""}),[a,c]=R.useState(null),[p,f]=R.useState(!1),j=[{value:"",label:"Все проекты"},{value:"preview",label:"Preview"},{value:"monetix",label:"Monetix"},{value:"caroussel",label:"Caroussel"}],S=[{value:"",label:"Все статусы"},{value:"success",label:"Успешно"},{value:"fail",label:"Ошибка"},{value:"in_process",label:"В процессе"},{value:"user_input_required",label:"Требует ввода"}],u=[{value:"",label:"Все типы"}],g=[{value:"latest",label:"Последние операции"},{value:"single",label:"Конкретная дата"},{value:"range",label:"Диапазон дат"}],x=async()=>{n(!0),c(null);try{let h={status:r.status,payment_method_type:r.payment_method_type,operation_state:r.operation_state,descending:r.descending};switch(r.project_id&&(h.project_id=r.project_id),r.reference_id&&(h.reference_id=r.reference_id),r.client_operation_id&&(h.client_operation_id=r.client_operation_id),r.from_operation_create_id&&(h.from_operation_create_id=r.from_operation_create_id),r.credentials_owner&&(h.credentials_owner=r.credentials_owner),r.dateMode){case"latest":h.count=r.count;break;case"single":if(!r.date){c("Выберите дату"),n(!1);return}h.date=r.date;break;case"range":if(!r.from||!r.to){c("Выберите диапазон дат"),n(!1);return}h.from=r.from,h.to=r.to;break}console.log("🎯 Loading enhanced data with filters:",h);const k=await Qt.getOperationsEnhanced(h);console.log("📦 Raw data received from API:",{type:typeof k,isArray:Array.isArray(k),length:Array.isArray(k)?k.length:"not array",firstItem:Array.isArray(k)&&k.length>0?k[0]:null});const w=es(k,"enhanced-operations");console.log("🔄 Normalized data ready:",{length:w.length,successfulCount:w.filter(_=>_.isCompleted).length,sampleItem:w[0]||null}),l(w,"enhanced-api")}catch(h){console.error("Failed to load enhanced API data:",h),c(`Ошибка загрузки данных: ${h.message}`)}finally{n(!1)}},N=[{name:"Все успешные (100 последних)",description:"Фиат + Крипто",action:()=>{i({...r,project_id:"",status:"success",payment_method_type:"",dateMode:"latest",count:100,descending:!0})}},{name:"Последние 50",description:"Недавние операции",action:()=>{i({...r,project_id:"",status:"success",payment_method_type:"",dateMode:"latest",count:50,descending:!0})}},{name:"В процессе обработки",description:"Незавершенные операции",action:()=>{i({...r,project_id:"",status:"in_process",payment_method_type:"",operation_state:"in_process",dateMode:"latest",count:50,descending:!0})}},{name:"Сегодня все проекты",description:"Операции за сегодня",action:()=>{const h=new Date().toISOString().split("T")[0];i({...r,project_id:"",status:"",dateMode:"single",date:h})}}];return e.jsx("div",{className:"min-h-screen bg-gradient-to-br from-slate-900 via-purple-900 to-slate-900 flex items-center justify-center p-4",children:e.jsxs("div",{className:"w-full max-w-6xl space-y-8",children:[e.jsxs("div",{className:"text-center space-y-4",children:[e.jsx("div",{className:"w-20 h-20 bg-gradient-to-br from-purple-500 to-pink-600 rounded-full flex items-center justify-center mx-auto",children:e.jsx(W,{className:"w-10 h-10 text-white"})}),e.jsx("h1",{className:"text-4xl font-bold text-white",children:"Расширенный интерфейс API"}),e.jsx("p",{className:"text-xl text-gray-300 max-w-3xl mx-auto",children:"Удобный интерфейс для работы с API коллектора с расширенными возможностями фильтрации"}),t&&e.jsx("button",{onClick:t,className:"mt-4 px-6 py-2 bg-white/10 text-white rounded-lg hover:bg-white/20 transition-colors duration-200",children:"← Назад к выбору источника"})]}),e.jsx("div",{className:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-4 gap-4",children:N.map((h,k)=>e.jsx($,{className:"cursor-pointer hover:scale-105 transition-transform",onClick:h.action,children:e.jsxs(E,{className:"p-4 text-center",children:[e.jsx("h3",{className:"font-medium text-white mb-1",children:h.name}),e.jsx("p",{className:"text-xs text-gray-400",children:h.description})]})},k))}),e.jsx($,{children:e.jsxs(E,{className:"p-6",children:[e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-4 gap-4 mb-6",children:[e.jsxs("div",{className:"space-y-2",children:[e.jsxs("label",{className:"text-sm font-medium text-white flex items-center",children:[e.jsx(ne,{className:"w-4 h-4 text-green-400 mr-2"}),"Проект"]}),e.jsx("select",{value:r.project_id,onChange:h=>i({...r,project_id:h.target.value}),className:"w-full px-3 py-2 bg-white/10 border border-white/20 rounded-lg text-white focus:outline-none focus:ring-2 focus:ring-purple-500",children:j.map(h=>e.jsx("option",{value:h.value,children:h.label},h.value))})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsxs("label",{className:"text-sm font-medium text-white flex items-center",children:[e.jsx("div",{className:"w-4 h-4 bg-gradient-to-br from-green-500 to-emerald-500 rounded-full mr-2"}),"Статус"]}),e.jsx("select",{value:r.status,onChange:h=>i({...r,status:h.target.value}),className:"w-full px-3 py-2 bg-white/10 border border-white/20 rounded-lg text-white focus:outline-none focus:ring-2 focus:ring-purple-500",children:S.map(h=>e.jsx("option",{value:h.value,children:h.label},h.value))})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsxs("label",{className:"text-sm font-medium text-white flex items-center",children:[e.jsx(Ee,{className:"w-4 h-4 text-yellow-400 mr-2"}),"Тип платежа"]}),e.jsx("select",{value:r.payment_method_type,onChange:h=>i({...r,payment_method_type:h.target.value}),className:"w-full px-3 py-2 bg-white/10 border border-white/20 rounded-lg text-white focus:outline-none focus:ring-2 focus:ring-purple-500",children:u.map(h=>e.jsx("option",{value:h.value,children:h.label},h.value))})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsxs("label",{className:"text-sm font-medium text-white flex items-center",children:[e.jsx(V,{className:"w-4 h-4 text-purple-400 mr-2"}),"Режим выборки"]}),e.jsx("select",{value:r.dateMode,onChange:h=>i({...r,dateMode:h.target.value}),className:"w-full px-3 py-2 bg-white/10 border border-white/20 rounded-lg text-white focus:outline-none focus:ring-2 focus:ring-purple-500",children:g.map(h=>e.jsx("option",{value:h.value,children:h.label},h.value))})]})]}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-3 gap-4 mb-6",children:[r.dateMode==="latest"&&e.jsxs("div",{className:"space-y-2",children:[e.jsx("label",{className:"text-sm font-medium text-white",children:"Количество записей"}),e.jsx("input",{type:"number",min:"1",max:"1000",value:r.count,onChange:h=>i({...r,count:parseInt(h.target.value)||100}),className:"w-full px-3 py-2 bg-white/10 border border-white/20 rounded-lg text-white focus:outline-none focus:ring-2 focus:ring-purple-500"})]}),r.dateMode==="single"&&e.jsxs("div",{className:"space-y-2",children:[e.jsx("label",{className:"text-sm font-medium text-white",children:"Дата"}),e.jsx("input",{type:"date",value:r.date,onChange:h=>i({...r,date:h.target.value}),className:"w-full px-3 py-2 bg-white/10 border border-white/20 rounded-lg text-white focus:outline-none focus:ring-2 focus:ring-purple-500"})]}),r.dateMode==="range"&&e.jsxs(e.Fragment,{children:[e.jsxs("div",{className:"space-y-2",children:[e.jsx("label",{className:"text-sm font-medium text-white",children:"От"}),e.jsx("input",{type:"date",value:r.from,onChange:h=>i({...r,from:h.target.value}),className:"w-full px-3 py-2 bg-white/10 border border-white/20 rounded-lg text-white focus:outline-none focus:ring-2 focus:ring-purple-500"})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx("label",{className:"text-sm font-medium text-white",children:"До"}),e.jsx("input",{type:"date",value:r.to,onChange:h=>i({...r,to:h.target.value}),className:"w-full px-3 py-2 bg-white/10 border border-white/20 rounded-lg text-white focus:outline-none focus:ring-2 focus:ring-purple-500"})]})]})]}),e.jsxs("div",{className:"border-t border-white/10 pt-4",children:[e.jsxs("button",{onClick:()=>f(!p),className:"flex items-center gap-2 text-sm text-gray-400 hover:text-white transition-colors mb-4",children:[e.jsx(z,{className:"w-4 h-4"}),"Расширенные фильтры",e.jsx(K,{className:`w-4 h-4 transition-transform ${p?"rotate-180":""}`})]}),p&&e.jsx("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:e.jsxs("div",{className:"space-y-2",children:[e.jsx("label",{className:"text-sm font-medium text-white",children:"Дополнительные параметры"}),e.jsx("p",{className:"text-sm text-gray-400",children:"Расширенные параметры фильтрации будут добавлены в следующих обновлениях"})]})})]}),e.jsx("div",{className:"flex justify-center mt-6",children:e.jsxs(ze,{onClick:x,loading:s,size:"lg",variant:"primary",className:"px-8",children:[e.jsx(Oe,{className:"w-5 h-5 mr-2"}),"Загрузить данные"]})}),a&&e.jsx("div",{className:"mt-4 p-4 bg-red-500/20 border border-red-500/30 rounded-xl text-red-300",children:a})]})}),e.jsx($,{variant:"primary",children:e.jsxs(E,{className:"p-6",children:[e.jsxs(Z,{className:"mb-4 flex items-center gap-2",children:[e.jsx(G,{className:"w-5 h-5 text-purple-400"}),"Возможности интерфейса"]}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-6 text-sm text-gray-300",children:[e.jsxs("div",{children:[e.jsx("h4",{className:"font-medium text-white mb-2",children:"📊 Улучшенная аналитика"}),e.jsxs("ul",{className:"space-y-1 text-xs",children:[e.jsx("li",{children:"• Горизонтальные графики объемов"}),e.jsx("li",{children:"• Анализ конверсии по времени"}),e.jsx("li",{children:"• Детальная таблица с поиском"}),e.jsx("li",{children:"• Расширенная статистика"})]})]}),e.jsxs("div",{children:[e.jsx("h4",{className:"font-medium text-white mb-2",children:"🔍 Удобная фильтрация"}),e.jsxs("ul",{className:"space-y-1 text-xs",children:[e.jsx("li",{children:"• Быстрые предустановки"}),e.jsx("li",{children:"• Фильтр по проектам и статусам"}),e.jsx("li",{children:"• Гибкие диапазоны дат"}),e.jsx("li",{children:"• Сортировка и пагинация"})]})]})]})]})})]})})},ss=({data:l})=>{const[s,n]=R.useState({key:null,direction:"asc"}),[t,r]=R.useState(""),[i,a]=R.useState(1),[c]=R.useState(15),[p,f]=R.useState("overview"),[j,S]=R.useState(new Set);R.useEffect(()=>{a(1)},[t,l]);const u=(m,I="EUR")=>new Intl.NumberFormat("en-US",{style:"currency",currency:I,minimumFractionDigits:0,maximumFractionDigits:2}).format(m),g=m=>{if(!m)return"-";try{return new Date(m).toLocaleString("ru-RU",{year:"numeric",month:"2-digit",day:"2-digit",hour:"2-digit",minute:"2-digit"})}catch{return m}},x=m=>{switch(m?m.toLowerCase():""){case"success":return"bg-green-500/20 text-green-300 border-green-500/30";case"fail":return"bg-red-500/20 text-red-300 border-red-500/30";case"in_process":return"bg-yellow-500/20 text-yellow-300 border-yellow-500/30";case"user_input_required":return"bg-blue-500/20 text-blue-300 border-blue-500/30";default:return"bg-gray-500/20 text-gray-300 border-gray-500/30"}},N=m=>{switch(m?m.toLowerCase():""){case"success":return"Успешно";case"fail":return"Ошибка";case"in_process":return"В процессе";case"user_input_required":return"Требует ввода";default:return m||"Неизвестно"}},h=(m,I)=>I?Ee:Y,k=m=>m?"text-yellow-400":"text-blue-400",w=l.filter(m=>{const I=t.toLowerCase();return m.id&&m.id.toString().toLowerCase().includes(I)||m.referenceId&&m.referenceId.toLowerCase().includes(I)||m.clientOperationId&&m.clientOperationId.toLowerCase().includes(I)||m.status&&m.status.toLowerCase().includes(I)||m.project&&m.project.toLowerCase().includes(I)||m.userId&&m.userId.toString().toLowerCase().includes(I)||m.paymentMethodCode&&m.paymentMethodCode.toLowerCase().includes(I)||m.amount&&m.amount.toString().includes(I)}),_=[...w].sort((m,I)=>{if(!s.key)return 0;const M=m[s.key]||"",D=I[s.key]||"";if(s.key==="amount"||s.key==="fee")return s.direction==="asc"?parseFloat(M)-parseFloat(D):parseFloat(D)-parseFloat(M);if(s.key==="createdAt"||s.key==="modifiedAt"){const P=new Date(M),B=new Date(D);return s.direction==="asc"?P-B:B-P}const L=M.toString().localeCompare(D.toString());return s.direction==="asc"?L:-L}),o=Math.ceil(_.length/c),y=(i-1)*c,b=_.slice(y,y+c),v=m=>{n(I=>({key:m,direction:I.key===m&&I.direction==="asc"?"desc":"asc"}))},d=m=>{const I=new Set(j);I.has(m)?I.delete(m):I.add(m),S(I)},C=({columnKey:m})=>s.key!==m?e.jsx(K,{className:"w-4 h-4 text-gray-400"}):s.direction==="asc"?e.jsx(ve,{className:"w-4 h-4 text-blue-400"}):e.jsx(K,{className:"w-4 h-4 text-blue-400"}),A=[{id:"overview",label:"Обзор",icon:le},{id:"detailed",label:"Детали",icon:z},{id:"cards",label:"Карты",icon:Y},{id:"rates",label:"Курсы",icon:W}];return e.jsxs("div",{className:"space-y-6",children:[e.jsxs("div",{className:"flex flex-col lg:flex-row lg:items-center lg:justify-between gap-4",children:[e.jsxs("div",{children:[e.jsx("h2",{className:"text-2xl font-bold text-white",children:"Расширенные данные API"}),e.jsxs("p",{className:"text-gray-300",children:[w.length," операций из ",l.length," • Поддержка криптовалют и детальной информации"]})]}),e.jsx("div",{className:"flex items-center gap-2 bg-white/5 rounded-xl p-1 border border-white/10",children:A.map(({id:m,label:I,icon:M})=>e.jsxs("button",{onClick:()=>f(m),className:`flex items-center gap-2 px-4 py-2 rounded-lg transition-all duration-200 ${p===m?"bg-purple-500 text-white shadow-lg":"text-gray-400 hover:text-white hover:bg-white/10"}`,children:[e.jsx(M,{className:"w-4 h-4"}),e.jsx("span",{className:"text-sm font-medium",children:I})]},m))})]}),e.jsxs("div",{className:"flex flex-col sm:flex-row gap-4",children:[e.jsxs("div",{className:"relative flex-1",children:[e.jsx(Ce,{className:"absolute left-3 top-1/2 transform -translate-y-1/2 w-4 h-4 text-gray-400"}),e.jsx("input",{type:"text",placeholder:"Поиск по ID, статусу, проекту, пользователю...",value:t,onChange:m=>r(m.target.value),className:"w-full pl-10 pr-4 py-2 bg-white/10 border border-white/20 rounded-lg text-white placeholder-gray-400 focus:outline-none focus:ring-2 focus:ring-blue-500 focus:border-transparent"})]}),e.jsxs("div",{className:"flex items-center gap-4",children:[e.jsxs("div",{className:"flex items-center space-x-2",children:[e.jsx(z,{className:"w-4 h-4 text-gray-400"}),e.jsxs("span",{className:"text-sm text-gray-400",children:[w.length," результатов"]})]}),e.jsxs("button",{className:"px-4 py-2 bg-gradient-to-r from-green-500 to-emerald-600 text-white rounded-lg hover:from-green-600 hover:to-emerald-700 transition-all duration-200 flex items-center space-x-2",children:[e.jsx(de,{className:"w-4 h-4"}),e.jsx("span",{children:"Экспорт"})]})]})]}),e.jsx("div",{className:"grid grid-cols-1 md:grid-cols-4 gap-4",children:[{label:"Всего операций",value:l.length,color:"text-blue-400",icon:W},{label:"Успешные",value:l.filter(m=>m.isCompleted).length,color:"text-green-400",icon:J},{label:"Сумма успешных",value:u(l.filter(m=>m.isCompleted).reduce((m,I)=>m+parseFloat(I.amount||0),0),"EUR"),color:"text-green-400",icon:O,isAmount:!0},{label:"В процессе/Ошибка",value:l.filter(m=>!m.isCompleted).length,color:"text-yellow-400",icon:fe}].map((m,I)=>{const M=m.icon;return e.jsx($,{children:e.jsx(E,{className:"p-4",children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsx("p",{className:"text-sm text-gray-400",children:m.label}),e.jsx("p",{className:`text-2xl font-bold ${m.isAmount?m.color:"text-white"}`,children:m.value})]}),e.jsx(M,{className:`w-8 h-8 ${m.color}`})]})})},I)})}),e.jsxs($,{children:[e.jsx("div",{className:"overflow-x-auto",children:e.jsxs("table",{className:"w-full",children:[e.jsx("thead",{className:"bg-white/10",children:e.jsxs("tr",{children:[e.jsx("th",{className:"px-4 py-4 text-left text-sm font-semibold text-white",children:e.jsx("div",{className:"flex items-center space-x-2",children:e.jsx("span",{children:"Детали"})})}),e.jsx("th",{className:"px-4 py-4 text-left text-sm font-semibold text-white cursor-pointer hover:bg-white/10",onClick:()=>v("status"),children:e.jsxs("div",{className:"flex items-center space-x-2",children:[e.jsx("span",{children:"Статус"}),e.jsx(C,{columnKey:"status"})]})}),e.jsx("th",{className:"px-4 py-4 text-left text-sm font-semibold text-white",children:"Тип платежа"}),e.jsx("th",{className:"px-4 py-4 text-left text-sm font-semibold text-white cursor-pointer hover:bg-white/10",onClick:()=>v("amount"),children:e.jsxs("div",{className:"flex items-center space-x-2",children:[e.jsx("span",{children:"Сумма"}),e.jsx(C,{columnKey:"amount"})]})}),e.jsx("th",{className:"px-4 py-4 text-left text-sm font-semibold text-white",children:"Пользователь"}),e.jsx("th",{className:"px-4 py-4 text-left text-sm font-semibold text-white cursor-pointer hover:bg-white/10",onClick:()=>v("project"),children:e.jsxs("div",{className:"flex items-center space-x-2",children:[e.jsx("span",{children:"Проект"}),e.jsx(C,{columnKey:"project"})]})}),e.jsx("th",{className:"px-4 py-4 text-left text-sm font-semibold text-white cursor-pointer hover:bg-white/10",onClick:()=>v("createdAt"),children:e.jsxs("div",{className:"flex items-center space-x-2",children:[e.jsx("span",{children:"Создано"}),e.jsx(C,{columnKey:"createdAt"})]})}),p==="detailed"&&e.jsx("th",{className:"px-4 py-4 text-left text-sm font-semibold text-white",children:"Дополнительно"})]})}),e.jsx("tbody",{className:"divide-y divide-white/10",children:b.map((m,I)=>{const M=j.has(m.id),D=h(m.paymentMethodType,m.isCrypto);return e.jsxs(De.Fragment,{children:[e.jsxs("tr",{className:"hover:bg-white/5 transition-colors duration-200",children:[e.jsx("td",{className:"px-4 py-4",children:e.jsxs("button",{onClick:()=>d(m.id),className:"flex items-center gap-2 text-sm text-gray-400 hover:text-white",children:[M?e.jsx(St,{className:"w-4 h-4"}):e.jsx(le,{className:"w-4 h-4"}),e.jsx("span",{className:"font-mono text-xs",children:m.referenceId?m.referenceId.slice(-8):m.id.slice(-8)})]})}),e.jsxs("td",{className:"px-4 py-4",children:[e.jsx("span",{className:`inline-flex items-center px-2 py-1 rounded-full text-xs font-medium border ${x(m.status)}`,children:N(m.status)}),m.operationState&&m.operationState!==m.status&&e.jsx("div",{className:"text-xs text-gray-400 mt-1",children:m.operationState})]}),e.jsx("td",{className:"px-4 py-4",children:e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(D,{className:`w-4 h-4 ${k(m.isCrypto)}`}),e.jsxs("div",{children:[e.jsx("div",{className:"text-sm font-medium text-white",children:"Платеж"}),e.jsx("div",{className:"text-xs text-gray-400",children:m.paymentMethodCode||"API"})]})]})}),e.jsxs("td",{className:"px-4 py-4",children:[e.jsx("div",{className:"text-sm font-semibold text-white",children:u(m.amount,m.currency)}),m.fee>0&&e.jsxs("div",{className:"text-xs text-gray-400",children:["Комиссия: ",u(m.fee,m.currency)]})]}),e.jsx("td",{className:"px-4 py-4",children:e.jsxs("div",{className:"flex items-center space-x-2",children:[e.jsx(Ue,{className:"w-4 h-4 text-gray-400"}),e.jsxs("div",{children:[e.jsxs("div",{className:"text-sm font-medium text-white",children:["ID: ",m.userId]}),m.ipAddress&&e.jsxs("div",{className:"text-xs text-gray-400",children:["IP: ",m.ipAddress]})]})]})}),e.jsxs("td",{className:"px-4 py-4",children:[e.jsx("div",{className:"text-sm font-medium text-white",children:m.project}),e.jsx("div",{className:"text-xs text-gray-400",children:m.credentialsOwner})]}),e.jsxs("td",{className:"px-4 py-4",children:[e.jsx("div",{className:"text-sm text-gray-300",children:g(m.createdAt)}),m.modifiedAt&&m.modifiedAt!==m.createdAt&&e.jsxs("div",{className:"text-xs text-gray-500 mt-1",children:["Изменено: ",g(m.modifiedAt)]})]}),p==="detailed"&&e.jsx("td",{className:"px-4 py-4",children:e.jsxs("div",{className:"flex flex-col gap-1 text-xs",children:[m.cardInfo&&e.jsxs("div",{className:"flex items-center gap-1",children:[e.jsx(Y,{className:"w-3 h-3 text-gray-400"}),e.jsx("span",{className:"text-gray-400",children:"Карта"})]}),m.cardFinishInfo&&m.cardFinishInfo.is3DSecureAttempted&&e.jsxs("div",{className:"flex items-center gap-1",children:[e.jsx(J,{className:"w-3 h-3 text-green-400"}),e.jsx("span",{className:"text-green-400",children:"3D Secure"})]}),m.hasCallbacks&&e.jsxs("div",{className:"flex items-center gap-1",children:[e.jsx(fe,{className:"w-3 h-3 text-blue-400"}),e.jsx("span",{className:"text-blue-400",children:"Callbacks"})]})]})})]}),M&&e.jsx("tr",{children:e.jsx("td",{colSpan:p==="detailed"?8:7,className:"px-4 py-6 bg-white/5",children:e.jsxs("div",{className:"grid grid-cols-1 lg:grid-cols-2 xl:grid-cols-3 gap-6",children:[e.jsx($,{variant:"glass",children:e.jsxs(E,{className:"p-4",children:[e.jsx("h4",{className:"font-medium text-white mb-3",children:"Основная информация"}),e.jsxs("div",{className:"space-y-2 text-sm",children:[e.jsxs("div",{className:"flex justify-between",children:[e.jsx("span",{className:"text-gray-400",children:"Reference ID:"}),e.jsx("span",{className:"text-white font-mono text-xs",children:m.referenceId})]}),e.jsxs("div",{className:"flex justify-between",children:[e.jsx("span",{className:"text-gray-400",children:"Client Operation ID:"}),e.jsx("span",{className:"text-white font-mono text-xs",children:m.clientOperationId})]}),e.jsxs("div",{className:"flex justify-between",children:[e.jsx("span",{className:"text-gray-400",children:"Продукт:"}),e.jsx("span",{className:"text-white",children:m.paymentProduct})]}),e.jsxs("div",{className:"flex justify-between",children:[e.jsx("span",{className:"text-gray-400",children:"Интеграция:"}),e.jsx("span",{className:"text-white",children:m.integrationType})]})]})]})}),m.cardInfo&&e.jsx($,{variant:"glass",children:e.jsxs(E,{className:"p-4",children:[e.jsxs("h4",{className:"font-medium text-white mb-3 flex items-center gap-2",children:[e.jsx(Y,{className:"w-4 h-4"}),"Информация о карте"]}),e.jsxs("div",{className:"space-y-2 text-sm",children:[e.jsxs("div",{className:"flex justify-between",children:[e.jsx("span",{className:"text-gray-400",children:"Номер карты:"}),e.jsx("span",{className:"text-white font-mono",children:m.cardInfo.cardNumber})]}),e.jsxs("div",{className:"flex justify-between",children:[e.jsx("span",{className:"text-gray-400",children:"PAN Token:"}),e.jsx("span",{className:"text-white font-mono text-xs",children:m.cardInfo.panToken})]}),m.cardInfo.paymentMethodName&&e.jsxs("div",{className:"flex justify-between",children:[e.jsx("span",{className:"text-gray-400",children:"Метод:"}),e.jsx("span",{className:"text-white",children:m.cardInfo.paymentMethodName})]}),m.cardFinishInfo&&m.cardFinishInfo.mccCode&&e.jsxs("div",{className:"flex justify-between",children:[e.jsx("span",{className:"text-gray-400",children:"MCC Code:"}),e.jsx("span",{className:"text-white",children:m.cardFinishInfo.mccCode})]})]})]})}),e.jsx($,{variant:"glass",children:e.jsxs(E,{className:"p-4",children:[e.jsxs("h4",{className:"font-medium text-white mb-3 flex items-center gap-2",children:[e.jsx(W,{className:"w-4 h-4"}),"Системная информация"]}),e.jsxs("div",{className:"space-y-2 text-sm",children:[e.jsxs("div",{className:"flex justify-between",children:[e.jsx("span",{className:"text-gray-400",children:"Источник данных:"}),e.jsx("span",{className:"text-white",children:m.dataSource})]}),e.jsxs("div",{className:"flex justify-between",children:[e.jsx("span",{className:"text-gray-400",children:"Тип интеграции:"}),e.jsx("span",{className:"text-white",children:m.integrationType})]})]})]})})]})})})]},m.id||I)})})]})}),o>1&&e.jsxs("div",{className:"bg-white/5 px-6 py-4 flex items-center justify-between border-t border-white/10",children:[e.jsxs("div",{className:"text-sm text-gray-400",children:["Страница ",i," из ",o," • Показано ",b.length," из ",w.length]}),e.jsxs("div",{className:"flex items-center space-x-2",children:[e.jsx("button",{onClick:()=>a(Math.max(1,i-1)),disabled:i===1,className:"px-3 py-1 bg-white/10 text-white rounded-lg hover:bg-white/20 disabled:opacity-50 disabled:cursor-not-allowed transition-colors duration-200",children:"Предыдущая"}),e.jsx("button",{onClick:()=>a(Math.min(o,i+1)),disabled:i===o,className:"px-3 py-1 bg-white/10 text-white rounded-lg hover:bg-white/20 disabled:opacity-50 disabled:cursor-not-allowed transition-colors duration-200",children:"Следующая"})]})]})]})]})},Fe=({onFilesUploaded:l})=>{const[s,n]=R.useState(null),[t,r]=R.useState(null),[i,a]=R.useState(!1),c=(f,j)=>{j==="merchant"?n(f):j==="platform"&&r(f)},p=async()=>{if(!s||!t){alert("Загрузите оба файла для сверки");return}a(!0),console.log("🔄 Starting reconciliation process...");try{if(!await Zt())throw new Error("Сервер сверки недоступен. Проверьте подключение к интернету и попробуйте снова.");const j=await Ht(s,t);console.log("✅ Reconciliation completed:",j),l({results:j,metadata:j.metadata,merchantFileName:s.name,platformFileName:t.name})}catch(f){console.error("❌ Error during reconciliation:",f),alert("Ошибка при сверке файлов: "+f.message)}finally{a(!1)}};return e.jsxs("div",{className:"max-w-4xl mx-auto p-6 bg-white rounded-lg shadow-lg",children:[e.jsxs("div",{className:"text-center mb-8",children:[e.jsx("h2",{className:"text-3xl font-bold text-gray-900 mb-2",children:"🔄 Сверка транзакций"}),e.jsx("p",{className:"text-gray-600",children:"Загрузите файлы от провайдера и платформы для автоматической сверки"})]}),e.jsxs("div",{className:"grid md:grid-cols-2 gap-6 mb-8",children:[e.jsx("div",{className:"border-2 border-dashed border-gray-300 rounded-lg p-6 hover:border-blue-400 transition-colors",children:e.jsxs("div",{className:"text-center",children:[e.jsx(H,{className:"h-12 w-12 text-gray-400 mx-auto mb-4"}),e.jsx("h3",{className:"text-lg font-semibold text-gray-900 mb-2",children:"📊 Файл провайдера"}),e.jsx("p",{className:"text-sm text-gray-600 mb-4",children:"CSV файл с данными от провайдера (Tracking ID, Status, Amount...)"}),e.jsx("input",{type:"file",accept:".csv,.xlsx,.xls",onChange:f=>c(f.target.files[0],"merchant"),className:"hidden",id:"merchant-upload"}),e.jsxs("label",{htmlFor:"merchant-upload",className:"inline-flex items-center px-4 py-2 bg-blue-600 text-white rounded-lg hover:bg-blue-700 cursor-pointer transition-colors",children:[e.jsx(ie,{className:"h-4 w-4 mr-2"}),"Выбрать файл"]}),s&&e.jsxs("div",{className:"mt-3 flex items-center justify-center text-green-600",children:[e.jsx(pe,{className:"h-4 w-4 mr-1"}),e.jsx("span",{className:"text-sm",children:s.name})]})]})}),e.jsx("div",{className:"border-2 border-dashed border-gray-300 rounded-lg p-6 hover:border-green-400 transition-colors",children:e.jsxs("div",{className:"text-center",children:[e.jsx(H,{className:"h-12 w-12 text-gray-400 mx-auto mb-4"}),e.jsx("h3",{className:"text-lg font-semibold text-gray-900 mb-2",children:"🏦 Файл платформы"}),e.jsx("p",{className:"text-sm text-gray-600 mb-4",children:"CSV файл с данными платформы (Foreign Operation ID, Status...)"}),e.jsx("input",{type:"file",accept:".csv,.xlsx,.xls",onChange:f=>c(f.target.files[0],"platform"),className:"hidden",id:"platform-upload"}),e.jsxs("label",{htmlFor:"platform-upload",className:"inline-flex items-center px-4 py-2 bg-green-600 text-white rounded-lg hover:bg-green-700 cursor-pointer transition-colors",children:[e.jsx(ie,{className:"h-4 w-4 mr-2"}),"Выбрать файл"]}),t&&e.jsxs("div",{className:"mt-3 flex items-center justify-center text-green-600",children:[e.jsx(pe,{className:"h-4 w-4 mr-1"}),e.jsx("span",{className:"text-sm",children:t.name})]})]})})]}),e.jsxs("div",{className:"bg-gray-50 rounded-lg p-4 mb-6",children:[e.jsx("h4",{className:"font-semibold text-gray-900 mb-3",children:"🔗 Сопоставление полей:"}),e.jsxs("div",{className:"grid md:grid-cols-2 gap-4 text-sm",children:[e.jsxs("div",{children:[e.jsx("p",{children:e.jsx("strong",{children:"ID транзакции:"})}),e.jsx("p",{className:"text-gray-600",children:"Foreign Operation Id (платформа) ↔ Tracking Id (провайдер)"})]}),e.jsxs("div",{children:[e.jsx("p",{children:e.jsx("strong",{children:"Статус:"})}),e.jsx("p",{className:"text-gray-600",children:"success (платформа) ↔ completed (провайдер)"})]})]})]}),e.jsx("div",{className:"text-center",children:e.jsx("button",{onClick:p,disabled:!s||!t||i,className:"inline-flex items-center px-8 py-3 bg-purple-600 text-white rounded-lg hover:bg-purple-700 disabled:bg-gray-400 disabled:cursor-not-allowed transition-colors",children:i?e.jsxs(e.Fragment,{children:[e.jsx("div",{className:"animate-spin rounded-full h-4 w-4 border-b-2 border-white mr-2"}),"Обработка..."]}):e.jsxs(e.Fragment,{children:[e.jsx(je,{className:"h-4 w-4 mr-2"}),"Запустить сверку"]})})})]})},as=({reconciliationData:l,onBack:s})=>{const[n,t]=R.useState("all"),[r,i]=R.useState("id"),[a,c]=R.useState("asc"),p=R.useMemo(()=>{if(!l||!Array.isArray(l))return[];let u=[...l];switch(n){case"matched":u=u.filter(g=>!g.hasIssue);break;case"issues":u=u.filter(g=>g.hasIssue);break;case"status_mismatch":u=u.filter(g=>{var x;return(x=g.issueType)==null?void 0:x.includes("status")});break;case"amount_mismatch":u=u.filter(g=>{var x;return(x=g.issueType)==null?void 0:x.includes("amount")});break;case"missing":u=u.filter(g=>{var x;return(x=g.issueType)==null?void 0:x.includes("missing")});break}return u.sort((g,x)=>{let N=g[r]||"",h=x[r]||"";return typeof N=="number"&&typeof h=="number"?a==="asc"?N-h:h-N:(N=String(N).toLowerCase(),h=String(h).toLowerCase(),a==="asc"?N<h?-1:N>h?1:0:N>h?-1:N<h?1:0)}),u},[l,n,r,a]),f=R.useMemo(()=>{if(!l||!Array.isArray(l))return{total:0,matched:0,issues:0,statusMismatch:0,amountMismatch:0,missing:0,matchRate:"0"};const u=l.length,g=l.filter(w=>!w.hasIssue).length,x=l.filter(w=>w.hasIssue).length,N=l.filter(w=>{var _;return(_=w.issueType)==null?void 0:_.includes("status")}).length,h=l.filter(w=>{var _;return(_=w.issueType)==null?void 0:_.includes("amount")}).length,k=l.filter(w=>{var _;return(_=w.issueType)==null?void 0:_.includes("missing")}).length;return{total:u,matched:g,issues:x,statusMismatch:N,amountMismatch:h,missing:k,matchRate:u>0?(g/u*100).toFixed(1):"0"}},[l]),j=u=>{if(!u.hasIssue)return"bg-green-50 hover:bg-green-100";switch(u.issueType){case"status":return"bg-yellow-50 hover:bg-yellow-100 border-l-4 border-yellow-400";case"amount":return"bg-orange-50 hover:bg-orange-100 border-l-4 border-orange-400";case"status, amount":return"bg-red-50 hover:bg-red-100 border-l-4 border-red-400";case"missing_platform":return"bg-blue-50 hover:bg-blue-100 border-l-4 border-blue-400";case"missing_merchant":return"bg-purple-50 hover:bg-purple-100 border-l-4 border-purple-400";default:return"bg-gray-50 hover:bg-gray-100"}},S=u=>{if(!u.hasIssue)return e.jsx(pe,{className:"h-5 w-5 text-green-600"});switch(u.issueType){case"status":case"amount":return e.jsx(X,{className:"h-5 w-5 text-yellow-600"});case"status, amount":return e.jsx(Ve,{className:"h-5 w-5 text-red-600"});case"missing_platform":case"missing_merchant":return e.jsx(H,{className:"h-5 w-5 text-blue-600"});default:return e.jsx(X,{className:"h-5 w-5 text-gray-600"})}};return e.jsxs("div",{className:"max-w-7xl mx-auto p-6",children:[e.jsxs("div",{className:"flex justify-between items-center mb-6",children:[e.jsxs("div",{children:[e.jsx("h2",{className:"text-3xl font-bold text-gray-900",children:"🔄 Результаты сверки"}),e.jsx("p",{className:"text-gray-600 mt-1",children:"Сравнение данных провайдера и платформы"})]}),e.jsx("button",{onClick:s,className:"px-4 py-2 bg-gray-600 text-white rounded-lg hover:bg-gray-700 transition-colors",children:"← Назад"})]}),e.jsxs("div",{className:"grid grid-cols-2 md:grid-cols-6 gap-4 mb-6",children:[e.jsxs("div",{className:"bg-white p-4 rounded-lg shadow border",children:[e.jsx("div",{className:"text-2xl font-bold text-gray-900",children:f.total}),e.jsx("div",{className:"text-sm text-gray-600",children:"Всего записей"})]}),e.jsxs("div",{className:"bg-green-50 p-4 rounded-lg shadow border border-green-200",children:[e.jsx("div",{className:"text-2xl font-bold text-green-700",children:f.matched}),e.jsx("div",{className:"text-sm text-green-600",children:"Совпадений"})]}),e.jsxs("div",{className:"bg-red-50 p-4 rounded-lg shadow border border-red-200",children:[e.jsx("div",{className:"text-2xl font-bold text-red-700",children:f.issues}),e.jsx("div",{className:"text-sm text-red-600",children:"Расхождений"})]}),e.jsxs("div",{className:"bg-yellow-50 p-4 rounded-lg shadow border border-yellow-200",children:[e.jsx("div",{className:"text-2xl font-bold text-yellow-700",children:f.statusMismatch}),e.jsx("div",{className:"text-sm text-yellow-600",children:"По статусу"})]}),e.jsxs("div",{className:"bg-orange-50 p-4 rounded-lg shadow border border-orange-200",children:[e.jsx("div",{className:"text-2xl font-bold text-orange-700",children:f.amountMismatch}),e.jsx("div",{className:"text-sm text-orange-600",children:"По сумме"})]}),e.jsxs("div",{className:"bg-blue-50 p-4 rounded-lg shadow border border-blue-200",children:[e.jsx("div",{className:"text-2xl font-bold text-blue-700",children:f.missing}),e.jsx("div",{className:"text-sm text-blue-600",children:"Отсутствуют"})]})]}),e.jsxs("div",{className:"bg-white p-4 rounded-lg shadow mb-6",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{className:"flex items-center",children:[e.jsx(U,{className:"h-6 w-6 text-blue-600 mr-2"}),e.jsx("span",{className:"text-lg font-semibold",children:"Процент совпадений:"})]}),e.jsxs("div",{className:"text-2xl font-bold text-blue-600",children:[f.matchRate,"%"]})]}),e.jsx("div",{className:"w-full bg-gray-200 rounded-full h-2 mt-2",children:e.jsx("div",{className:"bg-blue-600 h-2 rounded-full transition-all duration-300",style:{width:`${f.matchRate}%`}})})]}),e.jsx("div",{className:"bg-white p-4 rounded-lg shadow mb-6",children:e.jsxs("div",{className:"flex flex-wrap gap-4 items-center",children:[e.jsxs("div",{className:"flex items-center",children:[e.jsx(z,{className:"h-4 w-4 mr-2 text-gray-600"}),e.jsx("span",{className:"text-sm font-medium text-gray-700 mr-2",children:"Фильтр:"}),e.jsxs("select",{value:n,onChange:u=>t(u.target.value),className:"border border-gray-300 rounded px-3 py-1 text-sm",children:[e.jsxs("option",{value:"all",children:["Все записи (",f.total,")"]}),e.jsxs("option",{value:"matched",children:["Совпадения (",f.matched,")"]}),e.jsxs("option",{value:"issues",children:["Расхождения (",f.issues,")"]}),e.jsxs("option",{value:"status_mismatch",children:["Расхождение статусов (",f.statusMismatch,")"]}),e.jsxs("option",{value:"amount_mismatch",children:["Расхождение сумм (",f.amountMismatch,")"]}),e.jsxs("option",{value:"missing",children:["Отсутствующие (",f.missing,")"]})]})]}),e.jsxs("div",{className:"flex items-center",children:[e.jsx("span",{className:"text-sm font-medium text-gray-700 mr-2",children:"Сортировка:"}),e.jsxs("select",{value:r,onChange:u=>i(u.target.value),className:"border border-gray-300 rounded px-3 py-1 text-sm mr-2",children:[e.jsx("option",{value:"id",children:"ID"}),e.jsx("option",{value:"merchantStatus",children:"Статус провайдера"}),e.jsx("option",{value:"platformStatus",children:"Статус платформы"}),e.jsx("option",{value:"merchantAmount",children:"Сумма провайдера"}),e.jsx("option",{value:"platformAmount",children:"Сумма платформы"})]}),e.jsx("button",{onClick:()=>c(a==="asc"?"desc":"asc"),className:"px-2 py-1 bg-gray-100 text-gray-700 rounded text-sm hover:bg-gray-200",children:a==="asc"?"↑":"↓"})]}),e.jsx("div",{className:"ml-auto",children:e.jsxs("span",{className:"text-sm text-gray-600",children:["Показано: ",p.length," из ",f.total]})})]})}),e.jsx("div",{className:"bg-white rounded-lg shadow overflow-hidden",children:e.jsx("div",{className:"overflow-x-auto",children:e.jsxs("table",{className:"min-w-full",children:[e.jsx("thead",{className:"bg-gray-50",children:e.jsxs("tr",{children:[e.jsx("th",{className:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider",children:"Статус"}),e.jsx("th",{className:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider",children:"ID Транзакции"}),e.jsx("th",{className:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider",children:"Провайдер"}),e.jsx("th",{className:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider",children:"Платформа"}),e.jsx("th",{className:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider",children:"Расхождение"})]})}),e.jsx("tbody",{className:"divide-y divide-gray-200",children:p.map((u,g)=>{var x,N,h,k,w,_,o;return e.jsxs("tr",{className:j(u),children:[e.jsx("td",{className:"px-6 py-4 whitespace-nowrap",children:e.jsx("div",{className:"flex items-center",children:S(u)})}),e.jsxs("td",{className:"px-6 py-4 whitespace-nowrap",children:[e.jsx("div",{className:"text-sm font-medium text-gray-900",children:u.merchantId||u.platformId||"N/A"}),e.jsx("div",{className:"text-xs text-gray-500",children:u.matchType})]}),e.jsx("td",{className:"px-6 py-4 whitespace-nowrap",children:u.merchantData?e.jsxs("div",{children:[e.jsxs("div",{className:"text-sm text-gray-900",children:[e.jsx("span",{className:"font-medium",children:"Статус:"})," ",u.merchantStatus]}),e.jsxs("div",{className:"text-sm text-gray-600",children:[e.jsx("span",{className:"font-medium",children:"Сумма:"})," ",(x=u.merchantAmount)==null?void 0:x.toFixed(2)," TRY"]})]}):e.jsx("div",{className:"text-sm text-gray-400 italic",children:"Отсутствует у провайдера"})}),e.jsx("td",{className:"px-6 py-4 whitespace-nowrap",children:u.platformData?e.jsxs("div",{children:[e.jsxs("div",{className:"text-sm text-gray-900",children:[e.jsx("span",{className:"font-medium",children:"Статус:"})," ",u.platformStatus]}),e.jsxs("div",{className:"text-sm text-gray-600",children:[e.jsx("span",{className:"font-medium",children:"Сумма:"})," ",(N=u.platformAmount)==null?void 0:N.toFixed(2)," TRY"]})]}):e.jsx("div",{className:"text-sm text-gray-400 italic",children:"Отсутствует на платформе"})}),e.jsx("td",{className:"px-6 py-4 whitespace-nowrap",children:u.hasIssue?e.jsxs("div",{className:"text-sm",children:[((h=u.issueType)==null?void 0:h.includes("status"))&&e.jsxs("div",{className:"text-yellow-700 mb-1",children:["📊 Статус: ",u.merchantStatus," ≠ ",u.platformStatus]}),((k=u.issueType)==null?void 0:k.includes("amount"))&&e.jsxs("div",{className:"text-orange-700 mb-1",children:["💰 Сумма: ",(w=u.merchantAmount)==null?void 0:w.toFixed(2)," ≠ ",(_=u.platformAmount)==null?void 0:_.toFixed(2)]}),((o=u.issueType)==null?void 0:o.includes("missing"))&&e.jsxs("div",{className:"text-blue-700",children:["📄 ",u.issueType==="missing_platform"?"Нет на платформе":"Нет у провайдера"]})]}):e.jsx("div",{className:"text-green-600 text-sm",children:"✅ Полное совпадение"})})]},`${u.id||u.merchantId||u.platformId||"unknown"}_${g}`)})})]})})}),p.length===0&&e.jsxs("div",{className:"text-center py-12",children:[e.jsx(H,{className:"h-16 w-16 text-gray-400 mx-auto mb-4"}),e.jsx("h3",{className:"text-lg font-medium text-gray-900 mb-2",children:"Нет данных для отображения"}),e.jsx("p",{className:"text-gray-600",children:"Попробуйте изменить фильтры или загрузить другие файлы"})]})]})};function rs(l){const s=[];if(!l||typeof l!="object")return console.error("❌ Invalid reconciliation results:",l),[];const{matched:n=[],statusMismatch:t=[],merchantOnly:r=[],platformOnly:i=[]}=l;return console.log("📋 Formatting data:",{matched:n.length,statusMismatch:t.length,merchantOnly:r.length,platformOnly:i.length}),r.forEach(a=>{var c,p,f,j,S,u;s.push({id:((c=a.merchant)==null?void 0:c.trackingId)||a.trackingId||"N/A",merchantId:((p=a.merchant)==null?void 0:p.trackingId)||a.trackingId||"N/A",platformId:null,merchantStatus:((f=a.merchant)==null?void 0:f.status)||a.status||"N/A",platformStatus:null,merchantData:{status:((j=a.merchant)==null?void 0:j.status)||a.status||"N/A",id:((S=a.merchant)==null?void 0:S.trackingId)||a.trackingId||"N/A",amount:((u=a.merchant)==null?void 0:u.amount)||a.amount||"N/A"},platformData:null,reconciliationStatus:"merchant_only",matchType:"no_match",hasIssue:!0,issueType:"missing_platform"})}),i.forEach(a=>{var c,p,f,j,S,u;s.push({id:((c=a.platform)==null?void 0:c.foreignOperationId)||a.foreignOperationId||"N/A",merchantId:null,platformId:((p=a.platform)==null?void 0:p.foreignOperationId)||a.foreignOperationId||"N/A",merchantStatus:null,platformStatus:((f=a.platform)==null?void 0:f.status)||a.status||"N/A",merchantData:null,platformData:{status:((j=a.platform)==null?void 0:j.status)||a.status||"N/A",id:((S=a.platform)==null?void 0:S.foreignOperationId)||a.foreignOperationId||"N/A",amount:((u=a.platform)==null?void 0:u.amount)||a.amount||"N/A"},reconciliationStatus:"platform_only",matchType:"no_match",hasIssue:!0,issueType:"missing_merchant"})}),t.forEach(a=>{var f,j,S,u,g,x,N,h,k,w;const c=((f=a.merchant)==null?void 0:f.trackingId)||a.trackingId||"N/A",p=((j=a.platform)==null?void 0:j.foreignOperationId)||a.foreignOperationId||"N/A";s.push({id:c,merchantId:c,platformId:p,merchantStatus:((S=a.merchant)==null?void 0:S.status)||a.status||"N/A",platformStatus:((u=a.platform)==null?void 0:u.status)||a.status||"N/A",merchantAmount:((g=a.merchant)==null?void 0:g.amount)||a.amount||"N/A",platformAmount:((x=a.platform)==null?void 0:x.amount)||a.amount||"N/A",merchantData:{status:((N=a.merchant)==null?void 0:N.status)||a.status||"N/A",id:c,amount:((h=a.merchant)==null?void 0:h.amount)||a.amount||"N/A"},platformData:{status:((k=a.platform)==null?void 0:k.status)||a.status||"N/A",id:p,amount:((w=a.platform)==null?void 0:w.amount)||a.amount||"N/A"},reconciliationStatus:a.reconciliationStatus||"status_mismatch",matchType:a.matchType||"status_mismatch",hasIssue:!0,issueType:a.issueType||"status"})}),n.forEach(a=>{var f,j,S,u,g,x,N,h,k,w;const c=((f=a.merchant)==null?void 0:f.trackingId)||a.trackingId||"N/A",p=((j=a.platform)==null?void 0:j.foreignOperationId)||a.foreignOperationId||"N/A";s.push({id:c,merchantId:c,platformId:p,merchantStatus:((S=a.merchant)==null?void 0:S.status)||a.status||"N/A",platformStatus:((u=a.platform)==null?void 0:u.status)||a.status||"N/A",merchantAmount:((g=a.merchant)==null?void 0:g.amount)||a.amount||"N/A",platformAmount:((x=a.platform)==null?void 0:x.amount)||a.amount||"N/A",merchantData:{status:((N=a.merchant)==null?void 0:N.status)||a.status||"N/A",id:c,amount:((h=a.merchant)==null?void 0:h.amount)||a.amount||"N/A"},platformData:{status:((k=a.platform)==null?void 0:k.status)||a.status||"N/A",id:p,amount:((w=a.platform)==null?void 0:w.amount)||a.amount||"N/A"},reconciliationStatus:"matched",matchType:"full_match",hasIssue:!1})}),console.log("✅ Formatted records:",s.length),s}const ns=()=>{const[l,s]=R.useState("upload"),[n,t]=R.useState(null),[r,i]=R.useState(!1),a=async p=>{i(!0),console.log("🔄 Processing reconciliation results...",p);try{if(!p||!p.results)throw new Error("Неверная структура данных от сервера");const f=p.results;console.log("📊 Raw results from server:",f);const j=rs(f);console.log("✅ Reconciliation completed:",{totalRecords:j.length,summary:f.summary,formattedDataSample:j.slice(0,3)}),t({formattedData:j,rawResults:f,metadata:p.metadata,fileNames:{merchant:p.merchantFileName,platform:p.platformFileName}}),s("results")}catch(f){console.error("❌ Reconciliation error:",f),alert("Ошибка при обработке результатов сверки: "+f.message)}finally{i(!1)}},c=()=>{s("upload"),t(null)};if(r)return e.jsx("div",{className:"max-w-4xl mx-auto p-6",children:e.jsxs("div",{className:"bg-white rounded-lg shadow-lg p-8 text-center",children:[e.jsx("div",{className:"animate-spin rounded-full h-16 w-16 border-b-4 border-blue-600 mx-auto mb-4"}),e.jsx("h2",{className:"text-2xl font-bold text-gray-900 mb-2",children:"🔄 Выполняется сверка..."}),e.jsx("p",{className:"text-gray-600",children:"Анализируем данные и ищем расхождения между провайдером и платформой"}),e.jsx("div",{className:"mt-6 bg-gray-50 rounded-lg p-4",children:e.jsxs("div",{className:"text-sm text-gray-600 space-y-1",children:[e.jsx("div",{children:"✅ Файлы загружены и обработаны"}),e.jsx("div",{children:"🔍 Создание индексов для поиска..."}),e.jsx("div",{children:"📊 Сравнение записей..."}),e.jsx("div",{children:"🎯 Анализ расхождений..."})]})})]})});switch(l){case"upload":return e.jsx(Fe,{onFilesUploaded:a});case"results":return e.jsx(as,{reconciliationData:n.formattedData,rawResults:n.rawResults,fileNames:n.fileNames,onBack:c});default:return e.jsx(Fe,{onFilesUploaded:a})}};function ls(){console.log("App component rendering...");const[l,s]=R.useState("selector"),[n,t]=R.useState(null),[r,i]=R.useState(null),[a,c]=R.useState(null),[p,f]=R.useState(!1),j=N=>{t(N),N==="csv"?s("csv"):N==="api"?s("api"):N==="enhanced-api"&&s("enhanced-api")},S=(N,h)=>{console.log("API data loaded:",N.length,"items");const k=Kt(N);i(k),s("dashboard")},u=(N,h)=>{console.log("Enhanced API data loaded:",N.length,"items"),c(N),s("enhanced-dashboard")},g=()=>{s("selector"),t(null),i(null),c(null)},x=()=>{s("reconciliation")};return e.jsxs("div",{className:"App",children:[l==="selector"&&e.jsx(Yt,{onSourceChange:j,currentSource:n,onReconciliationClick:x}),l==="csv"&&e.jsx(Re,{dataSource:"csv",onBackToSelector:g}),l==="api"&&e.jsx(Xt,{onDataLoad:S,loading:p,setLoading:f,onBack:g}),l==="enhanced-api"&&e.jsx(ts,{onDataLoad:u,loading:p,setLoading:f,onBack:g}),l==="dashboard"&&r&&e.jsx(Re,{dataSource:"api",preloadedData:r,onBackToSelector:g}),l==="enhanced-dashboard"&&a&&e.jsxs("div",{className:"min-h-screen bg-gradient-to-br from-slate-900 via-purple-900 to-slate-900 p-6",children:[e.jsx("div",{className:"mb-6",children:e.jsx("button",{onClick:g,className:"px-4 py-2 bg-white/10 text-white rounded-lg hover:bg-white/20 transition-colors duration-200",children:"← Назад к выбору источника"})}),e.jsx(ss,{data:a})]}),l==="reconciliation"&&e.jsxs("div",{className:"min-h-screen bg-gradient-to-br from-slate-900 via-purple-900 to-slate-900 p-6",children:[e.jsx("div",{className:"mb-6",children:e.jsx("button",{onClick:g,className:"px-4 py-2 bg-white/10 text-white rounded-lg hover:bg-white/20 transition-colors duration-200",children:"← Назад к выбору источника"})}),e.jsx(ns,{})]})]})}he.createRoot(document.getElementById("root")).render(e.jsx(De.StrictMode,{children:e.jsx(ls,{})}));
